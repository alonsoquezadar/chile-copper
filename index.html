<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="description" content="Interactive data visualization of Chile's copper production dominance from 2003-2024">
    <meta name="theme-color" content="#0a0a12">
    <title>Chile: The Copper Nation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --copper-deep: #6B3410;
            --copper-dark: #8B4513;
            --copper-medium: #B87333;
            --copper-light: #D4A574;
            --copper-glow: #E8C4A0;
            --bg-primary: #0a0a12;
            --bg-secondary: #12121c;
            --bg-card: #1a1a28;
            --text-primary: #f5f0e8;
            --text-secondary: #a09890;
            --accent-peru: #4a9eff;
            --accent-china: #e74c3c;
            --accent-success: #00d4aa;
            --accent-warning: #ffd93d;
        }
        
        html { scroll-behavior: smooth; }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        /* Navigation */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(180deg, var(--bg-primary) 0%, transparent 100%);
            transition: background 0.3s;
        }
        
        .nav.scrolled {
            background: rgba(10, 10, 18, 0.95);
            backdrop-filter: blur(10px);
        }
        
        .nav-brand {
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            color: var(--copper-medium);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
        }
        
        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            letter-spacing: 0.05em;
            transition: color 0.2s;
        }
        
        .nav-links a:hover, .nav-links a.active {
            color: var(--copper-light);
        }
        
        /* Mobile Menu Button */
        .mobile-menu-btn {
            display: none;
            flex-direction: column;
            justify-content: space-between;
            width: 28px;
            height: 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            z-index: 110;
        }
        
        .mobile-menu-btn span {
            display: block;
            width: 100%;
            height: 2px;
            background: var(--copper-medium);
            border-radius: 2px;
            transition: all 0.3s;
        }
        
        .mobile-menu-btn.active span:nth-child(1) {
            transform: rotate(45deg) translate(6px, 6px);
        }
        
        .mobile-menu-btn.active span:nth-child(2) {
            opacity: 0;
        }
        
        .mobile-menu-btn.active span:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -6px);
        }
        
        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: flex;
            }
            
            .nav-links {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(10, 10, 18, 0.98);
                flex-direction: column;
                justify-content: center;
                align-items: center;
                gap: 2rem;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s;
            }
            
            .nav-links.active {
                opacity: 1;
                visibility: visible;
            }
            
            .nav-links a {
                font-size: 1.2rem;
                color: var(--text-primary);
            }
        }
        
        /* Hero - Redesigned */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            padding: 6rem 4rem;
            position: relative;
            overflow: hidden;
        }
        
        .hero-bg {
            position: absolute;
            inset: 0;
            background: 
                radial-gradient(ellipse at 70% 20%, rgba(184, 115, 51, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 20% 80%, rgba(107, 52, 16, 0.1) 0%, transparent 40%);
        }
        
        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 600px;
        }
        
        .hero-eyebrow {
            font-size: 0.75rem;
            letter-spacing: 0.3em;
            color: var(--copper-medium);
            text-transform: uppercase;
            margin-bottom: 1rem;
        }
        
        .hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(3rem, 7vw, 5rem);
            font-weight: 900;
            line-height: 1.1;
            margin-bottom: 1.5rem;
        }
        
        .hero h1 span {
            background: linear-gradient(135deg, var(--copper-light), var(--copper-medium));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .hero-text {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            max-width: 480px;
        }
        
        .hero-visual {
            position: absolute;
            right: 5%;
            top: 50%;
            transform: translateY(-50%);
            width: 45%;
            max-width: 550px;
        }
        
        .hero-chart {
            width: 100%;
            height: 400px;
        }
        
        /* KPI Strip */
        .kpi-strip {
            display: flex;
            gap: 1px;
            background: rgba(184, 115, 51, 0.2);
            border-radius: 12px;
            overflow: hidden;
            margin-top: 2rem;
        }
        
        .kpi-item {
            flex: 1;
            padding: 1.25rem 1.5rem;
            background: var(--bg-secondary);
            text-align: center;
        }
        
        .kpi-value {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--copper-light);
        }
        
        .kpi-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 0.25rem;
        }
        
        .kpi-delta {
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }
        
        .kpi-delta.up { color: var(--accent-success); }
        .kpi-delta.down { color: var(--accent-china); }
        
        /* Sections */
        section {
            padding: 5rem 4rem;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 3rem;
            border-bottom: 1px solid rgba(184, 115, 51, 0.2);
            padding-bottom: 1.5rem;
        }
        
        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 700;
        }
        
        .section-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255,255,255,0.05);
            overflow: hidden;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .card-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .card-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            background: rgba(184, 115, 51, 0.2);
            color: var(--copper-light);
        }
        
        /* Grid Layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }
        
        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }
        
        .grid-5 {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
        }
        
        @media (max-width: 1200px) {
            .grid-4, .grid-5 { grid-template-columns: repeat(2, 1fr); }
        }
        
        @media (max-width: 1000px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .hero { flex-direction: column; padding: 6rem 2rem 3rem; }
            .hero-visual { position: static; width: 100%; transform: none; margin-top: 2rem; }
            section { padding: 2.5rem 1.5rem; }
            .nav-links { display: none; }
            .section-header { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
        }
        
        @media (max-width: 768px) {
            /* Navigation */
            .nav { padding: 0.75rem 1rem; }
            .nav-brand { font-size: 1rem; }
            
            /* Hero */
            .hero { 
                min-height: auto; 
                padding: 5rem 1rem 2rem; 
            }
            .hero h1 { font-size: 2.2rem; margin-bottom: 1rem; }
            .hero-text { font-size: 0.95rem; margin-bottom: 1.5rem; }
            .hero-eyebrow { font-size: 0.65rem; letter-spacing: 0.2em; }
            .hero-chart { height: 280px; }
            
            /* KPI Strip - Stack on mobile */
            .kpi-strip { 
                flex-direction: column; 
                gap: 1px;
            }
            .kpi-item { 
                padding: 0.75rem 1rem; 
                display: flex;
                justify-content: space-between;
                align-items: center;
                text-align: left;
            }
            .kpi-value { font-size: 1.4rem; }
            .kpi-label { font-size: 0.65rem; margin-top: 0; }
            .kpi-delta { margin-top: 0; margin-left: 0.5rem; }
            
            /* Sections */
            section { padding: 2rem 1rem; }
            .section-title { font-size: 1.5rem; }
            .section-subtitle { font-size: 0.85rem; }
            
            /* Cards */
            .card { 
                padding: 1rem; 
                border-radius: 12px;
            }
            .card-header { 
                flex-direction: column; 
                align-items: flex-start; 
                gap: 0.5rem; 
            }
            .card-title { font-size: 0.85rem; }
            .card-badge { font-size: 0.6rem; padding: 0.2rem 0.5rem; }
            
            /* Grids */
            .grid-2, .grid-3, .grid-4, .grid-5 { 
                grid-template-columns: 1fr; 
                gap: 1rem;
            }
            
            /* Chart heights - reduce on mobile */
            #share-race-chart { height: 350px !important; }
            #sankey-chart { height: 400px !important; }
            #gdp-stacked-chart { height: 300px !important; }
            #company-trends-chart { height: 300px !important; }
            #heatmap { height: 350px !important; }
            #histogram-chart { height: 500px !important; }
            #rolling-trend-chart { height: 220px !important; }
            #yoy-chart { height: 220px !important; }
            #seasonal-chart { height: 180px !important; }
            #exports-chart { height: 300px !important; }
            #china-growth-chart { height: 300px !important; }
            
            /* Heatmap controls */
            .heatmap-controls {
                flex-wrap: wrap;
                gap: 0.25rem;
            }
            .heat-btn {
                font-size: 0.65rem !important;
                padding: 0.3rem 0.5rem !important;
            }
            
            /* Company buttons */
            .company-btn {
                font-size: 0.7rem !important;
                padding: 0.4rem 0.6rem !important;
            }
            
            /* Insight boxes */
            .insight-box, .insight-text {
                font-size: 0.8rem !important;
            }
            
            /* Tooltip adjustments */
            .tooltip-sub { font-size: 0.75rem; }
            
            /* Small multiples - show 1 column */
            #small-multiples-chart { min-height: auto !important; }
        }
        
        @media (max-width: 480px) {
            /* Extra small screens */
            .hero h1 { font-size: 1.8rem; }
            .hero-text { font-size: 0.85rem; }
            .hero-chart { height: 220px; }
            
            .kpi-value { font-size: 1.2rem; }
            .kpi-label { font-size: 0.6rem; }
            
            .section-title { font-size: 1.3rem; }
            .card { padding: 0.75rem; }
            
            /* Further reduce chart heights */
            #share-race-chart { height: 280px !important; }
            #sankey-chart { height: 350px !important; }
            #company-trends-chart { height: 250px !important; }
            #histogram-chart { height: 400px !important; }
        }
        
        /* Touch-friendly interactions */
        @media (hover: none) {
            .heat-btn:active,
            .company-btn:active,
            .nav-links a:active {
                opacity: 0.7;
            }
        }
        
        /* Prevent horizontal scroll */
        html, body {
            overflow-x: hidden;
        }
        
        /* Ensure SVGs are responsive */
        svg {
            max-width: 100%;
            height: auto;
        }
        
        /* Timeline annotations */
        .timeline-event {
            position: absolute;
            font-size: 0.65rem;
            color: var(--accent-warning);
            transform: translateX(-50%);
            text-align: center;
            pointer-events: none;
        }
        
        .timeline-event::before {
            content: '';
            display: block;
            width: 1px;
            height: 20px;
            background: var(--accent-warning);
            margin: 0 auto 4px;
        }
        
        /* Share race chart - Roboto font */
        #share-race-chart,
        #share-race-chart text,
        #share-race-chart .axis text,
        #share-race-chart .tooltip-box text {
            font-family: 'Roboto', sans-serif;
        }
        
        /* Sankey chart - Roboto font */
        #sankey-chart,
        #sankey-chart text {
            font-family: 'Roboto', sans-serif;
        }
        
        /* GDP stacked chart - Roboto font */
        #gdp-stacked-chart,
        #gdp-stacked-chart text {
            font-family: 'Roboto', sans-serif;
        }
        
        /* Company trends chart - Roboto font */
        #company-trends-chart,
        #company-trends-chart text {
            font-family: 'Roboto', sans-serif;
        }
        
        /* Small multiples chart - Roboto font */
        #small-multiples-chart,
        #small-multiples-chart text {
            font-family: 'Roboto', sans-serif;
        }
        
        /* Spark line in cards */
        .spark-container {
            display: flex;
            align-items: flex-end;
            gap: 1rem;
        }
        
        .spark-value {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1;
        }
        
        .spark-chart {
            flex: 1;
            height: 50px;
        }
        
        /* Competition visual */
        .competition-bar {
            height: 40px;
            border-radius: 8px;
            background: var(--bg-secondary);
            overflow: hidden;
            display: flex;
            margin: 1rem 0;
        }
        
        .competition-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--bg-primary);
            transition: flex 0.5s ease;
        }
        
        /* Heatmap styles */
        .heatmap-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .heat-btn {
            padding: 0.4rem 1rem;
            border: 1px solid rgba(184, 115, 51, 0.3);
            background: transparent;
            color: var(--text-secondary);
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .heat-btn:hover { border-color: var(--copper-medium); color: var(--text-primary); }
        .heat-btn.active { background: var(--copper-medium); color: var(--bg-primary); border-color: var(--copper-medium); }
        
        .company-selector {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .company-btn {
            padding: 0.5rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .company-btn:hover { 
            border-color: rgba(255, 255, 255, 0.3); 
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .company-btn.active { 
            background: linear-gradient(135deg, var(--copper-medium), var(--copper-dark)); 
            color: var(--bg-primary); 
            border-color: var(--copper-medium);
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(184, 115, 51, 0.3);
        }
        
        .company-dropdown {
            padding: 0.5rem 2rem 0.5rem 1rem;
            border: 1px solid rgba(184, 115, 51, 0.4);
            background: rgba(10, 10, 18, 0.9);
            color: var(--text-primary);
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23B87333' d='M6 8L2 4h8z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            min-width: 180px;
            transition: all 0.2s ease;
        }
        
        .company-dropdown:hover {
            border-color: var(--copper-medium);
            box-shadow: 0 0 10px rgba(184, 115, 51, 0.2);
        }
        
        .company-dropdown:focus {
            outline: none;
            border-color: var(--copper-medium);
            box-shadow: 0 0 15px rgba(184, 115, 51, 0.3);
        }
        
        .company-dropdown option {
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 0.5rem;
        }
        
        /* Tooltip */
        .tooltip {
            position: fixed;
            background: rgba(10, 10, 18, 0.95);
            border: 1px solid var(--copper-medium);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 0.8rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.15s;
            z-index: 1000;
            max-width: 220px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        
        .tooltip-title { font-weight: 600; color: var(--copper-light); margin-bottom: 0.25rem; }
        .tooltip-value { font-size: 1.1rem; font-weight: 700; }
        .tooltip-sub { color: var(--text-secondary); font-size: 0.75rem; margin-top: 0.25rem; }
        
        /* Axis styling */
        .axis text { fill: var(--text-secondary); font-size: 11px; }
        .axis line, .axis path { stroke: rgba(255,255,255,0.1); }
        .grid line { stroke: rgba(255,255,255,0.05); }
        
        /* Annotations */
        .annotation {
            font-size: 0.7rem;
            fill: var(--accent-warning);
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
            font-size: 0.85rem;
            border-top: 1px solid rgba(255,255,255,0.05);
        }
        
        footer a { color: var(--copper-light); text-decoration: none; }
        
        /* Insights callout */
        .insight-callout {
            display: flex;
            gap: 1rem;
            padding: 1.25rem;
            background: linear-gradient(135deg, rgba(184, 115, 51, 0.1), rgba(184, 115, 51, 0.05));
            border-left: 3px solid var(--copper-medium);
            border-radius: 0 12px 12px 0;
            margin-top: 1.5rem;
        }
        
        .insight-icon {
            font-size: 1.5rem;
            line-height: 1;
        }
        
        .insight-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .insight-text strong { color: var(--text-primary); }
        
        /* Bar race animation prep */
        .bar-label {
            font-size: 0.75rem;
            fill: var(--text-primary);
        }
        
        .bar-value {
            font-size: 0.7rem;
            fill: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="tooltip" id="tooltip"></div>
    
    <nav class="nav" id="nav">
        <div class="nav-brand">
            <svg width="24" height="24" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="40" fill="none" stroke="#B87333" stroke-width="8"/>
                <text x="50" y="58" text-anchor="middle" fill="#B87333" font-family="Playfair Display" font-size="28" font-weight="700">Cu</text>
            </svg>
            Copper Mining Industry in Chile
        </div>
        <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <div class="nav-links" id="nav-links">
            <a href="#about">About</a>
            <a href="#dominance">Global Producers</a>
            <a href="#companies">Mining Companies</a>
            <a href="#patterns">Production Dynamics</a>
            <a href="#exports">Export Destinations</a>
        </div>
    </nav>
    
    <header class="hero">
        <div class="hero-bg"></div>
        <div class="hero-content">
            <p class="hero-eyebrow">Candidate number: 69267</p>
            <h1>The World Runs on <span>Chilean Copper</span></h1>
            <p class="hero-text">For two decades, Chile has dominated global copper production‚Äîfueling electric vehicles, renewable energy, and the digital revolution. This is the story behind the world's largest copper producer.</p>
            
            <div class="kpi-strip">
                <div class="kpi-item">
                    <div class="kpi-value">5.5M</div>
                    <div class="kpi-label">Metric Tons (2024)</div>
                </div>
                <div class="kpi-item">
                    <div class="kpi-value">24%</div>
                    <div class="kpi-label">of global production</div>
                </div>
                <div class="kpi-item">
                    <div class="kpi-value">#1</div>
                    <div class="kpi-label">world's largest producer</div>
                </div>
            </div>
            
            <div class="kpi-strip" style="margin-top: 1rem;">
                <div class="kpi-item">
                    <div class="kpi-value">10%</div>
                    <div class="kpi-label">contribution to GDP</div>
                </div>
                <div class="kpi-item">
                    <div class="kpi-value">51%</div>
                    <div class="kpi-label">of national exports</div>
                </div>
                <div class="kpi-item">
                    <div class="kpi-value">76%</div>
                    <div class="kpi-label">produced by private mining</div>
                </div>
            </div>
        </div>
    </header>
    
    <section id="about">
        <div class="section-header">
            <div>
                <h2 class="section-title">About This Project</h2>
                <p class="section-subtitle">Data sources, methodology, and conclusions</p>
            </div>
        </div>
        
        <p style="font-family: 'Roboto', sans-serif; color: var(--text-secondary); font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;">
            <strong style="color: #f5f0e8;">Aims of the Project.</strong> This project aims to create a comprehensive, well-designed data visualization dashboard that consolidates publicly available information about Chile's copper industry into a single, accessible resource. The goal is to provide anyone interested in the sector‚Äîinvestors, researchers, journalists, or students‚Äîwith a clear overview of production trends, market dynamics, and export patterns. Beyond accessibility, the project seeks to demonstrate Chile's critical role in global copper supply, where the country has maintained its position as the world's leading producer for over two decades, currently accounting for 24% of global mine production.
        </p>
        
        <p style="font-family: 'Roboto', sans-serif; color: var(--text-secondary); font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;">
            <strong style="color: #f5f0e8;">Data Sources and Access.</strong> The primary data source is COCHILCO (Chilean Copper Commission), Chile's official government agency for copper statistics. Excel files were manually downloaded from their public <a href="https://www.cochilco.cl:4040/boletin-web/" target="_blank" style="color: #B87333; text-decoration: underline;">database</a>, including monthly production by company (2003-2024), annual production by mine, exports by destination (2010-2024), copper prices, and GDP contribution data. World production figures were obtained from the International Copper Study Group (ICSG), also manually downloaded. Data processing was performed using Python with pandas for cleaning, aggregation, and statistical calculations. The visualization dashboard was built using D3.js for interactive charts. AI assistance (Claude) was used extensively throughout the development process‚Äîfor data transformation scripts, D3.js code generation, design iteration, and analytical insights.
        </p>
        
        <p style="font-family: 'Roboto', sans-serif; color: var(--text-secondary); font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;">
            <strong style="color: #f5f0e8;">Challenges in Data Cleaning and Analysis.</strong> The primary challenge was integrating multiple datasets with different structures, time ranges, and granularities into a coherent narrative. COCHILCO files varied in format‚Äîsome organized by company, others by mine‚Äîrequiring careful mapping to avoid double-counting (e.g., Codelco operates multiple mines that needed aggregation). Export data only began in 2010, while production data extended to 2003, creating timeline inconsistencies. Congo's emergence as a major producer posed another challenge: USGS data was needed to supplement COCHILCO figures, which only tracked traditional competitors.
        </p>
        
        <p style="font-family: 'Roboto', sans-serif; color: var(--text-secondary); font-size: 1.1rem; line-height: 1.8; margin-bottom: 2.5rem;">
            <strong style="color: #f5f0e8;">Conclusions.</strong> The dashboard reveals four key insights about Chile's copper industry. First, private mining companies‚Äîled by BHP's Escondida‚Äîhave become the engine of Chilean production, accounting for 75% of output while state-owned Codelco has stagnated, hitting a 25-year production low in 2023 due to aging infrastructure, declining ore grades, and delayed investments. Second, major disruptions significantly impact national output: the 2017 Escondida strike shut down the world's largest copper mine completely for over a month. Third, Chile faces concentration risk in its export markets‚ÄîChina's share surged from 33% in 2010 to 54% in 2024. Finally, despite remaining the world's top producer, Chile's global market share has declined from 36% to 24% as competitors like Congo emerged from virtually zero to becoming the second-largest producer. These trends suggest Chile's copper dominance, while still substantial, faces structural challenges requiring significant investment and diversification.
        </p>
    </section>
    
    <section id="dominance">
        <div class="section-header">
            <div>
                <h2 class="section-title">The New Geography of Copper Producers</h2>
                <p class="section-subtitle">A 6x production increase since 1960 reshaped the global landscape</p>
            </div>
        </div>
        
        <p style="font-family: 'Roboto', sans-serif; color: var(--text-secondary); font-size: 1.1rem; line-height: 1.8; margin-bottom: 2.5rem;">
            Global copper mine production has expanded from 4 to 23 million tonnes since 1960‚Äîa 6x increase driven by surging demand for electrification and renewable energy. Chile remains the undisputed leader, but the landscape has fundamentally changed. Congo emerged from virtually nothing to become the world's second-largest producer, while Peru tripled its output. Today, these three nations alone account for half of all mined copper on Earth. This section explores how the industry grew and who the key players are.
        </p>
        
        <div class="card" style="margin-bottom: 1.5rem; font-family: 'Roboto', sans-serif;">
            <div class="card-header" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                <span class="card-title" style="font-family: 'Roboto', sans-serif;">World Copper Mine Production</span>
                <span style="color: #a09890; font-size: 13px; font-weight: 400; font-family: 'Roboto', sans-serif;">Global mine production, million metric tonnes of copper, 1960-2024</span>
                <span style="color: #706860; font-size: 11px; font-weight: 400; font-style: italic; font-family: 'Roboto', sans-serif;">Source: International Copper Study Group (ICSG). 2024 data is preliminary.</span>
            </div>
            <div id="world-mine-chart" style="height: 320px;"></div>
        </div>
        
        <div class="card" style="margin-bottom: 1.5rem; font-family: 'Roboto', sans-serif;">
            <div class="card-header" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                <span class="card-title" style="font-family: 'Roboto', sans-serif;">Copper Market Share Evolution</span>
                <span style="color: #a09890; font-size: 13px; font-weight: 400; font-family: 'Roboto', sans-serif;">Copper mine production, major producers, thousand metric tonnes, 2003-2024</span>
                <span style="color: #706860; font-size: 11px; font-weight: 400; font-style: italic; font-family: 'Roboto', sans-serif;">Source: Prepared by the author based on COCHILCO data for Chile, Peru, China, and USA; USGS data for Congo (available from 2013).</span>
            </div>
            <div id="share-race-chart" style="height: 350px;"></div>
        </div>
        
        <div class="grid-5">
            <div class="card" style="font-family: 'Roboto', sans-serif;">
                <div class="card-title" style="color: var(--copper-medium); font-family: 'Roboto', sans-serif;">üá®üá± Chile <span style="color: #B87333; font-size: 0.75rem; font-weight: 700;">#1</span></div>
                <div class="spark-container">
                    <div class="spark-value" style="color: var(--copper-light);">5.5M</div>
                    <div class="spark-chart" id="spark-chile"></div>
                </div>
                <div class="kpi-delta up" style="margin-top: 0.5rem;">+12% since 2003</div>
            </div>
            <div class="card" style="font-family: 'Roboto', sans-serif;">
                <div class="card-title" style="color: #9b59b6; font-family: 'Roboto', sans-serif;">üá®üá© Congo <span style="color: #9b59b6; font-size: 0.75rem; font-weight: 700;">#2</span></div>
                <div class="spark-container">
                    <div class="spark-value" style="color: #9b59b6;">3.3M</div>
                    <div class="spark-chart" id="spark-congo"></div>
                </div>
                <div class="kpi-delta up" style="margin-top: 0.5rem;">+240% since 2013</div>
            </div>
            <div class="card" style="font-family: 'Roboto', sans-serif;">
                <div class="card-title" style="color: var(--accent-peru); font-family: 'Roboto', sans-serif;">üáµüá™ Peru <span style="color: var(--accent-peru); font-size: 0.75rem; font-weight: 700;">#3</span></div>
                <div class="spark-container">
                    <div class="spark-value" style="color: var(--accent-peru);">2.7M</div>
                    <div class="spark-chart" id="spark-peru"></div>
                </div>
                <div class="kpi-delta up" style="margin-top: 0.5rem;">+222% since 2003</div>
            </div>
            <div class="card" style="font-family: 'Roboto', sans-serif;">
                <div class="card-title" style="color: var(--accent-china); font-family: 'Roboto', sans-serif;">üá®üá≥ China <span style="color: var(--accent-china); font-size: 0.75rem; font-weight: 700;">#4</span></div>
                <div class="spark-container">
                    <div class="spark-value" style="color: var(--accent-china);">1.8M</div>
                    <div class="spark-chart" id="spark-china"></div>
                </div>
                <div class="kpi-delta up" style="margin-top: 0.5rem;">+200% since 2003</div>
            </div>
            <div class="card" style="font-family: 'Roboto', sans-serif;">
                <div class="card-title" style="color: var(--text-secondary); font-family: 'Roboto', sans-serif;">üá∫üá∏ USA <span style="color: var(--text-secondary); font-size: 0.75rem; font-weight: 700;">#5</span></div>
                <div class="spark-container">
                    <div class="spark-value" style="color: var(--text-secondary);">1.1M</div>
                    <div class="spark-chart" id="spark-usa"></div>
                </div>
                <div class="kpi-delta down" style="margin-top: 0.5rem;">-5% since 2003</div>
            </div>
        </div>
        
        <div class="insight-callout">
            <div class="insight-icon">‚ö†Ô∏è</div>
            <div class="insight-text">
                <strong>Strategic Shift:</strong> Congo has emerged as the world's #2 copper producer, surpassing Peru. Production grew from 970 thousand tonnes in 2013 to 3.3 million in 2024‚Äîa 240% increase driven by major investments in the Katanga copper belt.
            </div>
        </div>
    </section>
    
    <section id="companies">
        <div class="section-header">
            <div>
                <h2 class="section-title">The Mining Companies in Chile</h2>
                <p class="section-subtitle">The companies powering the world's largest copper industry</p>
            </div>
        </div>
        
        <p style="font-family: 'Roboto', sans-serif; color: var(--text-secondary); font-size: 1.1rem; line-height: 1.8; margin-bottom: 2.5rem;">
            Chile's copper industry is dominated by private mining companies, which account for 76% of national production, while state-owned Codelco contributes the remaining 24%. The crown jewel of private mining is <strong style="color: #4a9eff;">Escondida</strong>‚Äîthe world's largest copper mine. Discovered in 1981 in the Atacama Desert, its name means "hidden" in Spanish, as the ore body was buried under hundreds of meters of rock. Today, Escondida is operated by BHP (57.5%) with Rio Tinto (30%) and Japanese consortium JECO (12.5%) as partners, producing over 1 million tonnes annually. <strong style="color: #B87333;">Codelco</strong>, the state giant, hit a 25-year production low in 2023 (1.424M tonnes) due to aging mines, a 2021 landslide, and delayed projects‚Äîthe company is now executing a $40B+ investment plan to modernize its century-old operations and reverse the decline. <strong style="color: #2ecc71;">Antofagasta Minerals</strong>, controlled by the Luksic family, produced 664,000 tonnes in 2024 and is investing $7.5B including a $4.4B expansion at Centinela. <strong style="color: #f39c12;">Collahuasi</strong>, a joint venture between Anglo American, Glencore, and Mitsui (44/44/12), produced 559,000 tonnes and is building a $1B+ desalination plant to reach 600,000 tonnes by 2027. <strong style="color: #9b59b6;">Anglo American</strong> operates Los Bronces and holds 44% of Collahuasi‚Äîthe company announced a merger with Teck Resources to form a top-5 global copper producer.
        </p>
        
        <div class="card" style="font-family: 'Roboto', sans-serif;">
            <div class="card-header" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                <span class="card-title" style="font-family: 'Roboto', sans-serif;">Mine to Company Production Flow (2024)</span>
                <span style="color: #a09890; font-size: 13px; font-weight: 400; font-family: 'Roboto', sans-serif;">Copper mine production, thousand metric tonnes of fine copper</span>
                <span style="color: #706860; font-size: 11px; font-weight: 400; font-style: italic; font-family: 'Roboto', sans-serif;">Source: COCHILCO.</span>
            </div>
            <div id="sankey-chart" style="height: 720px; font-family: 'Roboto', sans-serif;"></div>
        </div>
        
        <div class="card" style="margin-top: 1.5rem; font-family: 'Roboto', sans-serif;">
            <div class="card-header" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                <span class="card-title" style="font-family: 'Roboto', sans-serif;">Company Production Trends (2003-2024)</span>
                <span style="color: #a09890; font-size: 13px; font-weight: 400; font-family: 'Roboto', sans-serif;">Copper mine production by company, thousand metric tonnes of fine copper</span>
                <span style="color: #706860; font-size: 11px; font-weight: 400; font-style: italic; font-family: 'Roboto', sans-serif;">Source: COCHILCO.</span>
            </div>
            <div id="company-trends-chart" style="height: 320px; font-family: 'Roboto', sans-serif;"></div>
        </div>
        
        <div class="card" style="margin-top: 1.5rem; font-family: 'Roboto', sans-serif;">
            <div class="card-header" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                    <span class="card-title" style="font-family: 'Roboto', sans-serif;">All Companies Comparison</span>
                    <select id="company-filter" class="company-dropdown" onchange="filterSmallMultiples(this.value)">
                        <option value="all">All Companies</option>
                        <option value="BHP">BHP</option>
                        <option value="Codelco">Codelco</option>
                        <option value="Antofagasta Minerals">Antofagasta Minerals</option>
                        <option value="Collahuasi">Collahuasi</option>
                        <option value="Anglo American">Anglo American</option>
                        <option value="Teck">Teck</option>
                        <option value="Freeport-McMoRan">Freeport-McMoRan</option>
                        <option value="Lundin Mining">Lundin Mining</option>
                        <option value="Glencore">Glencore</option>
                    </select>
                </div>
                <span style="color: #a09890; font-size: 13px; font-weight: 400; font-family: 'Roboto', sans-serif;">Copper mine production by company, thousand metric tonnes of fine copper, 2003-2024</span>
                <span style="color: #706860; font-size: 11px; font-weight: 400; font-style: italic; font-family: 'Roboto', sans-serif;">Source: COCHILCO.</span>
            </div>
            <div id="small-multiples-chart" style="min-height: 780px; font-family: 'Roboto', sans-serif;"></div>
        </div>
        
    </section>
    
    <section id="patterns">
        <div class="section-header">
            <div>
                <h2 class="section-title">Production Dynamics</h2>
                <p class="section-subtitle">22 years of monthly data reveal the rhythms, risks, and resilience of Chile's copper industry</p>
            </div>
        </div>
        
        <p style="font-family: 'Roboto', sans-serif; color: var(--text-secondary); font-size: 1.1rem; line-height: 1.8; margin-bottom: 2.5rem;">
            Copper mining follows predictable seasonal patterns shaped by Chile's southern hemisphere calendar‚Äîproduction dips in <strong style="color: #4a9eff;">February</strong> (summer maintenance + shorter month) and peaks in <strong style="color: #B87333;">December</strong> (year-end push). But these rhythms are punctuated by disruptions: labor strikes, operational failures, and safety incidents. The <strong style="color: #e74c3c;">2017 Escondida strike</strong>‚Äîthe longest in Chilean mining history‚Äîshut down the world's largest copper mine for 44 days, erasing over 200,000 tonnes from annual output. Understanding these patterns helps anticipate supply risks in a market increasingly dependent on Chilean copper.
        </p>
        
        <div class="card" style="font-family: 'Roboto', sans-serif;">
            <div class="card-header" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                    <span class="card-title" style="font-family: 'Roboto', sans-serif;">Production Heatmap</span>
                    <div class="heatmap-controls">
                        <button class="heat-btn active" data-key="total">Chile Total</button>
                        <button class="heat-btn" data-key="codelco">Codelco</button>
                        <button class="heat-btn" data-key="escondida">Escondida</button>
                        <button class="heat-btn" data-key="collahuasi">Collahuasi</button>
                    </div>
                </div>
                <span style="color: #a09890; font-size: 13px; font-weight: 400; font-family: 'Roboto', sans-serif;">Monthly copper production, thousand metric tonnes, 2003-2024</span>
                <span style="color: #706860; font-size: 11px; font-weight: 400; font-style: italic; font-family: 'Roboto', sans-serif;">Source: COCHILCO.</span>
            </div>
            <div id="heatmap" style="height: 420px;"></div>
        </div>
        
        <div class="grid-2" style="margin-top: 1.5rem;">
            <div class="card" style="font-family: 'Roboto', sans-serif;">
                <div class="card-header" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                    <span class="card-title" style="font-family: 'Roboto', sans-serif;">Seasonal Pattern</span>
                    <span style="color: #a09890; font-size: 13px; font-weight: 400; font-family: 'Roboto', sans-serif;">Average monthly copper production, thousand metric tonnes, 2003-2024</span>
                    <span style="color: #706860; font-size: 11px; font-weight: 400; font-style: italic; font-family: 'Roboto', sans-serif;">Source: COCHILCO.</span>
                </div>
                <div id="seasonal-chart" style="height: 220px;"></div>
                <div class="tooltip-sub" style="margin-top: 0.5rem;">February lowest (short month + summer maintenance), December highest (year-end push)</div>
            </div>
            <div class="card" style="font-family: 'Roboto', sans-serif;">
                <div class="card-header" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                    <span class="card-title" style="font-family: 'Roboto', sans-serif;">Major Supply Disruptions</span>
                    <span style="color: #a09890; font-size: 13px; font-weight: 400; font-family: 'Roboto', sans-serif;">Key events that impacted Chilean copper production</span>
                </div>
                <div style="margin-top: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                        <div>
                            <span style="color: #f5f0e8; font-weight: 600;">‚ö° Escondida Strike</span>
                            <div style="color: #706860; font-size: 11px; margin-top: 2px;">44-day stoppage, longest in Chilean mining history</div>
                        </div>
                        <div style="text-align: right;">
                            <span style="color: var(--text-secondary); font-size: 12px;">Feb-Mar 2017</span>
                            <div style="color: #e74c3c; font-size: 11px; font-weight: 600;">-200K tonnes</div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                        <div>
                            <span style="color: #f5f0e8; font-weight: 600;">üîß Escondida Ore Grade Issues</span>
                            <div style="color: #706860; font-size: 11px; margin-top: 2px;">Declining ore quality and operational challenges</div>
                        </div>
                        <div style="text-align: right;">
                            <span style="color: var(--text-secondary); font-size: 12px;">2011</span>
                            <div style="color: #e74c3c; font-size: 11px; font-weight: 600;">-285K tonnes YoY</div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                        <div>
                            <span style="color: #f5f0e8; font-weight: 600;">üîß Collahuasi Operational Crisis</span>
                            <div style="color: #706860; font-size: 11px; margin-top: 2px;">Work stoppages, heavy rains, and fatal accidents</div>
                        </div>
                        <div style="text-align: right;">
                            <span style="color: var(--text-secondary); font-size: 12px;">2012</span>
                            <div style="color: #e74c3c; font-size: 11px; font-weight: 600;">-37.8% YoY</div>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0;">
                        <div>
                            <span style="color: #f5f0e8; font-weight: 600;">‚õèÔ∏è Codelco Fatal Accidents</span>
                            <div style="color: #706860; font-size: 11px; margin-top: 2px;">Safety stoppages at Radomiro Tomic</div>
                        </div>
                        <div style="text-align: right;">
                            <span style="color: var(--text-secondary); font-size: 12px;">Mar 2024</span>
                            <div style="color: #e74c3c; font-size: 11px; font-weight: 600;">-28K tonnes</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card" style="margin-top: 1.5rem; font-family: 'Roboto', sans-serif;">
            <div class="card-header" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                <span class="card-title" style="font-family: 'Roboto', sans-serif;">Monthly Production Trend</span>
                <span style="color: #a09890; font-size: 13px; font-weight: 400; font-family: 'Roboto', sans-serif;">Chile total copper production, thousand metric tonnes, Jan 2003 - Dec 2024</span>
                <span style="color: #706860; font-size: 11px; font-weight: 400; font-style: italic; font-family: 'Roboto', sans-serif;">Source: COCHILCO.</span>
            </div>
            <div id="rolling-trend-chart" style="height: 320px;"></div>
            <p style="font-family: 'Roboto', sans-serif; color: #a09890; font-size: 12px; line-height: 1.6; margin: 1rem 0 0 0; padding-top: 0.75rem; border-top: 1px solid rgba(255,255,255,0.05);">
                Chile's copper production peaked at <strong style="color: #2ecc71;">563.5</strong> thousand metric tonnes in December 2024‚Äîthe highest monthly output in 22 years. The 2017 trough reflects the 44-day Escondida strike. Despite strong seasonality, annual output has remained relatively flat since 2018, hovering around 5.4-5.7 million tonnes, constrained by declining ore grades at mature deposits.
            </p>
        </div>
        
        <div class="card" style="margin-top: 1.5rem; font-family: 'Roboto', sans-serif;">
            <div class="card-header" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                <span class="card-title" style="font-family: 'Roboto', sans-serif;">2024 Production vs Historical Trend</span>
                <span style="color: #a09890; font-size: 13px; font-weight: 400; font-family: 'Roboto', sans-serif;">Monthly pattern by year, 2024 highlighted vs historical range</span>
                <span style="color: #706860; font-size: 11px; font-weight: 400; font-style: italic; font-family: 'Roboto', sans-serif;">Source: COCHILCO.</span>
            </div>
            <div id="yoy-chart" style="height: 320px;"></div>
            <p style="font-family: 'Roboto', sans-serif; color: #a09890; font-size: 12px; line-height: 1.6; margin: 1rem 0 0 0; padding-top: 0.75rem; border-top: 1px solid rgba(255,255,255,0.05);">
                2024 began below the historical average, with the first three quarters tracking near the lower bound of the 22-year range. However, production surged in the final quarter‚ÄîOctober through December‚Äîculminating in a record-breaking December (563.5 thousand tonnes) that pushed annual output to 5.5 million tonnes, recovering Chile's position after two years of decline.
            </p>
        </div>
        
        <div class="card" style="margin-top: 1.5rem; font-family: 'Roboto', sans-serif;">
            <div class="card-header" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                <span class="card-title" style="font-family: 'Roboto', sans-serif;">Monthly Production Distribution</span>
                <span style="color: #a09890; font-size: 13px; font-weight: 400; font-family: 'Roboto', sans-serif;">Comparing production variability across major mining operations, 2003-2024</span>
                <span style="color: #706860; font-size: 11px; font-weight: 400; font-style: italic; font-family: 'Roboto', sans-serif;">Source: COCHILCO.</span>
            </div>
            <div id="histogram-chart" style="height: 400px;"></div>
            <p style="font-family: 'Roboto', sans-serif; color: #a09890; font-size: 12px; line-height: 1.6; margin: 1rem 0 0 0; padding-top: 0.75rem; border-top: 1px solid rgba(255,255,255,0.05);">
                BHP's Escondida shows a clearly higher mean than Codelco's flagship operations, revealing consistently superior performance. Escondida's distribution centers around 95 thousand tonnes monthly versus Codelco's 70 thousand tonnes‚Äîa 36% productivity gap that underscores the efficiency advantage of modern private mining over aging state-owned infrastructure.
            </p>
        </div>
    </section>
    
    <section id="exports">
        <div class="section-header">
            <div>
                <h2 class="section-title">Export Destinations</h2>
                <p class="section-subtitle">Asia's dominance in Chilean copper exports</p>
            </div>
        </div>
        
        <p style="font-family: 'Roboto', sans-serif; color: var(--text-secondary); font-size: 1.1rem; line-height: 1.8; margin-bottom: 2.5rem;">
            Chile's copper exports have undergone a dramatic geographic shift over the past 15 years. In 2010, <strong style="color: #e74c3c;">China</strong> accounted for 33% of Chilean copper exports‚Äîalready significant, but balanced by strong European and Japanese demand. By 2020, that share had surged to 56%, making Chile increasingly dependent on a single market. This concentration reflects China's extraordinary industrialization and urbanization, which consumed over half the world's copper for construction, power grids, and manufacturing. The relationship is symbiotic but asymmetric: Chile needs China more than China needs Chile, as alternative suppliers in Peru and Congo have expanded rapidly. Meanwhile, <strong style="color: #4a9eff;">the United States</strong> emerged as a surprising gainer, climbing from 6th to 3rd place as American manufacturers sought to secure supply chains closer to home.
        </p>
        
        <div class="grid-2">
            <div class="card" style="font-family: 'Roboto', sans-serif;">
                <div class="card-header" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                    <span class="card-title" style="font-family: 'Roboto', sans-serif;">Export Destinations 2024</span>
                    <span style="color: #a09890; font-size: 13px; font-weight: 400; font-family: 'Roboto', sans-serif;">Top 5 destinations by volume, thousand metric tonnes</span>
                    <span style="color: #706860; font-size: 11px; font-weight: 400; font-style: italic; font-family: 'Roboto', sans-serif;">Source: COCHILCO, Exports by Destination 2010-2024.</span>
                </div>
                <div id="exports-chart" style="height: 380px;"></div>
            </div>
            <div class="card" style="font-family: 'Roboto', sans-serif;">
                <div class="card-header" style="flex-direction: column; align-items: flex-start; gap: 4px;">
                    <span class="card-title" style="font-family: 'Roboto', sans-serif;">Export Destination Rankings</span>
                    <span style="color: #a09890; font-size: 13px; font-weight: 400; font-family: 'Roboto', sans-serif;">Top 8 destinations by share of Chilean copper exports, 2010 vs 2024</span>
                    <span style="color: #706860; font-size: 11px; font-weight: 400; font-style: italic; font-family: 'Roboto', sans-serif;">Source: COCHILCO, Exports by Destination 2010-2024.</span>
                </div>
                <div id="china-growth-chart" style="height: 380px;"></div>
            </div>
        </div>
    </section>
    
    <script>
        // Data
        const data = {
            worldProduction: [
                {year: 2003, Chile: 4904, Peru: 843, Congo: 0, China: 604, USA: 1116},
                {year: 2004, Chile: 5413, Peru: 1036, Congo: 0, China: 742, USA: 1160},
                {year: 2005, Chile: 5321, Peru: 1010, Congo: 0, China: 762, USA: 1140},
                {year: 2006, Chile: 5361, Peru: 1049, Congo: 0, China: 873, USA: 1197},
                {year: 2007, Chile: 5557, Peru: 1190, Congo: 0, China: 928, USA: 1168},
                {year: 2008, Chile: 5328, Peru: 1268, Congo: 0, China: 1076, USA: 1310},
                {year: 2009, Chile: 5394, Peru: 1275, Congo: 0, China: 1062, USA: 1181},
                {year: 2010, Chile: 5419, Peru: 1247, Congo: 0, China: 1180, USA: 1110},
                {year: 2011, Chile: 5263, Peru: 1235, Congo: 0, China: 1295, USA: 1110},
                {year: 2012, Chile: 5434, Peru: 1299, Congo: 0, China: 1642, USA: 1196},
                {year: 2013, Chile: 5776, Peru: 1376, Congo: 970, China: 1707, USA: 1240},
                {year: 2014, Chile: 5750, Peru: 1380, Congo: 1030, China: 1632, USA: 1383},
                {year: 2015, Chile: 5772, Peru: 1705, Congo: 1020, China: 1667, USA: 1410},
                {year: 2016, Chile: 5553, Peru: 2354, Congo: 846, China: 1851, USA: 1431},
                {year: 2017, Chile: 5504, Peru: 2445, Congo: 1090, China: 1656, USA: 1258},
                {year: 2018, Chile: 5832, Peru: 2437, Congo: 1230, China: 1507, USA: 1216},
                {year: 2019, Chile: 5787, Peru: 2455, Congo: 1290, China: 1601, USA: 1257},
                {year: 2020, Chile: 5733, Peru: 2154, Congo: 1600, China: 1673, USA: 1224},
                {year: 2021, Chile: 5625, Peru: 2299, Congo: 1740, China: 1741, USA: 1233},
                {year: 2022, Chile: 5330, Peru: 2439, Congo: 2350, China: 1705, USA: 1232},
                {year: 2023, Chile: 5250, Peru: 2755, Congo: 2930, China: 1685, USA: 1136},
                {year: 2024, Chile: 5506, Peru: 2712, Congo: 3300, China: 1812, USA: 1059}
            ],
            worldMineProduction: [
                {year: 1960, value: 3924}, {year: 1961, value: 4081}, {year: 1962, value: 4216}, {year: 1963, value: 4286}, {year: 1964, value: 4443},
                {year: 1965, value: 4769}, {year: 1966, value: 4987}, {year: 1967, value: 4743}, {year: 1968, value: 5010}, {year: 1969, value: 5682},
                {year: 1970, value: 5900}, {year: 1971, value: 5941}, {year: 1972, value: 6541}, {year: 1973, value: 6915}, {year: 1974, value: 7097},
                {year: 1975, value: 6735}, {year: 1976, value: 7289}, {year: 1977, value: 7444}, {year: 1978, value: 7306}, {year: 1979, value: 7372},
                {year: 1980, value: 7227}, {year: 1981, value: 7721}, {year: 1982, value: 7745}, {year: 1983, value: 7824}, {year: 1984, value: 8135},
                {year: 1985, value: 8314}, {year: 1986, value: 8295}, {year: 1987, value: 8620}, {year: 1988, value: 8773}, {year: 1989, value: 9086},
                {year: 1990, value: 9227}, {year: 1991, value: 9373}, {year: 1992, value: 9497}, {year: 1993, value: 9571}, {year: 1994, value: 9539},
                {year: 1995, value: 10070}, {year: 1996, value: 11084}, {year: 1997, value: 11514}, {year: 1998, value: 12228}, {year: 1999, value: 12767},
                {year: 2000, value: 13199}, {year: 2001, value: 13636}, {year: 2002, value: 13487}, {year: 2003, value: 13699}, {year: 2004, value: 14594},
                {year: 2005, value: 14927}, {year: 2006, value: 14983}, {year: 2007, value: 15508}, {year: 2008, value: 15532}, {year: 2009, value: 15941},
                {year: 2010, value: 15987}, {year: 2011, value: 15960}, {year: 2012, value: 16678}, {year: 2013, value: 18173}, {year: 2014, value: 18420},
                {year: 2015, value: 19152}, {year: 2016, value: 20396}, {year: 2017, value: 20065}, {year: 2018, value: 20604}, {year: 2019, value: 20657},
                {year: 2020, value: 20740}, {year: 2021, value: 21223}, {year: 2022, value: 21911}, {year: 2023, value: 22368}, {year: 2024, value: 22990}
            ],
            gdpShare: [
                {year: 2003, share: 8.10, price: 81}, {year: 2004, share: 12.50, price: 130},
                {year: 2005, share: 14.52, price: 167}, {year: 2006, share: 20.66, price: 305},
                {year: 2007, share: 20.54, price: 323}, {year: 2008, share: 14.03, price: 316},
                {year: 2009, share: 13.14, price: 234}, {year: 2010, share: 15.98, price: 342},
                {year: 2011, share: 14.88, price: 400}, {year: 2012, share: 12.82, price: 361},
                {year: 2013, share: 10.98, price: 332}, {year: 2014, share: 10.91, price: 311},
                {year: 2015, share: 8.58, price: 250}, {year: 2016, share: 8.07, price: 221},
                {year: 2017, share: 10.09, price: 280}, {year: 2018, share: 9.84, price: 296},
                {year: 2019, share: 9.38, price: 273}, {year: 2020, share: 11.58, price: 280},
                {year: 2021, share: 14.10, price: 423}, {year: 2022, share: 13.99, price: 400},
                {year: 2023, share: 11.91, price: 385}, {year: 2024, share: 11.74, price: 420}
            ],
            gdpBySector: [
                {year: 2003, Mining: 4266, Manufacturing: 8730, Construction: 3386, Commerce: 4840, Financial: 7668, OtherServices: 15748, Agriculture: 2159, Utilities: 1432},
                {year: 2004, Mining: 7565, Manufacturing: 9457, Construction: 3466, Commerce: 5484, Financial: 8858, OtherServices: 17015, Agriculture: 2253, Utilities: 1454},
                {year: 2005, Mining: 10002, Manufacturing: 9712, Construction: 3855, Commerce: 6361, Financial: 10346, OtherServices: 18341, Agriculture: 2596, Utilities: 1791},
                {year: 2006, Mining: 16943, Manufacturing: 10440, Construction: 4576, Commerce: 7114, Financial: 11764, OtherServices: 19861, Agriculture: 2919, Utilities: 1994},
                {year: 2007, Mining: 18574, Manufacturing: 10840, Construction: 5230, Commerce: 7860, Financial: 14243, OtherServices: 21715, Agriculture: 3086, Utilities: 1756},
                {year: 2008, Mining: 13165, Manufacturing: 10506, Construction: 6892, Commerce: 9166, Financial: 16312, OtherServices: 24232, Agriculture: 3117, Utilities: 2499},
                {year: 2009, Mining: 12670, Manufacturing: 10892, Construction: 7197, Commerce: 8841, Financial: 17166, OtherServices: 25866, Agriculture: 3167, Utilities: 3007},
                {year: 2010, Mining: 17743, Manufacturing: 12005, Construction: 7556, Commerce: 10403, Financial: 18742, OtherServices: 29072, Agriculture: 3539, Utilities: 3110},
                {year: 2011, Mining: 18071, Manufacturing: 13295, Construction: 8370, Commerce: 11478, Financial: 21525, OtherServices: 31301, Agriculture: 3989, Utilities: 3375},
                {year: 2012, Mining: 16621, Manufacturing: 13546, Construction: 9533, Commerce: 12931, Financial: 24156, OtherServices: 34395, Agriculture: 4015, Utilities: 3351},
                {year: 2013, Mining: 15144, Manufacturing: 15326, Construction: 8995, Commerce: 15068, Financial: 21625, OtherServices: 41823, Agriculture: 4663, Utilities: 3544},
                {year: 2014, Mining: 16214, Manufacturing: 16547, Construction: 9413, Commerce: 16609, Financial: 22503, OtherServices: 45140, Agriculture: 5838, Utilities: 3673},
                {year: 2015, Mining: 13689, Manufacturing: 18455, Construction: 10498, Commerce: 17950, Financial: 24030, OtherServices: 50394, Agriculture: 6003, Utilities: 4719},
                {year: 2016, Mining: 13661, Manufacturing: 18316, Construction: 11512, Commerce: 19540, Financial: 24711, OtherServices: 54815, Agriculture: 6814, Utilities: 5479},
                {year: 2017, Mining: 18135, Manufacturing: 18372, Construction: 11713, Commerce: 20321, Financial: 25534, OtherServices: 57678, Agriculture: 6894, Utilities: 5633},
                {year: 2018, Mining: 18813, Manufacturing: 20362, Construction: 12509, Commerce: 21959, Financial: 27949, OtherServices: 60797, Agriculture: 6967, Utilities: 5623},
                {year: 2019, Mining: 18613, Manufacturing: 19931, Construction: 13668, Commerce: 22411, Financial: 29506, OtherServices: 64592, Agriculture: 7033, Utilities: 5991},
                {year: 2020, Mining: 23315, Manufacturing: 18106, Construction: 12022, Commerce: 20563, Financial: 27292, OtherServices: 65543, Agriculture: 8142, Utilities: 6592},
                {year: 2021, Mining: 33784, Manufacturing: 20424, Construction: 13799, Commerce: 27109, Financial: 29229, OtherServices: 75380, Agriculture: 8394, Utilities: 5980},
                {year: 2022, Mining: 36909, Manufacturing: 24994, Construction: 15210, Commerce: 28560, Financial: 33381, OtherServices: 83017, Agriculture: 9135, Utilities: 5357},
                {year: 2023, Mining: 33579, Manufacturing: 25949, Construction: 16172, Commerce: 31435, Financial: 35523, OtherServices: 93457, Agriculture: 9923, Utilities: 7918},
                {year: 2024, Mining: 36600, Manufacturing: 28079, Construction: 17982, Commerce: 32592, Financial: 40838, OtherServices: 101325, Agriculture: 12192, Utilities: 11095}
            ],
            miningGDP: [
                {period: 'Avg 06-10', copper: 27892, other: 2000, share: 16.7},
                {period: '2011', copper: 33535, other: 3968, share: 14.8},
                {period: '2012', copper: 29693, other: 3676, share: 12.5},
                {period: '2013', copper: 27205, other: 3389, share: 11.0},
                {period: '2014', copper: 25861, other: 2580, share: 10.9},
                {period: '2015', copper: 19015, other: 1911, share: 8.6},
                {period: '2016', copper: 17731, other: 2434, share: 8.1},
                {period: '2017', copper: 24142, other: 2639, share: 9.7},
                {period: '2018', copper: 23394, other: 2897, share: 8.9},
                {period: '2019', copper: 20181, other: 2543, share: 8.2},
                {period: '2020', copper: 26539, other: 2899, share: 11.6},
                {period: '2021', copper: 40124, other: 4371, share: 14.1},
                {period: '2022', copper: 30153, other: 12125, share: 14.0},
                {period: '2023', copper: 29290, other: 10693, share: 11.9}
            ],
            companies: [
                {mine: "Escondida", company: "BHP", value: 1277.5},
                {mine: "Chuqui, RT y MH", company: "Codelco", value: 681.7},
                {mine: "Collahuasi", company: "Collahuasi", value: 558.6},
                {mine: "El Teniente", company: "Codelco", value: 356.4},
                {mine: "Los Pelambres", company: "Antofagasta Minerals", value: 331.2},
                {mine: "Spence", company: "BHP", value: 255.6},
                {mine: "Anglo American Sur", company: "Anglo American", value: 220.6},
                {mine: "Quebrada Blanca", company: "Teck", value: 207.8},
                {mine: "Andina", company: "Codelco", value: 181.6},
                {mine: "Candelaria", company: "Lundin Mining", value: 142.1},
                {mine: "Esperanza", company: "Antofagasta Minerals", value: 121.8},
                {mine: "Gaby", company: "Codelco", value: 103.1},
                {mine: "Anglo American Norte", company: "Anglo American", value: 102.3},
                {mine: "El Tesoro", company: "Antofagasta Minerals", value: 102.0},
                {mine: "El Abra", company: "Freeport-McMoRan", value: 99.1},
                {mine: "Zaldivar", company: "Antofagasta Minerals", value: 82.8},
                {mine: "Lomas Bayas", company: "Glencore", value: 74.4},
                {mine: "Salvador", company: "Codelco", value: 5.7}
            ],
            codelcoTrend: [
                {year: 2003, value: 1674}, {year: 2004, value: 1840}, {year: 2005, value: 1831},
                {year: 2006, value: 1783}, {year: 2007, value: 1665}, {year: 2008, value: 1548},
                {year: 2009, value: 1782}, {year: 2010, value: 1760}, {year: 2011, value: 1796},
                {year: 2012, value: 1758}, {year: 2013, value: 1792}, {year: 2014, value: 1841},
                {year: 2015, value: 1891}, {year: 2016, value: 1827}, {year: 2017, value: 1842},
                {year: 2018, value: 1807}, {year: 2019, value: 1706}, {year: 2020, value: 1727},
                {year: 2021, value: 1728}, {year: 2022, value: 1553}, {year: 2023, value: 1424},
                {year: 2024, value: 1429}
            ],
            companyTrends: [
                {year: 2003, BHP: 1126, Codelco: 1674, Collahuasi: 395, Antofagasta: 581, Anglo: 425},
                {year: 2004, BHP: 1315, Codelco: 1840, Collahuasi: 481, Antofagasta: 608, Anglo: 456},
                {year: 2005, BHP: 1362, Codelco: 1831, Collahuasi: 427, Antofagasta: 555, Anglo: 443},
                {year: 2006, BHP: 1375, Codelco: 1783, Collahuasi: 440, Antofagasta: 576, Anglo: 447},
                {year: 2007, BHP: 1711, Codelco: 1665, Collahuasi: 452, Antofagasta: 536, Anglo: 454},
                {year: 2008, BHP: 1523, Codelco: 1548, Collahuasi: 464, Antofagasta: 576, Anglo: 432},
                {year: 2009, BHP: 1360, Codelco: 1782, Collahuasi: 536, Antofagasta: 550, Anglo: 428},
                {year: 2010, BHP: 1354, Codelco: 1760, Collahuasi: 504, Antofagasta: 638, Anglo: 397},
                {year: 2011, BHP: 1093, Codelco: 1796, Collahuasi: 453, Antofagasta: 752, Anglo: 395},
                {year: 2012, BHP: 1316, Codelco: 1758, Collahuasi: 282, Antofagasta: 827, Anglo: 532},
                {year: 2013, BHP: 1419, Codelco: 1792, Collahuasi: 444, Antofagasta: 825, Anglo: 579},
                {year: 2014, BHP: 1421, Codelco: 1841, Collahuasi: 470, Antofagasta: 780, Anglo: 541},
                {year: 2015, BHP: 1403, Codelco: 1891, Collahuasi: 455, Antofagasta: 700, Anglo: 544},
                {year: 2016, BHP: 1243, Codelco: 1827, Collahuasi: 506, Antofagasta: 707, Anglo: 453},
                {year: 2017, BHP: 1190, Codelco: 1842, Collahuasi: 524, Antofagasta: 688, Anglo: 437},
                {year: 2018, BHP: 1485, Codelco: 1807, Collahuasi: 559, Antofagasta: 713, Anglo: 506},
                {year: 2019, BHP: 1453, Codelco: 1706, Collahuasi: 565, Antofagasta: 769, Anglo: 476},
                {year: 2020, BHP: 1403, Codelco: 1727, Collahuasi: 629, Antofagasta: 715, Anglo: 449},
                {year: 2021, BHP: 1272, Codelco: 1728, Collahuasi: 630, Antofagasta: 698, Anglo: 465},
                {year: 2022, BHP: 1351, Codelco: 1553, Collahuasi: 571, Antofagasta: 621, Anglo: 409},
                {year: 2023, BHP: 1386, Codelco: 1424, Collahuasi: 573, Antofagasta: 633, Anglo: 341},
                {year: 2024, BHP: 1533, Codelco: 1429, Collahuasi: 559, Antofagasta: 638, Anglo: 323}
            ],
            mineYearlyData: {
                'Codelco': [
                    {name: 'Chuqui, RT y MH', color: '#e74c3c', data: [{year: 2003, value: 907.2}, {year: 2004, value: 982.8}, {year: 2005, value: 964.9}, {year: 2006, value: 940.6}, {year: 2007, value: 896.3}, {year: 2008, value: 755.3}, {year: 2009, value: 874.7}, {year: 2010, value: 903.7}, {year: 2011, value: 913.5}, {year: 2012, value: 783.7}, {year: 2013, value: 752.1}, {year: 2014, value: 808.9}, {year: 2015, value: 862.6}, {year: 2016, value: 857.3}, {year: 2017, value: 864.9}, {year: 2018, value: 848.9}, {year: 2019, value: 803.5}, {year: 2020, value: 831.9}, {year: 2021, value: 827.4}, {year: 2022, value: 721.6}, {year: 2023, value: 689.3}, {year: 2024, value: 681.7}]},
                    {name: 'El Teniente', color: '#3498db', data: [{year: 2003, value: 339.4}, {year: 2004, value: 435.6}, {year: 2005, value: 437.4}, {year: 2006, value: 418.3}, {year: 2007, value: 404.7}, {year: 2008, value: 381.2}, {year: 2009, value: 404.1}, {year: 2010, value: 403.6}, {year: 2011, value: 400.3}, {year: 2012, value: 417.2}, {year: 2013, value: 450.4}, {year: 2014, value: 455.5}, {year: 2015, value: 471.2}, {year: 2016, value: 475.3}, {year: 2017, value: 464.3}, {year: 2018, value: 465.0}, {year: 2019, value: 459.7}, {year: 2020, value: 443.2}, {year: 2021, value: 459.8}, {year: 2022, value: 405.4}, {year: 2023, value: 351.9}, {year: 2024, value: 356.4}]},
                    {name: 'Andina', color: '#2ecc71', data: [{year: 2003, value: 235.8}, {year: 2004, value: 239.9}, {year: 2005, value: 248.2}, {year: 2006, value: 236.4}, {year: 2007, value: 218.4}, {year: 2008, value: 219.5}, {year: 2009, value: 209.7}, {year: 2010, value: 188.5}, {year: 2011, value: 234.4}, {year: 2012, value: 249.9}, {year: 2013, value: 236.7}, {year: 2014, value: 232.4}, {year: 2015, value: 224.3}, {year: 2016, value: 193.4}, {year: 2017, value: 220.0}, {year: 2018, value: 195.5}, {year: 2019, value: 170.3}, {year: 2020, value: 184.5}, {year: 2021, value: 177.3}, {year: 2022, value: 177.0}, {year: 2023, value: 164.5}, {year: 2024, value: 181.6}]},
                    {name: 'Gaby', color: '#f39c12', data: [{year: 2003, value: 0.0}, {year: 2004, value: 0.0}, {year: 2005, value: 0.0}, {year: 2006, value: 0.0}, {year: 2007, value: 0.0}, {year: 2008, value: 67.7}, {year: 2009, value: 148.0}, {year: 2010, value: 117.1}, {year: 2011, value: 118.0}, {year: 2012, value: 133.0}, {year: 2013, value: 128.2}, {year: 2014, value: 121.0}, {year: 2015, value: 125.0}, {year: 2016, value: 121.7}, {year: 2017, value: 122.7}, {year: 2018, value: 107.3}, {year: 2019, value: 104.1}, {year: 2020, value: 102.1}, {year: 2021, value: 100.9}, {year: 2022, value: 109.5}, {year: 2023, value: 105.8}, {year: 2024, value: 103.1}]},
                    {name: 'Salvador', color: '#9b59b6', data: [{year: 2003, value: 80.1}, {year: 2004, value: 74.9}, {year: 2005, value: 77.5}, {year: 2006, value: 80.6}, {year: 2007, value: 63.9}, {year: 2008, value: 42.7}, {year: 2009, value: 65.5}, {year: 2010, value: 76.2}, {year: 2011, value: 69.0}, {year: 2012, value: 62.7}, {year: 2013, value: 54.3}, {year: 2014, value: 54.0}, {year: 2015, value: 48.6}, {year: 2016, value: 59.8}, {year: 2017, value: 62.0}, {year: 2018, value: 60.8}, {year: 2019, value: 50.6}, {year: 2020, value: 56.3}, {year: 2021, value: 52.9}, {year: 2022, value: 32.1}, {year: 2023, value: 13.0}, {year: 2024, value: 5.7}]}
                ],
                'BHP': [
                    {name: 'Escondida', color: '#3498db', data: [{year: 2003, value: 994.7}, {year: 2004, value: 1195.1}, {year: 2005, value: 1271.5}, {year: 2006, value: 1255.6}, {year: 2007, value: 1483.9}, {year: 2008, value: 1254.0}, {year: 2009, value: 1103.7}, {year: 2010, value: 1086.7}, {year: 2011, value: 817.7}, {year: 2012, value: 1075.9}, {year: 2013, value: 1193.7}, {year: 2014, value: 1165.4}, {year: 2015, value: 1152.5}, {year: 2016, value: 1002.0}, {year: 2017, value: 925.4}, {year: 2018, value: 1242.7}, {year: 2019, value: 1187.8}, {year: 2020, value: 1187.3}, {year: 2021, value: 1011.4}, {year: 2022, value: 1054.2}, {year: 2023, value: 1101.4}, {year: 2024, value: 1277.5}]},
                    {name: 'Spence', color: '#2ecc71', data: [{year: 2003, value: 0.0}, {year: 2004, value: 0.0}, {year: 2005, value: 0.0}, {year: 2006, value: 4.3}, {year: 2007, value: 128.1}, {year: 2008, value: 164.8}, {year: 2009, value: 162.3}, {year: 2010, value: 178.1}, {year: 2011, value: 181.0}, {year: 2012, value: 166.7}, {year: 2013, value: 151.6}, {year: 2014, value: 176.1}, {year: 2015, value: 175.6}, {year: 2016, value: 167.4}, {year: 2017, value: 198.6}, {year: 2018, value: 176.4}, {year: 2019, value: 193.4}, {year: 2020, value: 146.7}, {year: 2021, value: 203.1}, {year: 2022, value: 245.5}, {year: 2023, value: 249.0}, {year: 2024, value: 255.6}]},
                    {name: 'Cerro Colorado', color: '#e74c3c', data: [{year: 2003, value: 131.5}, {year: 2004, value: 119.5}, {year: 2005, value: 90.4}, {year: 2006, value: 115.5}, {year: 2007, value: 98.7}, {year: 2008, value: 104.2}, {year: 2009, value: 93.7}, {year: 2010, value: 89.0}, {year: 2011, value: 94.3}, {year: 2012, value: 73.1}, {year: 2013, value: 73.6}, {year: 2014, value: 79.6}, {year: 2015, value: 74.4}, {year: 2016, value: 74.0}, {year: 2017, value: 66.2}, {year: 2018, value: 66.2}, {year: 2019, value: 71.7}, {year: 2020, value: 68.9}, {year: 2021, value: 57.4}, {year: 2022, value: 51.4}, {year: 2023, value: 35.4}, {year: 2024, value: 0.0}]}
                ],
                'Antofagasta Minerals': [
                    {name: 'Los Pelambres', color: '#3498db', data: [{year: 2003, value: 337.8}, {year: 2004, value: 362.6}, {year: 2005, value: 333.8}, {year: 2006, value: 335.2}, {year: 2007, value: 300.1}, {year: 2008, value: 351.2}, {year: 2009, value: 322.6}, {year: 2010, value: 398.0}, {year: 2011, value: 426.1}, {year: 2012, value: 417.7}, {year: 2013, value: 419.2}, {year: 2014, value: 404.6}, {year: 2015, value: 375.8}, {year: 2016, value: 367.8}, {year: 2017, value: 356.3}, {year: 2018, value: 370.5}, {year: 2019, value: 375.9}, {year: 2020, value: 372.1}, {year: 2021, value: 336.3}, {year: 2022, value: 284.1}, {year: 2023, value: 310.6}, {year: 2024, value: 331.2}]},
                    {name: 'Esperanza', color: '#2ecc71', data: [{year: 2003, value: 0.0}, {year: 2004, value: 0.0}, {year: 2005, value: 0.0}, {year: 2006, value: 0.0}, {year: 2007, value: 0.0}, {year: 2008, value: 0.0}, {year: 2009, value: 0.0}, {year: 2010, value: 0.0}, {year: 2011, value: 96.6}, {year: 2012, value: 173.2}, {year: 2013, value: 177.1}, {year: 2014, value: 180.7}, {year: 2015, value: 145.2}, {year: 2016, value: 180.4}, {year: 2017, value: 163.8}, {year: 2018, value: 155.4}, {year: 2019, value: 195.5}, {year: 2020, value: 153.5}, {year: 2021, value: 185.4}, {year: 2022, value: 149.4}, {year: 2023, value: 162.7}, {year: 2024, value: 121.8}]},
                    {name: 'Zaldivar', color: '#f39c12', data: [{year: 2003, value: 150.5}, {year: 2004, value: 147.6}, {year: 2005, value: 123.3}, {year: 2006, value: 146.3}, {year: 2007, value: 142.9}, {year: 2008, value: 133.5}, {year: 2009, value: 137.0}, {year: 2010, value: 144.4}, {year: 2011, value: 132.3}, {year: 2012, value: 131.1}, {year: 2013, value: 126.5}, {year: 2014, value: 100.6}, {year: 2015, value: 103.4}, {year: 2016, value: 103.4}, {year: 2017, value: 103.3}, {year: 2018, value: 94.5}, {year: 2019, value: 116.1}, {year: 2020, value: 96.5}, {year: 2021, value: 88.0}, {year: 2022, value: 88.9}, {year: 2023, value: 80.9}, {year: 2024, value: 82.8}]},
                    {name: 'El Tesoro', color: '#e74c3c', data: [{year: 2003, value: 92.4}, {year: 2004, value: 97.8}, {year: 2005, value: 98.1}, {year: 2006, value: 94.0}, {year: 2007, value: 93.0}, {year: 2008, value: 90.8}, {year: 2009, value: 90.2}, {year: 2010, value: 95.3}, {year: 2011, value: 97.1}, {year: 2012, value: 105.0}, {year: 2013, value: 102.6}, {year: 2014, value: 93.8}, {year: 2015, value: 75.9}, {year: 2016, value: 55.8}, {year: 2017, value: 64.5}, {year: 2018, value: 92.6}, {year: 2019, value: 81.1}, {year: 2020, value: 93.3}, {year: 2021, value: 88.8}, {year: 2022, value: 98.2}, {year: 2023, value: 79.3}, {year: 2024, value: 102.0}]}
                ],
                'Collahuasi': [
                    {name: 'Collahuasi', color: '#f39c12', data: [{year: 2003, value: 394.7}, {year: 2004, value: 481.0}, {year: 2005, value: 427.0}, {year: 2006, value: 440.0}, {year: 2007, value: 452.0}, {year: 2008, value: 464.4}, {year: 2009, value: 535.9}, {year: 2010, value: 504.0}, {year: 2011, value: 453.3}, {year: 2012, value: 282.1}, {year: 2013, value: 444.5}, {year: 2014, value: 470.4}, {year: 2015, value: 455.3}, {year: 2016, value: 506.5}, {year: 2017, value: 524.0}, {year: 2018, value: 559.2}, {year: 2019, value: 565.4}, {year: 2020, value: 629.1}, {year: 2021, value: 630.0}, {year: 2022, value: 570.8}, {year: 2023, value: 573.2}, {year: 2024, value: 558.6}]}
                ],
                'Anglo American': [
                    {name: 'Anglo Sur', color: '#9b59b6', data: [{year: 2003, value: 277.9}, {year: 2004, value: 300.6}, {year: 2005, value: 293.7}, {year: 2006, value: 294.8}, {year: 2007, value: 302.1}, {year: 2008, value: 283.5}, {year: 2009, value: 276.9}, {year: 2010, value: 257.7}, {year: 2011, value: 264.0}, {year: 2012, value: 416.6}, {year: 2013, value: 467.3}, {year: 2014, value: 436.9}, {year: 2015, value: 437.8}, {year: 2016, value: 354.2}, {year: 2017, value: 348.7}, {year: 2018, value: 422.2}, {year: 2019, value: 389.2}, {year: 2020, value: 370.5}, {year: 2021, value: 370.0}, {year: 2022, value: 311.0}, {year: 2023, value: 255.0}, {year: 2024, value: 220.6}]},
                    {name: 'Anglo Norte', color: '#1abc9c', data: [{year: 2003, value: 147.1}, {year: 2004, value: 155.0}, {year: 2005, value: 149.7}, {year: 2006, value: 152.1}, {year: 2007, value: 151.6}, {year: 2008, value: 148.9}, {year: 2009, value: 151.6}, {year: 2010, value: 139.6}, {year: 2011, value: 130.9}, {year: 2012, value: 115.0}, {year: 2013, value: 111.3}, {year: 2014, value: 104.2}, {year: 2015, value: 106.3}, {year: 2016, value: 99.1}, {year: 2017, value: 87.8}, {year: 2018, value: 83.5}, {year: 2019, value: 86.3}, {year: 2020, value: 78.6}, {year: 2021, value: 94.7}, {year: 2022, value: 98.0}, {year: 2023, value: 85.5}, {year: 2024, value: 102.3}]}
                ],
                'Freeport-McMoRan': [
                    {name: 'El Abra', color: '#e74c3c', data: [{year: 2003, value: 226.6}, {year: 2004, value: 218.0}, {year: 2005, value: 210.6}, {year: 2006, value: 218.6}, {year: 2007, value: 166.0}, {year: 2008, value: 165.8}, {year: 2009, value: 164.1}, {year: 2010, value: 145.2}, {year: 2011, value: 123.4}, {year: 2012, value: 153.7}, {year: 2013, value: 155.6}, {year: 2014, value: 166.4}, {year: 2015, value: 147.2}, {year: 2016, value: 99.9}, {year: 2017, value: 78.4}, {year: 2018, value: 91.3}, {year: 2019, value: 81.9}, {year: 2020, value: 71.9}, {year: 2021, value: 72.6}, {year: 2022, value: 91.7}, {year: 2023, value: 98.4}, {year: 2024, value: 99.1}]}
                ],
                'Lundin Mining': [
                    {name: 'Candelaria', color: '#1abc9c', data: [{year: 2003, value: 212.7}, {year: 2004, value: 200.0}, {year: 2005, value: 162.7}, {year: 2006, value: 169.6}, {year: 2007, value: 181.0}, {year: 2008, value: 173.5}, {year: 2009, value: 134.2}, {year: 2010, value: 136.4}, {year: 2011, value: 148.4}, {year: 2012, value: 122.8}, {year: 2013, value: 168.0}, {year: 2014, value: 134.7}, {year: 2015, value: 150.2}, {year: 2016, value: 135.4}, {year: 2017, value: 150.3}, {year: 2018, value: 101.7}, {year: 2019, value: 111.4}, {year: 2020, value: 94.8}, {year: 2021, value: 118.6}, {year: 2022, value: 126.3}, {year: 2023, value: 130.9}, {year: 2024, value: 142.1}]}
                ],
                'Teck': [
                    {name: 'Quebrada Blanca', color: '#e67e22', data: [{year: 2003, value: 80.1}, {year: 2004, value: 76.3}, {year: 2005, value: 81.0}, {year: 2006, value: 82.4}, {year: 2007, value: 82.9}, {year: 2008, value: 85.4}, {year: 2009, value: 87.4}, {year: 2010, value: 86.2}, {year: 2011, value: 63.4}, {year: 2012, value: 62.4}, {year: 2013, value: 56.2}, {year: 2014, value: 48.1}, {year: 2015, value: 39.1}, {year: 2016, value: 34.7}, {year: 2017, value: 23.4}, {year: 2018, value: 25.5}, {year: 2019, value: 21.1}, {year: 2020, value: 13.4}, {year: 2021, value: 11.6}, {year: 2022, value: 9.5}, {year: 2023, value: 64.3}, {year: 2024, value: 207.8}]}
                ],
                'Glencore': [
                    {name: 'Lomas Bayas', color: '#5d7a8c', data: [{year: 2003, value: 60.4}, {year: 2004, value: 62.0}, {year: 2005, value: 63.2}, {year: 2006, value: 64.3}, {year: 2007, value: 61.5}, {year: 2008, value: 59.2}, {year: 2009, value: 73.1}, {year: 2010, value: 71.8}, {year: 2011, value: 73.6}, {year: 2012, value: 73.3}, {year: 2013, value: 74.2}, {year: 2014, value: 66.4}, {year: 2015, value: 70.6}, {year: 2016, value: 80.1}, {year: 2017, value: 78.0}, {year: 2018, value: 72.7}, {year: 2019, value: 78.9}, {year: 2020, value: 73.9}, {year: 2021, value: 64.3}, {year: 2022, value: 72.5}, {year: 2023, value: 65.8}, {year: 2024, value: 74.4}]}
                ]
            },
            chinaExports: [
                {year: 2010, value: 1785, share: 32.8}, {year: 2011, value: 1649, share: 32.5}, {year: 2012, value: 1648, share: 31.5},
                {year: 2013, value: 2094, share: 37.5}, {year: 2014, value: 2206, share: 38.6}, {year: 2015, value: 2485, share: 42.9},
                {year: 2016, value: 2764, share: 46.9}, {year: 2017, value: 2444, share: 42.6}, {year: 2018, value: 3136, share: 52.0},
                {year: 2019, value: 2948, share: 49.6}, {year: 2020, value: 3253, share: 55.7}, {year: 2021, value: 3124, share: 54.3},
                {year: 2022, value: 3000, share: 58.2}, {year: 2023, value: 3153, share: 57.5}, {year: 2024, value: 3148, share: 53.7}
            ],
            monthlyProduction: [
                {year: 2003, month: 1, total: 391.5, codelco: 123.8, escondida: 78.0, collahuasi: 35.8, chuqui: 74.1, pelambres: 26.2},
                {year: 2003, month: 2, total: 371.9, codelco: 121.8, escondida: 80.6, collahuasi: 32.5, chuqui: 62.3, pelambres: 22.7},
                {year: 2003, month: 3, total: 422.6, codelco: 145.9, escondida: 90.4, collahuasi: 35.3, chuqui: 84.7, pelambres: 25.0},
                {year: 2003, month: 4, total: 387.1, codelco: 134.6, escondida: 74.9, collahuasi: 32.4, chuqui: 74.7, pelambres: 28.4},
                {year: 2003, month: 5, total: 408.8, codelco: 135.1, escondida: 83.5, collahuasi: 36.2, chuqui: 69.2, pelambres: 27.6},
                {year: 2003, month: 6, total: 416.4, codelco: 130.8, escondida: 106.6, collahuasi: 33.3, chuqui: 70.4, pelambres: 30.6},
                {year: 2003, month: 7, total: 427.4, codelco: 146.9, escondida: 85.5, collahuasi: 35.5, chuqui: 80.2, pelambres: 34.8},
                {year: 2003, month: 8, total: 388.6, codelco: 135.2, escondida: 73.1, collahuasi: 29.5, chuqui: 69.2, pelambres: 25.1},
                {year: 2003, month: 9, total: 397.8, codelco: 125.3, escondida: 87.5, collahuasi: 29.7, chuqui: 59.4, pelambres: 29.3},
                {year: 2003, month: 10, total: 423.8, codelco: 144.3, escondida: 88.6, collahuasi: 32.0, chuqui: 69.9, pelambres: 29.3},
                {year: 2003, month: 11, total: 410.8, codelco: 147.0, escondida: 72.7, collahuasi: 30.4, chuqui: 75.8, pelambres: 29.2},
                {year: 2003, month: 12, total: 457.5, codelco: 182.8, escondida: 73.3, collahuasi: 32.1, chuqui: 117.3, pelambres: 29.6},
                {year: 2004, month: 1, total: 384.7, codelco: 108.3, escondida: 95.8, collahuasi: 29.7, chuqui: 45.9, pelambres: 21.2},
                {year: 2004, month: 2, total: 387.1, codelco: 122.4, escondida: 89.5, collahuasi: 29.3, chuqui: 56.5, pelambres: 24.4},
                {year: 2004, month: 3, total: 438.1, codelco: 161.1, escondida: 88.0, collahuasi: 23.8, chuqui: 91.8, pelambres: 29.1},
                {year: 2004, month: 4, total: 436.0, codelco: 143.8, escondida: 105.5, collahuasi: 32.2, chuqui: 84.3, pelambres: 26.4},
                {year: 2004, month: 5, total: 453.6, codelco: 147.8, escondida: 110.6, collahuasi: 37.1, chuqui: 81.2, pelambres: 32.3},
                {year: 2004, month: 6, total: 448.8, codelco: 139.7, escondida: 108.5, collahuasi: 39.6, chuqui: 72.1, pelambres: 37.2},
                {year: 2004, month: 7, total: 474.4, codelco: 163.0, escondida: 97.5, collahuasi: 53.3, chuqui: 83.0, pelambres: 32.5},
                {year: 2004, month: 8, total: 465.8, codelco: 158.4, escondida: 101.5, collahuasi: 49.8, chuqui: 79.9, pelambres: 34.1},
                {year: 2004, month: 9, total: 451.6, codelco: 154.9, escondida: 96.0, collahuasi: 49.6, chuqui: 82.9, pelambres: 30.2},
                {year: 2004, month: 10, total: 486.9, codelco: 174.1, escondida: 100.7, collahuasi: 50.8, chuqui: 100.1, pelambres: 30.4},
                {year: 2004, month: 11, total: 467.5, codelco: 161.8, escondida: 102.4, collahuasi: 41.9, chuqui: 85.1, pelambres: 33.4},
                {year: 2004, month: 12, total: 518.0, codelco: 204.6, escondida: 99.1, collahuasi: 43.9, chuqui: 120.0, pelambres: 31.4},
                {year: 2005, month: 1, total: 430.4, codelco: 118.9, escondida: 109.8, collahuasi: 41.3, chuqui: 55.9, pelambres: 26.7},
                {year: 2005, month: 2, total: 367.0, codelco: 118.4, escondida: 72.9, collahuasi: 29.7, chuqui: 50.9, pelambres: 27.2},
                {year: 2005, month: 3, total: 447.2, codelco: 149.2, escondida: 99.0, collahuasi: 39.1, chuqui: 79.2, pelambres: 29.5},
                {year: 2005, month: 4, total: 408.7, codelco: 141.2, escondida: 90.9, collahuasi: 29.1, chuqui: 66.0, pelambres: 25.4},
                {year: 2005, month: 5, total: 456.0, codelco: 156.0, escondida: 107.7, collahuasi: 39.0, chuqui: 80.3, pelambres: 28.2},
                {year: 2005, month: 6, total: 407.2, codelco: 129.0, escondida: 115.4, collahuasi: 33.2, chuqui: 61.3, pelambres: 23.2},
                {year: 2005, month: 7, total: 417.8, codelco: 135.0, escondida: 106.0, collahuasi: 38.4, chuqui: 68.1, pelambres: 25.9},
                {year: 2005, month: 8, total: 469.5, codelco: 162.3, escondida: 123.6, collahuasi: 35.1, chuqui: 95.0, pelambres: 29.0},
                {year: 2005, month: 9, total: 431.9, codelco: 151.5, escondida: 107.5, collahuasi: 29.7, chuqui: 84.0, pelambres: 28.8},
                {year: 2005, month: 10, total: 456.1, codelco: 161.3, escondida: 111.1, collahuasi: 32.4, chuqui: 84.1, pelambres: 28.3},
                {year: 2005, month: 11, total: 479.1, codelco: 180.7, escondida: 107.7, collahuasi: 37.8, chuqui: 98.7, pelambres: 29.4},
                {year: 2005, month: 12, total: 549.6, codelco: 227.7, escondida: 119.9, collahuasi: 42.2, chuqui: 141.4, pelambres: 32.2},
                {year: 2006, month: 1, total: 415.1, codelco: 115.2, escondida: 113.7, collahuasi: 37.6, chuqui: 51.0, pelambres: 25.4},
                {year: 2006, month: 2, total: 388.3, codelco: 119.4, escondida: 100.0, collahuasi: 29.9, chuqui: 60.6, pelambres: 23.8},
                {year: 2006, month: 3, total: 441.0, codelco: 142.2, escondida: 115.4, collahuasi: 26.2, chuqui: 78.2, pelambres: 27.4},
                {year: 2006, month: 4, total: 443.6, codelco: 150.6, escondida: 106.6, collahuasi: 40.5, chuqui: 82.5, pelambres: 24.4},
                {year: 2006, month: 5, total: 459.1, codelco: 166.2, escondida: 117.7, collahuasi: 36.3, chuqui: 86.7, pelambres: 9.1},
                {year: 2006, month: 6, total: 447.9, codelco: 159.5, escondida: 93.1, collahuasi: 36.1, chuqui: 86.8, pelambres: 36.3},
                {year: 2006, month: 7, total: 459.8, codelco: 143.8, escondida: 104.8, collahuasi: 48.5, chuqui: 70.3, pelambres: 32.1},
                {year: 2006, month: 8, total: 411.7, codelco: 143.1, escondida: 64.3, collahuasi: 44.1, chuqui: 73.5, pelambres: 28.8},
                {year: 2006, month: 9, total: 392.5, codelco: 93.6, escondida: 94.4, collahuasi: 41.8, chuqui: 21.4, pelambres: 31.0},
                {year: 2006, month: 10, total: 490.5, codelco: 176.5, escondida: 117.2, collahuasi: 39.2, chuqui: 106.0, pelambres: 26.0},
                {year: 2006, month: 11, total: 479.0, codelco: 177.2, escondida: 109.1, collahuasi: 27.3, chuqui: 105.8, pelambres: 32.3},
                {year: 2006, month: 12, total: 532.3, codelco: 195.8, escondida: 119.3, collahuasi: 32.5, chuqui: 117.8, pelambres: 38.6},
                {year: 2007, month: 1, total: 445.2, codelco: 129.9, escondida: 123.8, collahuasi: 24.1, chuqui: 74.2, pelambres: 27.4},
                {year: 2007, month: 2, total: 388.8, codelco: 107.4, escondida: 112.4, collahuasi: 19.8, chuqui: 48.0, pelambres: 22.6},
                {year: 2007, month: 3, total: 498.1, codelco: 144.9, escondida: 150.4, collahuasi: 33.0, chuqui: 69.8, pelambres: 23.1},
                {year: 2007, month: 4, total: 454.9, codelco: 145.8, escondida: 117.1, collahuasi: 35.8, chuqui: 75.9, pelambres: 23.2},
                {year: 2007, month: 5, total: 476.1, codelco: 142.5, escondida: 130.3, collahuasi: 38.1, chuqui: 73.4, pelambres: 27.1},
                {year: 2007, month: 6, total: 457.9, codelco: 134.0, escondida: 124.7, collahuasi: 39.2, chuqui: 75.3, pelambres: 23.2},
                {year: 2007, month: 7, total: 451.8, codelco: 120.7, escondida: 129.7, collahuasi: 41.5, chuqui: 72.0, pelambres: 25.6},
                {year: 2007, month: 8, total: 427.5, codelco: 120.3, escondida: 108.2, collahuasi: 44.8, chuqui: 68.4, pelambres: 19.7},
                {year: 2007, month: 9, total: 474.5, codelco: 155.9, escondida: 115.8, collahuasi: 43.5, chuqui: 84.2, pelambres: 23.6},
                {year: 2007, month: 10, total: 482.0, codelco: 145.6, escondida: 120.9, collahuasi: 43.0, chuqui: 75.0, pelambres: 26.1},
                {year: 2007, month: 11, total: 469.0, codelco: 150.1, escondida: 108.3, collahuasi: 42.0, chuqui: 86.1, pelambres: 26.8},
                {year: 2007, month: 12, total: 531.2, codelco: 167.6, escondida: 142.3, collahuasi: 47.2, chuqui: 94.0, pelambres: 31.7},
                {year: 2008, month: 1, total: 437.0, codelco: 117.8, escondida: 116.1, collahuasi: 41.5, chuqui: 55.8, pelambres: 23.6},
                {year: 2008, month: 2, total: 419.4, codelco: 124.4, escondida: 101.0, collahuasi: 32.5, chuqui: 62.8, pelambres: 28.3},
                {year: 2008, month: 3, total: 453.2, codelco: 124.4, escondida: 116.6, collahuasi: 36.1, chuqui: 65.5, pelambres: 30.1},
                {year: 2008, month: 4, total: 430.0, codelco: 105.2, escondida: 113.6, collahuasi: 42.6, chuqui: 66.0, pelambres: 26.4},
                {year: 2008, month: 5, total: 465.9, codelco: 124.1, escondida: 131.5, collahuasi: 35.8, chuqui: 70.6, pelambres: 29.1},
                {year: 2008, month: 6, total: 472.0, codelco: 123.5, escondida: 145.4, collahuasi: 35.3, chuqui: 60.0, pelambres: 32.2},
                {year: 2008, month: 7, total: 431.6, codelco: 131.5, escondida: 91.2, collahuasi: 37.0, chuqui: 56.0, pelambres: 31.1},
                {year: 2008, month: 8, total: 424.2, codelco: 127.5, escondida: 88.0, collahuasi: 36.1, chuqui: 56.2, pelambres: 29.9},
                {year: 2008, month: 9, total: 419.9, codelco: 129.0, escondida: 92.6, collahuasi: 33.7, chuqui: 58.7, pelambres: 32.1},
                {year: 2008, month: 10, total: 455.7, codelco: 142.9, escondida: 84.5, collahuasi: 42.3, chuqui: 63.9, pelambres: 32.3},
                {year: 2008, month: 11, total: 436.2, codelco: 134.8, escondida: 83.3, collahuasi: 44.7, chuqui: 61.1, pelambres: 26.2},
                {year: 2008, month: 12, total: 482.5, codelco: 162.7, escondida: 90.2, collahuasi: 46.8, chuqui: 78.7, pelambres: 29.9},
                {year: 2009, month: 1, total: 430.4, codelco: 129.2, escondida: 84.7, collahuasi: 44.3, chuqui: 55.8, pelambres: 29.2},
                {year: 2009, month: 2, total: 376.7, codelco: 122.5, escondida: 72.6, collahuasi: 33.4, chuqui: 52.4, pelambres: 24.3},
                {year: 2009, month: 3, total: 426.1, codelco: 138.6, escondida: 77.0, collahuasi: 41.6, chuqui: 67.4, pelambres: 29.5},
                {year: 2009, month: 4, total: 425.5, codelco: 138.4, escondida: 78.2, collahuasi: 41.5, chuqui: 65.0, pelambres: 26.7},
                {year: 2009, month: 5, total: 456.2, codelco: 142.7, escondida: 98.7, collahuasi: 45.3, chuqui: 71.6, pelambres: 27.4},
                {year: 2009, month: 6, total: 466.2, codelco: 151.0, escondida: 109.8, collahuasi: 41.8, chuqui: 78.3, pelambres: 26.0},
                {year: 2009, month: 7, total: 421.6, codelco: 145.9, escondida: 69.5, collahuasi: 40.2, chuqui: 68.5, pelambres: 29.0},
                {year: 2009, month: 8, total: 460.2, codelco: 150.1, escondida: 100.2, collahuasi: 41.7, chuqui: 72.3, pelambres: 26.5},
                {year: 2009, month: 9, total: 463.6, codelco: 155.4, escondida: 97.5, collahuasi: 46.5, chuqui: 81.3, pelambres: 21.2},
                {year: 2009, month: 10, total: 495.1, codelco: 174.7, escondida: 103.9, collahuasi: 53.4, chuqui: 91.7, pelambres: 25.2},
                {year: 2009, month: 11, total: 466.4, codelco: 162.8, escondida: 101.3, collahuasi: 47.6, chuqui: 80.8, pelambres: 27.1},
                {year: 2009, month: 12, total: 506.4, codelco: 171.3, escondida: 110.3, collahuasi: 58.6, chuqui: 89.6, pelambres: 30.5},
                {year: 2010, month: 1, total: 426.5, codelco: 123.3, escondida: 87.0, collahuasi: 49.8, chuqui: 60.6, pelambres: 30.8},
                {year: 2010, month: 2, total: 393.6, codelco: 127.6, escondida: 73.4, collahuasi: 45.2, chuqui: 64.5, pelambres: 24.5},
                {year: 2010, month: 3, total: 452.0, codelco: 151.2, escondida: 85.2, collahuasi: 46.4, chuqui: 80.1, pelambres: 31.2},
                {year: 2010, month: 4, total: 452.8, codelco: 137.9, escondida: 99.2, collahuasi: 47.9, chuqui: 78.0, pelambres: 32.8},
                {year: 2010, month: 5, total: 433.7, codelco: 151.5, escondida: 71.3, collahuasi: 32.9, chuqui: 82.1, pelambres: 38.3},
                {year: 2010, month: 6, total: 470.2, codelco: 144.2, escondida: 109.9, collahuasi: 44.5, chuqui: 74.3, pelambres: 35.0},
                {year: 2010, month: 7, total: 452.2, codelco: 141.2, escondida: 91.0, collahuasi: 45.6, chuqui: 70.8, pelambres: 33.9},
                {year: 2010, month: 8, total: 466.8, codelco: 151.1, escondida: 96.2, collahuasi: 33.5, chuqui: 75.1, pelambres: 41.4},
                {year: 2010, month: 9, total: 444.0, codelco: 134.4, escondida: 90.1, collahuasi: 43.2, chuqui: 64.2, pelambres: 34.6},
                {year: 2010, month: 10, total: 461.3, codelco: 154.9, escondida: 86.6, collahuasi: 40.6, chuqui: 78.7, pelambres: 36.1},
                {year: 2010, month: 11, total: 468.6, codelco: 158.2, escondida: 96.4, collahuasi: 36.3, chuqui: 80.2, pelambres: 32.0},
                {year: 2010, month: 12, total: 497.2, codelco: 184.7, escondida: 100.4, collahuasi: 38.1, chuqui: 95.1, pelambres: 27.4},
                {year: 2011, month: 1, total: 449.9, codelco: 156.9, escondida: 82.2, collahuasi: 36.4, chuqui: 83.8, pelambres: 33.5},
                {year: 2011, month: 2, total: 368.3, codelco: 109.1, escondida: 73.8, collahuasi: 32.8, chuqui: 53.6, pelambres: 28.6},
                {year: 2011, month: 3, total: 446.6, codelco: 158.8, escondida: 77.6, collahuasi: 40.3, chuqui: 84.8, pelambres: 32.3},
                {year: 2011, month: 4, total: 436.3, codelco: 143.0, escondida: 69.5, collahuasi: 44.7, chuqui: 77.1, pelambres: 36.5},
                {year: 2011, month: 5, total: 443.7, codelco: 138.7, escondida: 74.3, collahuasi: 43.3, chuqui: 61.2, pelambres: 33.9},
                {year: 2011, month: 6, total: 427.1, codelco: 137.2, escondida: 73.3, collahuasi: 37.0, chuqui: 75.6, pelambres: 34.4},
                {year: 2011, month: 7, total: 372.4, codelco: 131.1, escondida: 35.1, collahuasi: 32.3, chuqui: 77.7, pelambres: 34.3},
                {year: 2011, month: 8, total: 426.5, codelco: 162.6, escondida: 42.5, collahuasi: 36.9, chuqui: 87.7, pelambres: 39.1},
                {year: 2011, month: 9, total: 438.1, codelco: 154.7, escondida: 69.6, collahuasi: 35.1, chuqui: 76.4, pelambres: 35.2},
                {year: 2011, month: 10, total: 469.5, codelco: 155.3, escondida: 73.5, collahuasi: 43.3, chuqui: 71.7, pelambres: 36.5},
                {year: 2011, month: 11, total: 463.7, codelco: 157.5, escondida: 71.5, collahuasi: 32.4, chuqui: 70.6, pelambres: 37.1},
                {year: 2011, month: 12, total: 520.7, codelco: 191.3, escondida: 74.8, collahuasi: 38.8, chuqui: 93.3, pelambres: 44.7},
                {year: 2012, month: 1, total: 431.0, codelco: 124.7, escondida: 75.7, collahuasi: 32.1, chuqui: 52.3, pelambres: 35.1},
                {year: 2012, month: 2, total: 405.8, codelco: 123.6, escondida: 79.4, collahuasi: 20.9, chuqui: 50.3, pelambres: 32.4},
                {year: 2012, month: 3, total: 441.9, codelco: 142.4, escondida: 85.1, collahuasi: 23.7, chuqui: 63.9, pelambres: 31.7},
                {year: 2012, month: 4, total: 443.9, codelco: 135.7, escondida: 88.7, collahuasi: 29.1, chuqui: 65.7, pelambres: 34.0},
                {year: 2012, month: 5, total: 455.7, codelco: 138.8, escondida: 98.0, collahuasi: 20.9, chuqui: 66.0, pelambres: 36.1},
                {year: 2012, month: 6, total: 447.1, codelco: 138.0, escondida: 106.3, collahuasi: 18.7, chuqui: 60.6, pelambres: 34.7},
                {year: 2012, month: 7, total: 415.3, codelco: 144.3, escondida: 61.5, collahuasi: 23.5, chuqui: 65.3, pelambres: 34.3},
                {year: 2012, month: 8, total: 459.9, codelco: 152.2, escondida: 88.4, collahuasi: 19.6, chuqui: 72.5, pelambres: 36.3},
                {year: 2012, month: 9, total: 464.4, codelco: 154.4, escondida: 103.9, collahuasi: 19.8, chuqui: 65.0, pelambres: 31.6},
                {year: 2012, month: 10, total: 474.9, codelco: 162.6, escondida: 98.2, collahuasi: 21.3, chuqui: 73.8, pelambres: 31.6},
                {year: 2012, month: 11, total: 479.0, codelco: 156.3, escondida: 94.9, collahuasi: 22.6, chuqui: 61.2, pelambres: 39.7},
                {year: 2012, month: 12, total: 515.0, codelco: 184.8, escondida: 95.8, collahuasi: 29.9, chuqui: 87.1, pelambres: 40.2},
                {year: 2013, month: 1, total: 475.1, codelco: 134.1, escondida: 114.4, collahuasi: 22.2, chuqui: 64.0, pelambres: 39.9},
                {year: 2013, month: 2, total: 422.3, codelco: 140.9, escondida: 80.5, collahuasi: 20.6, chuqui: 59.9, pelambres: 34.0},
                {year: 2013, month: 3, total: 480.8, codelco: 152.5, escondida: 110.6, collahuasi: 24.1, chuqui: 59.5, pelambres: 30.8},
                {year: 2013, month: 4, total: 442.8, codelco: 132.6, escondida: 96.5, collahuasi: 18.1, chuqui: 50.0, pelambres: 34.1},
                {year: 2013, month: 5, total: 469.9, codelco: 140.2, escondida: 103.4, collahuasi: 28.3, chuqui: 53.2, pelambres: 36.3},
                {year: 2013, month: 6, total: 483.4, codelco: 142.3, escondida: 110.1, collahuasi: 39.4, chuqui: 57.6, pelambres: 35.6},
                {year: 2013, month: 7, total: 480.3, codelco: 164.1, escondida: 79.2, collahuasi: 50.4, chuqui: 72.2, pelambres: 34.3},
                {year: 2013, month: 8, total: 492.8, codelco: 151.6, escondida: 104.0, collahuasi: 46.4, chuqui: 63.8, pelambres: 36.3},
                {year: 2013, month: 9, total: 489.2, codelco: 151.5, escondida: 102.4, collahuasi: 47.9, chuqui: 68.0, pelambres: 32.5},
                {year: 2013, month: 10, total: 504.2, codelco: 156.0, escondida: 100.7, collahuasi: 46.7, chuqui: 65.1, pelambres: 36.1},
                {year: 2013, month: 11, total: 510.4, codelco: 159.7, escondida: 90.8, collahuasi: 48.4, chuqui: 63.5, pelambres: 35.6},
                {year: 2013, month: 12, total: 524.8, codelco: 166.1, escondida: 101.1, collahuasi: 52.0, chuqui: 75.3, pelambres: 33.7},
                {year: 2014, month: 1, total: 461.6, codelco: 144.6, escondida: 87.9, collahuasi: 36.9, chuqui: 62.9, pelambres: 33.8},
                {year: 2014, month: 2, total: 450.8, codelco: 130.6, escondida: 92.5, collahuasi: 42.8, chuqui: 55.9, pelambres: 27.8},
                {year: 2014, month: 3, total: 482.1, codelco: 153.0, escondida: 92.4, collahuasi: 39.2, chuqui: 67.8, pelambres: 37.4},
                {year: 2014, month: 4, total: 471.2, codelco: 139.9, escondida: 104.5, collahuasi: 41.6, chuqui: 64.6, pelambres: 35.0},
                {year: 2014, month: 5, total: 493.8, codelco: 157.8, escondida: 104.9, collahuasi: 38.1, chuqui: 71.1, pelambres: 35.5},
                {year: 2014, month: 6, total: 493.0, codelco: 150.9, escondida: 116.9, collahuasi: 42.1, chuqui: 65.4, pelambres: 33.8},
                {year: 2014, month: 7, total: 465.4, codelco: 161.2, escondida: 83.2, collahuasi: 38.4, chuqui: 72.1, pelambres: 31.8},
                {year: 2014, month: 8, total: 483.0, codelco: 169.6, escondida: 96.2, collahuasi: 36.8, chuqui: 77.8, pelambres: 34.4},
                {year: 2014, month: 9, total: 464.7, codelco: 153.0, escondida: 96.1, collahuasi: 35.1, chuqui: 61.1, pelambres: 32.0},
                {year: 2014, month: 10, total: 493.6, codelco: 171.0, escondida: 84.9, collahuasi: 40.0, chuqui: 73.5, pelambres: 33.1},
                {year: 2014, month: 11, total: 477.3, codelco: 147.5, escondida: 93.8, collahuasi: 37.1, chuqui: 58.9, pelambres: 34.5},
                {year: 2014, month: 12, total: 524.6, codelco: 161.7, escondida: 112.1, collahuasi: 42.3, chuqui: 77.8, pelambres: 35.5},
                {year: 2015, month: 1, total: 519.0, codelco: 153.4, escondida: 126.6, collahuasi: 39.0, chuqui: 64.6, pelambres: 31.1},
                {year: 2015, month: 2, total: 445.8, codelco: 126.9, escondida: 104.8, collahuasi: 30.3, chuqui: 50.9, pelambres: 23.9},
                {year: 2015, month: 3, total: 473.5, codelco: 153.1, escondida: 115.7, collahuasi: 35.2, chuqui: 63.2, pelambres: 26.5},
                {year: 2015, month: 4, total: 470.3, codelco: 151.0, escondida: 94.9, collahuasi: 37.2, chuqui: 74.0, pelambres: 33.8},
                {year: 2015, month: 5, total: 507.2, codelco: 158.6, escondida: 127.6, collahuasi: 34.8, chuqui: 61.7, pelambres: 29.5},
                {year: 2015, month: 6, total: 510.1, codelco: 167.0, escondida: 121.5, collahuasi: 40.1, chuqui: 80.1, pelambres: 30.5},
                {year: 2015, month: 7, total: 456.5, codelco: 156.1, escondida: 78.6, collahuasi: 33.3, chuqui: 74.0, pelambres: 33.5},
                {year: 2015, month: 8, total: 442.3, codelco: 152.0, escondida: 82.9, collahuasi: 24.7, chuqui: 69.3, pelambres: 32.4},
                {year: 2015, month: 9, total: 468.3, codelco: 160.6, escondida: 75.1, collahuasi: 40.8, chuqui: 77.7, pelambres: 33.0},
                {year: 2015, month: 10, total: 498.6, codelco: 181.4, escondida: 74.9, collahuasi: 43.6, chuqui: 89.2, pelambres: 28.4},
                {year: 2015, month: 11, total: 484.6, codelco: 168.4, escondida: 75.0, collahuasi: 43.2, chuqui: 81.3, pelambres: 35.1},
                {year: 2015, month: 12, total: 495.9, codelco: 162.7, escondida: 74.9, collahuasi: 53.1, chuqui: 76.6, pelambres: 38.1},
                {year: 2016, month: 1, total: 460.1, codelco: 149.2, escondida: 92.7, collahuasi: 38.0, chuqui: 65.0, pelambres: 29.5},
                {year: 2016, month: 2, total: 447.3, codelco: 152.0, escondida: 81.0, collahuasi: 40.1, chuqui: 70.6, pelambres: 28.0},
                {year: 2016, month: 3, total: 487.2, codelco: 168.6, escondida: 91.9, collahuasi: 38.0, chuqui: 77.1, pelambres: 27.6},
                {year: 2016, month: 4, total: 431.8, codelco: 132.9, escondida: 88.1, collahuasi: 34.0, chuqui: 70.0, pelambres: 32.8},
                {year: 2016, month: 5, total: 472.2, codelco: 141.9, escondida: 95.5, collahuasi: 48.2, chuqui: 64.4, pelambres: 30.8},
                {year: 2016, month: 6, total: 469.1, codelco: 161.2, escondida: 90.6, collahuasi: 45.5, chuqui: 82.0, pelambres: 29.4},
                {year: 2016, month: 7, total: 445.5, codelco: 152.3, escondida: 70.1, collahuasi: 46.3, chuqui: 73.8, pelambres: 28.6},
                {year: 2016, month: 8, total: 453.5, codelco: 148.8, escondida: 75.5, collahuasi: 42.9, chuqui: 70.5, pelambres: 30.6},
                {year: 2016, month: 9, total: 460.3, codelco: 158.8, escondida: 77.0, collahuasi: 40.5, chuqui: 73.5, pelambres: 31.1},
                {year: 2016, month: 10, total: 443.5, codelco: 155.4, escondida: 58.2, collahuasi: 49.2, chuqui: 70.6, pelambres: 33.8},
                {year: 2016, month: 11, total: 479.2, codelco: 154.9, escondida: 86.1, collahuasi: 43.5, chuqui: 68.4, pelambres: 30.2},
                {year: 2016, month: 12, total: 502.9, codelco: 151.2, escondida: 95.3, collahuasi: 40.3, chuqui: 71.4, pelambres: 35.4},
                {year: 2017, month: 1, total: 448.1, codelco: 140.6, escondida: 77.1, collahuasi: 44.4, chuqui: 64.7, pelambres: 28.1},
                {year: 2017, month: 2, total: 370.9, codelco: 135.1, escondida: 20.0, collahuasi: 45.3, chuqui: 58.2, pelambres: 26.3},
                {year: 2017, month: 3, total: 373.1, codelco: 140.6, escondida: 0.0, collahuasi: 41.3, chuqui: 66.9, pelambres: 31.5},
                {year: 2017, month: 4, total: 420.1, codelco: 143.2, escondida: 64.0, collahuasi: 31.1, chuqui: 65.3, pelambres: 24.9},
                {year: 2017, month: 5, total: 466.0, codelco: 150.5, escondida: 82.7, collahuasi: 44.9, chuqui: 64.4, pelambres: 31.3},
                {year: 2017, month: 6, total: 443.8, codelco: 141.0, escondida: 84.1, collahuasi: 39.9, chuqui: 60.9, pelambres: 28.1},
                {year: 2017, month: 7, total: 468.1, codelco: 160.7, escondida: 81.4, collahuasi: 41.1, chuqui: 72.4, pelambres: 29.4},
                {year: 2017, month: 8, total: 496.6, codelco: 160.2, escondida: 97.8, collahuasi: 43.6, chuqui: 74.3, pelambres: 30.1},
                {year: 2017, month: 9, total: 476.5, codelco: 150.6, escondida: 95.6, collahuasi: 48.0, chuqui: 68.3, pelambres: 30.5},
                {year: 2017, month: 10, total: 510.4, codelco: 175.0, escondida: 109.6, collahuasi: 48.0, chuqui: 90.7, pelambres: 31.1},
                {year: 2017, month: 11, total: 497.8, codelco: 163.2, escondida: 106.2, collahuasi: 47.6, chuqui: 84.0, pelambres: 31.4},
                {year: 2017, month: 12, total: 532.1, codelco: 181.4, escondida: 106.9, collahuasi: 48.8, chuqui: 94.8, pelambres: 33.6},
                {year: 2018, month: 1, total: 476.2, codelco: 146.3, escondida: 107.0, collahuasi: 54.1, chuqui: 67.6, pelambres: 27.4},
                {year: 2018, month: 2, total: 453.1, codelco: 142.6, escondida: 103.0, collahuasi: 42.5, chuqui: 68.7, pelambres: 26.6},
                {year: 2018, month: 3, total: 488.0, codelco: 157.4, escondida: 112.7, collahuasi: 41.0, chuqui: 77.1, pelambres: 30.0},
                {year: 2018, month: 4, total: 446.9, codelco: 138.6, escondida: 109.2, collahuasi: 43.5, chuqui: 66.5, pelambres: 14.0},
                {year: 2018, month: 5, total: 495.6, codelco: 146.9, escondida: 113.7, collahuasi: 39.6, chuqui: 64.3, pelambres: 32.8},
                {year: 2018, month: 6, total: 472.3, codelco: 143.5, escondida: 101.7, collahuasi: 41.4, chuqui: 67.7, pelambres: 34.1},
                {year: 2018, month: 7, total: 482.0, codelco: 144.1, escondida: 110.9, collahuasi: 43.2, chuqui: 60.5, pelambres: 35.2},
                {year: 2018, month: 8, total: 462.0, codelco: 141.5, escondida: 84.6, collahuasi: 45.4, chuqui: 61.2, pelambres: 35.7},
                {year: 2018, month: 9, total: 478.2, codelco: 135.2, escondida: 108.1, collahuasi: 51.1, chuqui: 61.0, pelambres: 31.2},
                {year: 2018, month: 10, total: 490.4, codelco: 150.7, escondida: 95.9, collahuasi: 49.1, chuqui: 66.8, pelambres: 32.6},
                {year: 2018, month: 11, total: 536.8, codelco: 174.5, escondida: 104.8, collahuasi: 51.7, chuqui: 86.6, pelambres: 33.3},
                {year: 2018, month: 12, total: 550.1, codelco: 185.3, escondida: 91.1, collahuasi: 56.6, chuqui: 100.9, pelambres: 37.6},
                {year: 2019, month: 1, total: 457.1, codelco: 127.2, escondida: 91.8, collahuasi: 44.5, chuqui: 57.2, pelambres: 30.5},
                {year: 2019, month: 2, total: 415.2, codelco: 115.1, escondida: 82.1, collahuasi: 38.5, chuqui: 50.5, pelambres: 29.4},
                {year: 2019, month: 3, total: 473.3, codelco: 128.6, escondida: 100.9, collahuasi: 47.2, chuqui: 68.1, pelambres: 31.7},
                {year: 2019, month: 4, total: 458.6, codelco: 129.7, escondida: 92.1, collahuasi: 37.1, chuqui: 62.0, pelambres: 33.3},
                {year: 2019, month: 5, total: 487.8, codelco: 140.0, escondida: 98.9, collahuasi: 43.0, chuqui: 67.2, pelambres: 32.1},
                {year: 2019, month: 6, total: 469.9, codelco: 128.7, escondida: 104.1, collahuasi: 44.4, chuqui: 60.8, pelambres: 29.0},
                {year: 2019, month: 7, total: 486.8, codelco: 139.5, escondida: 97.2, collahuasi: 47.3, chuqui: 62.4, pelambres: 31.5},
                {year: 2019, month: 8, total: 513.3, codelco: 154.7, escondida: 103.7, collahuasi: 50.5, chuqui: 75.8, pelambres: 32.2},
                {year: 2019, month: 9, total: 483.8, codelco: 145.3, escondida: 100.1, collahuasi: 48.8, chuqui: 66.5, pelambres: 30.5},
                {year: 2019, month: 10, total: 490.0, codelco: 154.5, escondida: 108.1, collahuasi: 50.9, chuqui: 71.0, pelambres: 24.9},
                {year: 2019, month: 11, total: 500.1, codelco: 155.2, escondida: 103.2, collahuasi: 56.7, chuqui: 73.4, pelambres: 33.9},
                {year: 2019, month: 12, total: 551.5, codelco: 187.6, escondida: 105.6, collahuasi: 56.5, chuqui: 88.6, pelambres: 36.9},
                {year: 2020, month: 1, total: 460.1, codelco: 118.9, escondida: 100.9, collahuasi: 53.5, chuqui: 49.9, pelambres: 29.8},
                {year: 2020, month: 2, total: 448.0, codelco: 120.3, escondida: 94.5, collahuasi: 47.1, chuqui: 54.6, pelambres: 33.0},
                {year: 2020, month: 3, total: 494.7, codelco: 147.6, escondida: 101.8, collahuasi: 50.4, chuqui: 71.4, pelambres: 33.7},
                {year: 2020, month: 4, total: 470.5, codelco: 133.3, escondida: 102.6, collahuasi: 54.1, chuqui: 61.0, pelambres: 31.2},
                {year: 2020, month: 5, total: 492.3, codelco: 144.2, escondida: 93.4, collahuasi: 60.1, chuqui: 66.8, pelambres: 35.0},
                {year: 2020, month: 6, total: 466.5, codelco: 131.9, escondida: 105.8, collahuasi: 57.8, chuqui: 65.9, pelambres: 25.8},
                {year: 2020, month: 7, total: 465.1, codelco: 133.3, escondida: 103.8, collahuasi: 58.1, chuqui: 67.1, pelambres: 27.1},
                {year: 2020, month: 8, total: 484.1, codelco: 154.8, escondida: 94.8, collahuasi: 60.0, chuqui: 78.0, pelambres: 33.3},
                {year: 2020, month: 9, total: 479.8, codelco: 159.2, escondida: 94.1, collahuasi: 53.4, chuqui: 79.9, pelambres: 29.3},
                {year: 2020, month: 10, total: 486.5, codelco: 159.9, escondida: 99.9, collahuasi: 42.2, chuqui: 81.8, pelambres: 29.9},
                {year: 2020, month: 11, total: 485.1, codelco: 166.1, escondida: 90.8, collahuasi: 48.2, chuqui: 83.4, pelambres: 31.9},
                {year: 2020, month: 12, total: 500.4, codelco: 157.8, escondida: 104.9, collahuasi: 44.2, chuqui: 72.1, pelambres: 32.1},
                {year: 2021, month: 1, total: 457.8, codelco: 142.0, escondida: 84.7, collahuasi: 57.0, chuqui: 69.4, pelambres: 28.8},
                {year: 2021, month: 2, total: 426.5, codelco: 122.8, escondida: 81.6, collahuasi: 52.8, chuqui: 59.5, pelambres: 26.6},
                {year: 2021, month: 3, total: 488.8, codelco: 148.7, escondida: 89.9, collahuasi: 53.0, chuqui: 73.9, pelambres: 32.5},
                {year: 2021, month: 4, total: 461.2, codelco: 132.7, escondida: 85.7, collahuasi: 57.0, chuqui: 63.7, pelambres: 29.2},
                {year: 2021, month: 5, total: 487.2, codelco: 152.5, escondida: 84.8, collahuasi: 57.9, chuqui: 67.3, pelambres: 28.5},
                {year: 2021, month: 6, total: 477.3, codelco: 151.6, escondida: 82.9, collahuasi: 53.9, chuqui: 74.5, pelambres: 29.8},
                {year: 2021, month: 7, total: 465.0, codelco: 136.9, escondida: 86.3, collahuasi: 54.0, chuqui: 53.4, pelambres: 27.9},
                {year: 2021, month: 8, total: 462.8, codelco: 144.5, escondida: 81.5, collahuasi: 48.2, chuqui: 76.1, pelambres: 30.1},
                {year: 2021, month: 9, total: 447.4, codelco: 133.8, escondida: 82.6, collahuasi: 46.1, chuqui: 68.1, pelambres: 26.0},
                {year: 2021, month: 10, total: 470.5, codelco: 144.1, escondida: 84.7, collahuasi: 49.5, chuqui: 65.3, pelambres: 20.4},
                {year: 2021, month: 11, total: 482.1, codelco: 153.8, escondida: 80.3, collahuasi: 50.7, chuqui: 75.8, pelambres: 29.3},
                {year: 2021, month: 12, total: 498.3, codelco: 164.6, escondida: 86.4, collahuasi: 49.9, chuqui: 80.4, pelambres: 27.2},
                {year: 2022, month: 1, total: 425.7, codelco: 120.8, escondida: 81.0, collahuasi: 51.3, chuqui: 48.5, pelambres: 18.1},
                {year: 2022, month: 2, total: 394.6, codelco: 123.7, escondida: 69.9, collahuasi: 46.9, chuqui: 56.5, pelambres: 16.3},
                {year: 2022, month: 3, total: 457.7, codelco: 142.9, escondida: 81.4, collahuasi: 51.2, chuqui: 73.5, pelambres: 21.3},
                {year: 2022, month: 4, total: 419.5, codelco: 122.7, escondida: 87.9, collahuasi: 41.9, chuqui: 59.4, pelambres: 20.1},
                {year: 2022, month: 5, total: 474.8, codelco: 143.0, escondida: 106.9, collahuasi: 49.0, chuqui: 67.4, pelambres: 22.3},
                {year: 2022, month: 6, total: 454.7, codelco: 129.9, escondida: 102.5, collahuasi: 50.2, chuqui: 56.4, pelambres: 15.0},
                {year: 2022, month: 7, total: 423.7, codelco: 128.0, escondida: 81.4, collahuasi: 47.3, chuqui: 64.0, pelambres: 23.4},
                {year: 2022, month: 8, total: 415.9, codelco: 101.8, escondida: 92.7, collahuasi: 45.6, chuqui: 46.0, pelambres: 28.3},
                {year: 2022, month: 9, total: 434.6, codelco: 123.2, escondida: 85.5, collahuasi: 44.5, chuqui: 53.4, pelambres: 27.8},
                {year: 2022, month: 10, total: 477.0, codelco: 135.8, escondida: 99.7, collahuasi: 44.9, chuqui: 63.7, pelambres: 31.0},
                {year: 2022, month: 11, total: 453.4, codelco: 135.8, escondida: 79.8, collahuasi: 46.7, chuqui: 64.2, pelambres: 28.8},
                {year: 2022, month: 12, total: 495.8, codelco: 145.1, escondida: 85.5, collahuasi: 51.3, chuqui: 68.5, pelambres: 31.7},
                {year: 2023, month: 1, total: 431.6, codelco: 126.9, escondida: 93.3, collahuasi: 42.9, chuqui: 60.6, pelambres: 17.4},
                {year: 2023, month: 2, total: 380.0, codelco: 105.4, escondida: 72.7, collahuasi: 44.1, chuqui: 49.5, pelambres: 20.8},
                {year: 2023, month: 3, total: 436.2, codelco: 119.4, escondida: 92.4, collahuasi: 42.8, chuqui: 50.1, pelambres: 22.9},
                {year: 2023, month: 4, total: 412.8, codelco: 101.3, escondida: 105.1, collahuasi: 41.5, chuqui: 48.1, pelambres: 19.1},
                {year: 2023, month: 5, total: 408.7, codelco: 110.9, escondida: 83.9, collahuasi: 43.2, chuqui: 53.7, pelambres: 27.1},
                {year: 2023, month: 6, total: 457.2, codelco: 120.3, escondida: 111.4, collahuasi: 45.4, chuqui: 59.0, pelambres: 27.8},
                {year: 2023, month: 7, total: 433.9, codelco: 124.7, escondida: 82.4, collahuasi: 50.0, chuqui: 61.0, pelambres: 27.8},
                {year: 2023, month: 8, total: 436.5, codelco: 113.8, escondida: 91.2, collahuasi: 55.0, chuqui: 54.5, pelambres: 26.5},
                {year: 2023, month: 9, total: 457.4, codelco: 117.0, escondida: 107.3, collahuasi: 45.1, chuqui: 61.5, pelambres: 28.1},
                {year: 2023, month: 10, total: 459.7, codelco: 127.9, escondida: 88.4, collahuasi: 54.8, chuqui: 60.5, pelambres: 28.0},
                {year: 2023, month: 11, total: 442.9, codelco: 114.3, escondida: 84.8, collahuasi: 48.0, chuqui: 56.0, pelambres: 29.9},
                {year: 2023, month: 12, total: 493.7, codelco: 142.0, escondida: 88.5, collahuasi: 60.3, chuqui: 74.8, pelambres: 35.2},
                {year: 2024, month: 1, total: 434.6, codelco: 107.0, escondida: 97.5, collahuasi: 52.2, chuqui: 47.1, pelambres: 28.1},
                {year: 2024, month: 2, total: 417.8, codelco: 104.5, escondida: 97.5, collahuasi: 45.2, chuqui: 46.8, pelambres: 27.5},
                {year: 2024, month: 3, total: 434.8, codelco: 107.3, escondida: 101.4, collahuasi: 49.8, chuqui: 40.8, pelambres: 23.6},
                {year: 2024, month: 4, total: 405.7, codelco: 95.1, escondida: 98.0, collahuasi: 42.3, chuqui: 44.1, pelambres: 27.9},
                {year: 2024, month: 5, total: 445.3, codelco: 111.7, escondida: 106.1, collahuasi: 46.2, chuqui: 55.6, pelambres: 27.4},
                {year: 2024, month: 6, total: 448.6, codelco: 102.5, escondida: 114.0, collahuasi: 48.4, chuqui: 51.0, pelambres: 27.1},
                {year: 2024, month: 7, total: 440.7, codelco: 111.4, escondida: 106.5, collahuasi: 47.0, chuqui: 52.4, pelambres: 26.7},
                {year: 2024, month: 8, total: 466.7, codelco: 125.3, escondida: 105.3, collahuasi: 48.8, chuqui: 59.2, pelambres: 27.3},
                {year: 2024, month: 9, total: 475.1, codelco: 124.6, escondida: 101.5, collahuasi: 51.4, chuqui: 58.9, pelambres: 28.1},
                {year: 2024, month: 10, total: 488.9, codelco: 129.5, escondida: 108.0, collahuasi: 49.5, chuqui: 60.1, pelambres: 30.1},
                {year: 2024, month: 11, total: 484.2, codelco: 134.9, escondida: 108.2, collahuasi: 36.7, chuqui: 69.7, pelambres: 27.6},
                {year: 2024, month: 12, total: 563.5, codelco: 174.9, escondida: 133.6, collahuasi: 41.2, chuqui: 95.8, pelambres: 29.7}
            ],
            yearlyPatterns: [
                {year: 2003, values: [391.5, 371.9, 422.6, 387.1, 408.8, 416.4, 427.4, 388.6, 397.8, 423.8, 410.8, 457.5]},
                {year: 2004, values: [384.7, 387.1, 438.1, 436.0, 453.6, 448.8, 474.4, 465.8, 451.6, 486.9, 467.5, 518.0]},
                {year: 2005, values: [430.4, 367.0, 447.2, 408.7, 456.0, 407.2, 417.8, 469.5, 431.9, 456.1, 479.1, 549.6]},
                {year: 2006, values: [415.1, 388.3, 441.0, 443.6, 459.1, 447.9, 459.8, 411.7, 392.5, 490.5, 479.0, 532.3]},
                {year: 2007, values: [445.2, 388.8, 498.1, 454.9, 476.1, 457.9, 451.8, 427.5, 474.5, 482.0, 469.0, 531.2]},
                {year: 2008, values: [437.0, 419.4, 453.2, 430.0, 465.9, 472.0, 431.6, 424.2, 419.9, 455.7, 436.2, 482.5]},
                {year: 2009, values: [430.4, 376.7, 426.1, 425.5, 456.2, 466.2, 421.6, 460.2, 463.6, 495.1, 466.4, 506.4]},
                {year: 2010, values: [426.5, 393.6, 452.0, 452.8, 433.7, 470.2, 452.2, 466.8, 444.0, 461.3, 468.6, 497.2]},
                {year: 2011, values: [449.9, 368.3, 446.6, 436.3, 443.7, 427.1, 372.4, 426.5, 438.1, 469.5, 463.7, 520.7]},
                {year: 2012, values: [431.0, 405.8, 441.9, 443.9, 455.7, 447.1, 415.3, 459.9, 464.4, 474.9, 479.0, 515.0]},
                {year: 2013, values: [475.1, 422.3, 480.8, 442.8, 469.9, 483.4, 480.3, 492.8, 489.2, 504.2, 510.4, 524.8]},
                {year: 2014, values: [461.6, 450.8, 482.1, 471.2, 493.8, 493.0, 465.4, 483.0, 464.7, 493.6, 477.3, 524.6]},
                {year: 2015, values: [519.0, 445.8, 473.5, 470.3, 507.2, 510.1, 456.5, 442.3, 468.3, 498.6, 484.6, 495.9]},
                {year: 2016, values: [460.1, 447.3, 487.2, 431.8, 472.2, 469.1, 445.5, 453.5, 460.3, 443.5, 479.2, 502.9]},
                {year: 2017, values: [448.1, 370.9, 373.1, 420.1, 466.0, 443.8, 468.1, 496.6, 476.5, 510.4, 497.8, 532.1]},
                {year: 2018, values: [476.2, 453.1, 488.0, 446.9, 495.6, 472.3, 482.0, 462.0, 478.2, 490.4, 536.8, 550.1]},
                {year: 2019, values: [457.1, 415.2, 473.3, 458.6, 487.8, 469.9, 486.8, 513.3, 483.8, 490.0, 500.1, 551.5]},
                {year: 2020, values: [460.1, 448.0, 494.7, 470.5, 492.3, 466.5, 465.1, 484.1, 479.8, 486.5, 485.1, 500.4]},
                {year: 2021, values: [457.8, 426.5, 488.8, 461.2, 487.2, 477.3, 465.0, 462.8, 447.4, 470.5, 482.1, 498.3]},
                {year: 2022, values: [425.7, 394.6, 457.7, 419.5, 474.8, 454.7, 423.7, 415.9, 434.6, 477.0, 453.4, 495.8]},
                {year: 2023, values: [431.6, 380.0, 436.2, 412.8, 408.7, 457.2, 433.9, 436.5, 457.4, 459.7, 442.9, 493.7]},
                {year: 2024, values: [434.6, 417.8, 434.8, 405.7, 445.3, 448.6, 440.7, 466.7, 475.1, 488.9, 484.2, 563.5]}
            ],
            rolling12Month: [
                {year: 2003, month: 12, value: 408.7},
                {year: 2004, month: 1, value: 408.1}, {year: 2004, month: 2, value: 409.4}, {year: 2004, month: 3, value: 410.7}, {year: 2004, month: 4, value: 414.8}, {year: 2004, month: 5, value: 418.5}, {year: 2004, month: 6, value: 421.2}, {year: 2004, month: 7, value: 425.1}, {year: 2004, month: 8, value: 431.5}, {year: 2004, month: 9, value: 436.0}, {year: 2004, month: 10, value: 441.3}, {year: 2004, month: 11, value: 446.0}, {year: 2004, month: 12, value: 451.0},
                {year: 2005, month: 1, value: 454.9}, {year: 2005, month: 2, value: 453.2}, {year: 2005, month: 3, value: 453.9}, {year: 2005, month: 4, value: 451.7}, {year: 2005, month: 5, value: 451.9}, {year: 2005, month: 6, value: 448.4}, {year: 2005, month: 7, value: 443.7}, {year: 2005, month: 8, value: 444.0}, {year: 2005, month: 9, value: 442.3}, {year: 2005, month: 10, value: 439.8}, {year: 2005, month: 11, value: 440.7}, {year: 2005, month: 12, value: 443.4},
                {year: 2006, month: 1, value: 442.1}, {year: 2006, month: 2, value: 443.9}, {year: 2006, month: 3, value: 443.4}, {year: 2006, month: 4, value: 446.3}, {year: 2006, month: 5, value: 446.5}, {year: 2006, month: 6, value: 449.9}, {year: 2006, month: 7, value: 453.4}, {year: 2006, month: 8, value: 448.6}, {year: 2006, month: 9, value: 445.3}, {year: 2006, month: 10, value: 448.2}, {year: 2006, month: 11, value: 448.2}, {year: 2006, month: 12, value: 446.7},
                {year: 2007, month: 1, value: 449.2}, {year: 2007, month: 2, value: 449.3}, {year: 2007, month: 3, value: 454.0}, {year: 2007, month: 4, value: 455.0}, {year: 2007, month: 5, value: 456.4}, {year: 2007, month: 6, value: 457.2}, {year: 2007, month: 7, value: 456.6}, {year: 2007, month: 8, value: 457.9}, {year: 2007, month: 9, value: 464.7}, {year: 2007, month: 10, value: 464.0}, {year: 2007, month: 11, value: 463.2}, {year: 2007, month: 12, value: 463.1},
                {year: 2008, month: 1, value: 462.4}, {year: 2008, month: 2, value: 464.9}, {year: 2008, month: 3, value: 461.2}, {year: 2008, month: 4, value: 459.1}, {year: 2008, month: 5, value: 458.3}, {year: 2008, month: 6, value: 459.5}, {year: 2008, month: 7, value: 457.8}, {year: 2008, month: 8, value: 457.5}, {year: 2008, month: 9, value: 452.9}, {year: 2008, month: 10, value: 450.8}, {year: 2008, month: 11, value: 448.0}, {year: 2008, month: 12, value: 444.0},
                {year: 2009, month: 1, value: 443.4}, {year: 2009, month: 2, value: 439.9}, {year: 2009, month: 3, value: 437.6}, {year: 2009, month: 4, value: 437.2}, {year: 2009, month: 5, value: 436.4}, {year: 2009, month: 6, value: 435.9}, {year: 2009, month: 7, value: 435.1}, {year: 2009, month: 8, value: 438.1}, {year: 2009, month: 9, value: 441.7}, {year: 2009, month: 10, value: 445.0}, {year: 2009, month: 11, value: 447.5}, {year: 2009, month: 12, value: 449.5},
                {year: 2010, month: 1, value: 449.2}, {year: 2010, month: 2, value: 450.6}, {year: 2010, month: 3, value: 452.8}, {year: 2010, month: 4, value: 455.0}, {year: 2010, month: 5, value: 453.2}, {year: 2010, month: 6, value: 453.5}, {year: 2010, month: 7, value: 456.1}, {year: 2010, month: 8, value: 456.6}, {year: 2010, month: 9, value: 455.0}, {year: 2010, month: 10, value: 452.2}, {year: 2010, month: 11, value: 452.3}, {year: 2010, month: 12, value: 451.6},
                {year: 2011, month: 1, value: 453.5}, {year: 2011, month: 2, value: 451.4}, {year: 2011, month: 3, value: 451.0}, {year: 2011, month: 4, value: 449.6}, {year: 2011, month: 5, value: 450.4}, {year: 2011, month: 6, value: 446.8}, {year: 2011, month: 7, value: 440.2}, {year: 2011, month: 8, value: 436.8}, {year: 2011, month: 9, value: 436.3}, {year: 2011, month: 10, value: 437.0}, {year: 2011, month: 11, value: 436.6}, {year: 2011, month: 12, value: 438.6},
                {year: 2012, month: 1, value: 437.0}, {year: 2012, month: 2, value: 440.1}, {year: 2012, month: 3, value: 439.7}, {year: 2012, month: 4, value: 440.4}, {year: 2012, month: 5, value: 441.4}, {year: 2012, month: 6, value: 443.0}, {year: 2012, month: 7, value: 446.6}, {year: 2012, month: 8, value: 449.4}, {year: 2012, month: 9, value: 451.6}, {year: 2012, month: 10, value: 452.0}, {year: 2012, month: 11, value: 453.3}, {year: 2012, month: 12, value: 452.8},
                {year: 2013, month: 1, value: 456.5}, {year: 2013, month: 2, value: 457.9}, {year: 2013, month: 3, value: 461.1}, {year: 2013, month: 4, value: 461.0}, {year: 2013, month: 5, value: 462.2}, {year: 2013, month: 6, value: 465.2}, {year: 2013, month: 7, value: 470.7}, {year: 2013, month: 8, value: 473.4}, {year: 2013, month: 9, value: 475.5}, {year: 2013, month: 10, value: 477.9}, {year: 2013, month: 11, value: 480.5}, {year: 2013, month: 12, value: 481.3},
                {year: 2014, month: 1, value: 480.2}, {year: 2014, month: 2, value: 482.6}, {year: 2014, month: 3, value: 482.7}, {year: 2014, month: 4, value: 485.1}, {year: 2014, month: 5, value: 487.1}, {year: 2014, month: 6, value: 487.9}, {year: 2014, month: 7, value: 486.6}, {year: 2014, month: 8, value: 485.8}, {year: 2014, month: 9, value: 483.8}, {year: 2014, month: 10, value: 482.9}, {year: 2014, month: 11, value: 480.1}, {year: 2014, month: 12, value: 480.1},
                {year: 2015, month: 1, value: 484.9}, {year: 2015, month: 2, value: 484.5}, {year: 2015, month: 3, value: 483.7}, {year: 2015, month: 4, value: 483.7}, {year: 2015, month: 5, value: 484.8}, {year: 2015, month: 6, value: 486.2}, {year: 2015, month: 7, value: 485.5}, {year: 2015, month: 8, value: 482.1}, {year: 2015, month: 9, value: 482.4}, {year: 2015, month: 10, value: 482.8}, {year: 2015, month: 11, value: 483.4}, {year: 2015, month: 12, value: 481.0},
                {year: 2016, month: 1, value: 476.1}, {year: 2016, month: 2, value: 476.2}, {year: 2016, month: 3, value: 477.4}, {year: 2016, month: 4, value: 474.2}, {year: 2016, month: 5, value: 471.2}, {year: 2016, month: 6, value: 467.8}, {year: 2016, month: 7, value: 466.9}, {year: 2016, month: 8, value: 467.8}, {year: 2016, month: 9, value: 467.2}, {year: 2016, month: 10, value: 462.6}, {year: 2016, month: 11, value: 462.1}, {year: 2016, month: 12, value: 462.7},
                {year: 2017, month: 1, value: 461.7}, {year: 2017, month: 2, value: 455.4}, {year: 2017, month: 3, value: 445.8}, {year: 2017, month: 4, value: 444.9}, {year: 2017, month: 5, value: 444.3}, {year: 2017, month: 6, value: 442.2}, {year: 2017, month: 7, value: 444.1}, {year: 2017, month: 8, value: 447.7}, {year: 2017, month: 9, value: 449.1}, {year: 2017, month: 10, value: 454.6}, {year: 2017, month: 11, value: 456.2}, {year: 2017, month: 12, value: 458.6},
                {year: 2018, month: 1, value: 461.0}, {year: 2018, month: 2, value: 467.8}, {year: 2018, month: 3, value: 477.4}, {year: 2018, month: 4, value: 479.6}, {year: 2018, month: 5, value: 482.1}, {year: 2018, month: 6, value: 484.5}, {year: 2018, month: 7, value: 485.6}, {year: 2018, month: 8, value: 482.7}, {year: 2018, month: 9, value: 482.9}, {year: 2018, month: 10, value: 481.2}, {year: 2018, month: 11, value: 484.5}, {year: 2018, month: 12, value: 486.0},
                {year: 2019, month: 1, value: 484.4}, {year: 2019, month: 2, value: 481.2}, {year: 2019, month: 3, value: 480.0}, {year: 2019, month: 4, value: 481.0}, {year: 2019, month: 5, value: 480.3}, {year: 2019, month: 6, value: 480.1}, {year: 2019, month: 7, value: 480.5}, {year: 2019, month: 8, value: 484.8}, {year: 2019, month: 9, value: 485.3}, {year: 2019, month: 10, value: 485.2}, {year: 2019, month: 11, value: 482.2}, {year: 2019, month: 12, value: 482.3},
                {year: 2020, month: 1, value: 482.5}, {year: 2020, month: 2, value: 485.3}, {year: 2020, month: 3, value: 487.1}, {year: 2020, month: 4, value: 488.0}, {year: 2020, month: 5, value: 488.4}, {year: 2020, month: 6, value: 488.1}, {year: 2020, month: 7, value: 486.3}, {year: 2020, month: 8, value: 483.9}, {year: 2020, month: 9, value: 483.6}, {year: 2020, month: 10, value: 483.3}, {year: 2020, month: 11, value: 482.0}, {year: 2020, month: 12, value: 477.8},
                {year: 2021, month: 1, value: 477.6}, {year: 2021, month: 2, value: 475.8}, {year: 2021, month: 3, value: 475.3}, {year: 2021, month: 4, value: 474.5}, {year: 2021, month: 5, value: 474.1}, {year: 2021, month: 6, value: 475.0}, {year: 2021, month: 7, value: 475.0}, {year: 2021, month: 8, value: 473.2}, {year: 2021, month: 9, value: 470.5}, {year: 2021, month: 10, value: 469.2}, {year: 2021, month: 11, value: 468.9}, {year: 2021, month: 12, value: 468.7},
                {year: 2022, month: 1, value: 466.1}, {year: 2022, month: 2, value: 463.4}, {year: 2022, month: 3, value: 460.8}, {year: 2022, month: 4, value: 457.3}, {year: 2022, month: 5, value: 456.3}, {year: 2022, month: 6, value: 454.4}, {year: 2022, month: 7, value: 451.0}, {year: 2022, month: 8, value: 447.1}, {year: 2022, month: 9, value: 446.0}, {year: 2022, month: 10, value: 446.6}, {year: 2022, month: 11, value: 444.2}, {year: 2022, month: 12, value: 443.9},
                {year: 2023, month: 1, value: 444.4}, {year: 2023, month: 2, value: 443.2}, {year: 2023, month: 3, value: 441.4}, {year: 2023, month: 4, value: 440.9}, {year: 2023, month: 5, value: 435.4}, {year: 2023, month: 6, value: 435.6}, {year: 2023, month: 7, value: 436.4}, {year: 2023, month: 8, value: 438.1}, {year: 2023, month: 9, value: 440.0}, {year: 2023, month: 10, value: 438.6}, {year: 2023, month: 11, value: 437.7}, {year: 2023, month: 12, value: 437.6},
                {year: 2024, month: 1, value: 437.8}, {year: 2024, month: 2, value: 440.9}, {year: 2024, month: 3, value: 440.8}, {year: 2024, month: 4, value: 440.2}, {year: 2024, month: 5, value: 443.3}, {year: 2024, month: 6, value: 442.6}, {year: 2024, month: 7, value: 443.1}, {year: 2024, month: 8, value: 445.7}, {year: 2024, month: 9, value: 447.1}, {year: 2024, month: 10, value: 449.6}, {year: 2024, month: 11, value: 453.0}, {year: 2024, month: 12, value: 458.8}
            ],
            monthlyAverage: [
                {month: 1, avg: 443.5}, {month: 2, avg: 405.8}, {month: 3, avg: 457.2}, {month: 4, avg: 439.3},
                {month: 5, avg: 465.0}, {month: 6, avg: 459.9}, {month: 7, avg: 447.5}, {month: 8, avg: 454.5},
                {month: 9, avg: 453.3}, {month: 10, avg: 477.2}, {month: 11, avg: 474.7}, {month: 12, avg: 513.4}
            ]
        };
        
        const tooltip = d3.select('#tooltip');
        function showTooltip(event, html) {
            tooltip.style('opacity', 1).html(html)
                .style('left', (event.pageX + 15) + 'px')
                .style('top', (event.pageY - 10) + 'px');
        }
        function hideTooltip() { tooltip.style('opacity', 0); }
        
        // Hero - Top 5 producers bar chart
        function createHeroChart() {
            const container = d3.select('#hero-chart');
            const width = container.node().getBoundingClientRect().width;
            const height = 400;
            const margin = {top: 40, right: 30, bottom: 20, left: 60};
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
            
            const topCountries = [
                {country: 'Chile', value: 5506, flag: 'üá®üá±', color: '#B87333'},
                {country: 'Congo', value: 3300, flag: 'üá®üá©', color: '#9b59b6'},
                {country: 'Peru', value: 2712, flag: 'üáµüá™', color: '#4a9eff'},
                {country: 'China', value: 1812, flag: 'üá®üá≥', color: '#e74c3c'},
                {country: 'USA', value: 1059, flag: 'üá∫üá∏', color: '#666'}
            ].sort((a, b) => b.value - a.value);
            
            const y = d3.scaleBand().domain(topCountries.map(d => d.country)).range([0, height - margin.top - margin.bottom]).padding(0.35);
            const x = d3.scaleLinear().domain([0, 6000]).range([0, width - margin.left - margin.right]);
            
            // Title and subtitle
            g.append('text').attr('x', 0).attr('y', -28).attr('fill', '#f5f0e8').attr('font-size', '14px').attr('font-weight', '600').text('Top Copper Producers 2024');
            g.append('text').attr('x', 0).attr('y', -12).attr('fill', '#a09890').attr('font-size', '11px').text('Copper mine production, thousand metric tonnes');
            
            // Bars
            g.selectAll('.bar').data(topCountries).enter().append('rect')
                .attr('y', d => y(d.country)).attr('x', 0)
                .attr('height', y.bandwidth()).attr('width', d => x(d.value))
                .attr('fill', d => d.color).attr('rx', 6)
                .attr('opacity', 0.85);
            
            // Flags + labels
            g.selectAll('.flag').data(topCountries).enter().append('text')
                .attr('y', d => y(d.country) + y.bandwidth() / 2)
                .attr('x', -10).attr('text-anchor', 'end').attr('dominant-baseline', 'middle')
                .attr('font-size', '24px').text(d => d.flag);
            
            // Values
            g.selectAll('.value').data(topCountries).enter().append('text')
                .attr('y', d => y(d.country) + y.bandwidth() / 2)
                .attr('x', d => x(d.value) + 10).attr('dominant-baseline', 'middle')
                .attr('fill', '#f5f0e8').attr('font-size', '14px').attr('font-weight', '600')
                .text(d => d.value.toLocaleString());
            
            // Country names inside bars
            g.selectAll('.name').data(topCountries).enter().append('text')
                .attr('y', d => y(d.country) + y.bandwidth() / 2)
                .attr('x', 15).attr('dominant-baseline', 'middle')
                .attr('fill', '#0a0a12').attr('font-size', '13px').attr('font-weight', '600')
                .text(d => d.country);
        }
        
        // Top Producers Chart (for section)
        function createTopProducersChart() {
            const container = d3.select('#top-producers-chart');
            container.selectAll('*').remove();
            
            const width = container.node().getBoundingClientRect().width;
            const height = 280;
            const margin = {top: 20, right: 60, bottom: 20, left: 50};
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
            
            const topCountries = [
                {country: 'Chile', value: 5506, flag: 'üá®üá±', color: '#B87333'},
                {country: 'Congo', value: 3300, flag: 'üá®üá©', color: '#9b59b6'},
                {country: 'Peru', value: 2712, flag: 'üáµüá™', color: '#4a9eff'},
                {country: 'China', value: 1812, flag: 'üá®üá≥', color: '#e74c3c'},
                {country: 'USA', value: 1059, flag: 'üá∫üá∏', color: '#666'}
            ].sort((a, b) => b.value - a.value);
            
            const y = d3.scaleBand().domain(topCountries.map(d => d.country)).range([0, height - margin.top - margin.bottom]).padding(0.3);
            const x = d3.scaleLinear().domain([0, 6000]).range([0, width - margin.left - margin.right]);
            
            // Bars
            g.selectAll('.bar').data(topCountries).enter().append('rect')
                .attr('y', d => y(d.country)).attr('x', 0)
                .attr('height', y.bandwidth()).attr('width', d => x(d.value))
                .attr('fill', d => d.color).attr('rx', 4)
                .attr('opacity', 0.85);
            
            // Flags
            g.selectAll('.flag').data(topCountries).enter().append('text')
                .attr('y', d => y(d.country) + y.bandwidth() / 2)
                .attr('x', -8).attr('text-anchor', 'end').attr('dominant-baseline', 'middle')
                .attr('font-size', '18px').text(d => d.flag);
            
            // Values
            g.selectAll('.value').data(topCountries).enter().append('text')
                .attr('y', d => y(d.country) + y.bandwidth() / 2)
                .attr('x', d => x(d.value) + 8).attr('dominant-baseline', 'middle')
                .attr('fill', '#f5f0e8').attr('font-size', '12px').attr('font-weight', '600')
                .text(d => d.value.toLocaleString());
            
            // Country names inside bars
            g.selectAll('.name').data(topCountries).enter().append('text')
                .attr('y', d => y(d.country) + y.bandwidth() / 2)
                .attr('x', 10).attr('dominant-baseline', 'middle')
                .attr('fill', '#0a0a12').attr('font-size', '11px').attr('font-weight', '600')
                .text(d => d.country);
        }
        
        // Sparklines
        function createSparkline(containerId, dataArr, color) {
            const container = d3.select(containerId);
            const width = container.node().getBoundingClientRect().width;
            const height = 50;
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            const x = d3.scaleLinear().domain([0, dataArr.length - 1]).range([0, width]);
            const y = d3.scaleLinear().domain([d3.min(dataArr) * 0.9, d3.max(dataArr) * 1.1]).range([height - 5, 5]);
            
            const line = d3.line().x((d, i) => x(i)).y(d => y(d)).curve(d3.curveMonotoneX);
            svg.append('path').datum(dataArr).attr('fill', 'none').attr('stroke', color).attr('stroke-width', 2).attr('d', line);
        }
        
        // World Mine Production Area Chart
        function createWorldMineChart() {
            const container = d3.select('#world-mine-chart');
            container.selectAll('*').remove();
            
            const width = container.node().getBoundingClientRect().width;
            const height = 320;
            const margin = {top: 20, right: 60, bottom: 40, left: 50};
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
            
            const prodData = data.worldMineProduction;
            
            const x = d3.scaleLinear()
                .domain([1960, 2024])
                .range([0, innerWidth]);
            
            const y = d3.scaleLinear()
                .domain([0, 25000])
                .range([innerHeight, 0]);
            
            // Grid lines
            g.append('g').attr('class', 'grid')
                .call(d3.axisLeft(y).tickSize(-innerWidth).tickFormat('').ticks(5))
                .selectAll('line').attr('stroke', 'rgba(255,255,255,0.05)');
            
            // Area gradient
            const gradient = svg.append('defs').append('linearGradient')
                .attr('id', 'world-mine-gradient')
                .attr('x1', '0%').attr('y1', '0%').attr('x2', '0%').attr('y2', '100%');
            gradient.append('stop').attr('offset', '0%').attr('stop-color', '#B87333').attr('stop-opacity', 0.6);
            gradient.append('stop').attr('offset', '100%').attr('stop-color', '#B87333').attr('stop-opacity', 0.05);
            
            // Area
            const area = d3.area()
                .x(d => x(d.year))
                .y0(innerHeight)
                .y1(d => y(d.value))
                .curve(d3.curveMonotoneX);
            
            g.append('path')
                .datum(prodData)
                .attr('fill', 'url(#world-mine-gradient)')
                .attr('d', area);
            
            // Line
            const line = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.value))
                .curve(d3.curveMonotoneX);
            
            g.append('path')
                .datum(prodData)
                .attr('fill', 'none')
                .attr('stroke', '#B87333')
                .attr('stroke-width', 2.5)
                .attr('d', line);
            
            // Current value marker
            const current = prodData[prodData.length - 1];
            g.append('circle')
                .attr('cx', x(current.year))
                .attr('cy', y(current.value))
                .attr('r', 6)
                .attr('fill', '#B87333')
                .attr('stroke', '#fff')
                .attr('stroke-width', 2);
            g.append('text')
                .attr('x', x(current.year) - 5)
                .attr('y', y(current.value) - 12)
                .attr('text-anchor', 'end')
                .attr('fill', '#B87333')
                .attr('font-size', '12px')
                .attr('font-weight', '700')
                .text(`${(current.value / 1000).toFixed(1)}M`);
            
            // Axes
            g.append('g')
                .attr('transform', `translate(0,${innerHeight})`)
                .call(d3.axisBottom(x).tickFormat(d3.format('d')).ticks(10))
                .selectAll('text').attr('fill', '#a09890').attr('font-size', '10px');
            
            g.append('g')
                .call(d3.axisLeft(y).ticks(5).tickFormat(d => (d / 1000).toFixed(0)))
                .selectAll('text').attr('fill', '#a09890').attr('font-size', '10px');
            
            // Interactive elements
            const verticalLine = g.append('line')
                .attr('y1', 0).attr('y2', innerHeight)
                .attr('stroke', '#fff').attr('stroke-width', 1)
                .attr('stroke-dasharray', '4,4').attr('opacity', 0);
            
            const hoverDot = g.append('circle')
                .attr('r', 7).attr('fill', '#B87333')
                .attr('stroke', '#fff').attr('stroke-width', 2).attr('opacity', 0);
            
            // Tooltip box
            const tooltipBox = g.append('g').attr('class', 'tooltip-box').attr('opacity', 0);
            tooltipBox.append('rect')
                .attr('fill', 'rgba(10,10,18,0.95)')
                .attr('stroke', 'rgba(184,115,51,0.3)')
                .attr('rx', 8).attr('width', 140).attr('height', 70);
            const tooltipContent = tooltipBox.append('g').attr('transform', 'translate(12, 20)');
            
            tooltipContent.append('text').attr('class', 'tooltip-year')
                .attr('fill', '#B87333').attr('font-size', '13px').attr('font-weight', '700');
            tooltipContent.append('text').attr('class', 'tooltip-value')
                .attr('y', 22).attr('fill', '#f5f0e8').attr('font-size', '16px').attr('font-weight', '700');
            tooltipContent.append('text').attr('class', 'tooltip-growth')
                .attr('y', 42).attr('fill', '#a09890').attr('font-size', '11px');
            
            // Overlay
            g.append('rect')
                .attr('width', innerWidth).attr('height', innerHeight)
                .attr('fill', 'none').attr('pointer-events', 'all')
                .on('mousemove touchmove', function(event) {
                    event.preventDefault();
                    const [mx] = d3.pointer(event);
                    const year = Math.round(x.invert(mx));
                    const clampedYear = Math.max(1960, Math.min(2024, year));
                    
                    const dataPoint = prodData.find(d => d.year === clampedYear);
                    if (!dataPoint) return;
                    
                    const xPos = x(clampedYear);
                    const yPos = y(dataPoint.value);
                    
                    verticalLine.attr('x1', xPos).attr('x2', xPos).attr('opacity', 0.5);
                    hoverDot.attr('cx', xPos).attr('cy', yPos).attr('opacity', 1);
                    
                    // Calculate growth since 1960
                    const base = prodData[0].value;
                    const growth = ((dataPoint.value - base) / base) * 100;
                    
                    tooltipContent.select('.tooltip-year').text(clampedYear);
                    tooltipContent.select('.tooltip-value').text(`${(dataPoint.value / 1000).toFixed(2)} Million`);
                    tooltipContent.select('.tooltip-growth').text(`+${growth.toFixed(0)}% since 1960`);
                    
                    let tooltipX = xPos + 15;
                    if (tooltipX + 140 > innerWidth) tooltipX = xPos - 155;
                    tooltipBox.attr('transform', `translate(${tooltipX}, ${Math.max(10, yPos - 35)})`).attr('opacity', 1);
                })
                .on('mouseleave touchend', function() {
                    verticalLine.attr('opacity', 0);
                    hoverDot.attr('opacity', 0);
                    tooltipBox.attr('opacity', 0);
                });
        }
        
        // Share race chart
        function createShareRaceChart() {
            const container = d3.select('#share-race-chart');
            const width = container.node().getBoundingClientRect().width;
            const height = 350;
            const margin = {top: 20, right: 110, bottom: 40, left: 60};
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
            
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const countries = [
                {key: 'Chile', color: '#B87333', label: 'Chile'},
                {key: 'Congo', color: '#9b59b6', label: 'Congo'},
                {key: 'Peru', color: '#4a9eff', label: 'Peru'},
                {key: 'China', color: '#e74c3c', label: 'China'},
                {key: 'USA', color: '#666', label: 'USA'}
            ];
            
            const x = d3.scaleLinear().domain([2003, 2024]).range([0, innerWidth]);
            const y = d3.scaleLinear().domain([0, 7000]).range([innerHeight, 0]);
            
            // Track selected country (for click)
            let selectedCountry = null;
            // Track hovered country
            let hoveredCountry = null;
            
            // Grid
            g.append('g').attr('class', 'grid')
                .call(d3.axisLeft(y).tickSize(-innerWidth).tickFormat(''));
            
            // Lines group
            const linesGroup = g.append('g').attr('class', 'lines-group');
            
            // Draw lines for each country
            countries.forEach(country => {
                // Filter data for Congo to only include 2013 onwards
                const countryData = country.key === 'Congo' 
                    ? data.worldProduction.filter(d => d.year >= 2013)
                    : data.worldProduction;
                
                const lineGenerator = d3.line()
                    .x(d => x(d.year))
                    .y(d => y(d[country.key]))
                    .curve(d3.curveMonotoneX);
                
                // Invisible wider path for easier hovering/clicking
                linesGroup.append('path')
                    .datum(countryData)
                    .attr('class', `line-hitarea line-hitarea-${country.key}`)
                    .attr('data-country', country.key)
                    .attr('fill', 'none')
                    .attr('stroke', 'transparent')
                    .attr('stroke-width', 20)
                    .attr('d', lineGenerator)
                    .style('cursor', 'pointer');
                
                // Visible line
                linesGroup.append('path')
                    .datum(countryData)
                    .attr('class', `country-line country-line-${country.key}`)
                    .attr('data-country', country.key)
                    .attr('fill', 'none')
                    .attr('stroke', country.color)
                    .attr('stroke-width', country.key === 'Chile' || country.key === 'Congo' ? 3 : 2)
                    .attr('d', lineGenerator)
                    .style('pointer-events', 'none')
                    .style('transition', 'opacity 0.2s, stroke-width 0.2s');
                
                // End label
                const lastPoint = data.worldProduction[data.worldProduction.length - 1];
                linesGroup.append('text')
                    .attr('class', `country-label country-label-${country.key}`)
                    .attr('data-country', country.key)
                    .attr('x', x(2024) + 8)
                    .attr('y', y(lastPoint[country.key]))
                    .attr('fill', country.color)
                    .attr('font-size', '11px')
                    .attr('font-weight', '600')
                    .attr('dominant-baseline', 'middle')
                    .style('pointer-events', 'none')
                    .style('transition', 'opacity 0.2s')
                    .text(`${country.label} ${lastPoint[country.key].toLocaleString()}`);
            });
            
            // Function to update line highlighting
            function updateHighlight(activeCountry, isClick) {
                if (activeCountry) {
                    countries.forEach(c => {
                        const isActive = c.key === activeCountry;
                        linesGroup.select(`.country-line-${c.key}`)
                            .style('opacity', isActive ? 1 : 0.15)
                            .attr('stroke-width', isActive ? 5 : 2);
                        linesGroup.select(`.country-label-${c.key}`)
                            .style('opacity', isActive ? 1 : 0.15);
                    });
                } else {
                    countries.forEach(c => {
                        linesGroup.select(`.country-line-${c.key}`)
                            .style('opacity', 1)
                            .attr('stroke-width', c.key === 'Chile' || c.key === 'Congo' ? 3 : 2);
                        linesGroup.select(`.country-label-${c.key}`)
                            .style('opacity', 1);
                    });
                }
            }
            
            // Axes
            g.append('g').attr('class', 'axis')
                .attr('transform', `translate(0,${innerHeight})`)
                .call(d3.axisBottom(x).tickFormat(d3.format('d')).ticks(10));
            
            g.append('g').attr('class', 'axis')
                .call(d3.axisLeft(y).tickFormat(d => d.toLocaleString()));
            
            // Y axis label
            g.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -innerHeight / 2)
                .attr('y', -50)
                .attr('text-anchor', 'middle')
                .attr('fill', '#666')
                .attr('font-size', '11px')
                .text('Thousand Metric Tonnes');
            
            // Single hover dot
            const hoverDot = g.append('circle')
                .attr('class', 'hover-dot')
                .attr('r', 7)
                .attr('stroke', '#fff')
                .attr('stroke-width', 2)
                .attr('opacity', 0);
            
            // Vertical line
            const verticalLine = g.append('line')
                .attr('class', 'hover-line')
                .attr('y1', 0)
                .attr('y2', innerHeight)
                .attr('stroke', '#fff')
                .attr('stroke-width', 1)
                .attr('stroke-dasharray', '4,4')
                .attr('opacity', 0);
            
            // Simple tooltip box (single country)
            const tooltipBox = g.append('g').attr('class', 'tooltip-box').attr('opacity', 0);
            tooltipBox.append('rect')
                .attr('class', 'tooltip-bg')
                .attr('fill', 'rgba(10,10,18,0.95)')
                .attr('stroke', 'rgba(255,255,255,0.1)')
                .attr('rx', 8);
            const tooltipContent = tooltipBox.append('g').attr('transform', 'translate(12, 20)');
            tooltipContent.append('text')
                .attr('class', 'tooltip-country')
                .attr('fill', '#f5f0e8')
                .attr('font-size', '13px')
                .attr('font-weight', '700');
            tooltipContent.append('text')
                .attr('class', 'tooltip-year')
                .attr('y', 20)
                .attr('fill', '#a09890')
                .attr('font-size', '11px');
            tooltipContent.append('text')
                .attr('class', 'tooltip-value')
                .attr('y', 38)
                .attr('fill', '#f5f0e8')
                .attr('font-size', '14px')
                .attr('font-weight', '600');
            
            // Hover and click handlers for each line
            linesGroup.selectAll('.line-hitarea')
                .on('mouseenter', function(event) {
                    const countryKey = d3.select(this).attr('data-country');
                    hoveredCountry = countryKey;
                    
                    // Only update highlight if no country is clicked/selected
                    if (!selectedCountry) {
                        updateHighlight(countryKey, false);
                    }
                })
                .on('mousemove', function(event) {
                    const countryKey = d3.select(this).attr('data-country');
                    const country = countries.find(c => c.key === countryKey);
                    
                    const [mx] = d3.pointer(event);
                    const year = Math.round(x.invert(mx));
                    const clampedYear = Math.max(2003, Math.min(2024, year));
                    
                    // For Congo, clamp to 2013 minimum
                    const effectiveYear = countryKey === 'Congo' ? Math.max(2013, clampedYear) : clampedYear;
                    
                    const yearData = data.worldProduction.find(d => d.year === effectiveYear);
                    if (!yearData) return;
                    
                    const xPos = x(effectiveYear);
                    const yPos = y(yearData[countryKey]);
                    
                    // Update vertical line
                    verticalLine.attr('x1', xPos).attr('x2', xPos).attr('opacity', 0.5);
                    
                    // Update hover dot
                    hoverDot
                        .attr('cx', xPos)
                        .attr('cy', yPos)
                        .attr('fill', country.color)
                        .attr('opacity', 1);
                    
                    // Update tooltip
                    tooltipContent.select('.tooltip-country').text(country.label).attr('fill', country.color);
                    tooltipContent.select('.tooltip-year').text(`Year: ${effectiveYear}`);
                    tooltipContent.select('.tooltip-value').text(`${yearData[countryKey].toLocaleString()}`);
                    
                    // Size and position tooltip
                    tooltipBox.select('.tooltip-bg').attr('width', 130).attr('height', 65);
                    let tooltipX = xPos + 15;
                    if (tooltipX + 130 > innerWidth) tooltipX = xPos - 145;
                    let tooltipY = yPos - 30;
                    if (tooltipY < 0) tooltipY = yPos + 10;
                    tooltipBox.attr('transform', `translate(${tooltipX}, ${tooltipY})`).attr('opacity', 1);
                })
                .on('mouseleave', function() {
                    hoveredCountry = null;
                    verticalLine.attr('opacity', 0);
                    hoverDot.attr('opacity', 0);
                    tooltipBox.attr('opacity', 0);
                    
                    // Reset highlight if no country is selected
                    if (!selectedCountry) {
                        updateHighlight(null, false);
                    }
                })
                .on('click', function(event) {
                    event.stopPropagation();
                    const countryKey = d3.select(this).attr('data-country');
                    
                    if (selectedCountry === countryKey) {
                        // Clicking same line - deselect
                        selectedCountry = null;
                        updateHighlight(hoveredCountry, false);
                    } else {
                        // Select this line
                        selectedCountry = countryKey;
                        updateHighlight(countryKey, true);
                    }
                });
            
            // Click on SVG background to reset selection
            svg.on('click', function(event) {
                if (event.target.tagName === 'svg') {
                    selectedCountry = null;
                    updateHighlight(hoveredCountry || null, false);
                }
            });
            
            // Add instruction text
            g.append('text')
                .attr('x', innerWidth / 2)
                .attr('y', innerHeight + 35)
                .attr('text-anchor', 'middle')
                .attr('fill', '#666')
                .attr('font-size', '10px')
                .text('Hover over a line to see details ‚Ä¢ Click to lock highlight');
        }
        
        // Mining GDP Area Chart - Clean Design
        function createGDPStackedChart() {
            const container = d3.select('#gdp-stacked-chart');
            container.selectAll('*').remove();
            
            const containerWidth = container.node().getBoundingClientRect().width;
            const width = Math.max(containerWidth, 300);
            const height = 400;
            const margin = {top: 40, right: 30, bottom: 50, left: 60};
            
            const svg = container.append('svg')
                .attr('width', '100%')
                .attr('height', height)
                .attr('viewBox', `0 0 ${width} ${height}`)
                .attr('preserveAspectRatio', 'xMidYMid meet');
            const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
            
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const miningData = data.miningGDP;
            
            // Scales
            const x = d3.scaleBand()
                .domain(miningData.map(d => d.period))
                .range([0, innerWidth])
                .padding(0.1);
            
            const y = d3.scaleLinear()
                .domain([0, 50000])
                .range([innerHeight, 0]);
            
            // Gradient for copper area
            const copperGradient = svg.append('defs').append('linearGradient')
                .attr('id', 'copper-gdp-gradient')
                .attr('x1', '0%').attr('y1', '0%').attr('x2', '0%').attr('y2', '100%');
            copperGradient.append('stop').attr('offset', '0%').attr('stop-color', '#B87333').attr('stop-opacity', 0.9);
            copperGradient.append('stop').attr('offset', '100%').attr('stop-color', '#B87333').attr('stop-opacity', 0.3);
            
            // Gradient for other mining
            const otherGradient = svg.append('defs').append('linearGradient')
                .attr('id', 'other-gdp-gradient')
                .attr('x1', '0%').attr('y1', '0%').attr('x2', '0%').attr('y2', '100%');
            otherGradient.append('stop').attr('offset', '0%').attr('stop-color', '#D4956A').attr('stop-opacity', 0.95);
            otherGradient.append('stop').attr('offset', '100%').attr('stop-color', '#D4956A').attr('stop-opacity', 0.5);
            
            // Grid lines
            g.append('g').attr('class', 'grid')
                .call(d3.axisLeft(y).tickSize(-innerWidth).tickFormat('').ticks(5))
                .selectAll('line').attr('stroke', 'rgba(255,255,255,0.05)');
            g.select('.grid .domain').remove();
            
            // Area for copper mining (bottom layer)
            const copperArea = d3.area()
                .x(d => x(d.period) + x.bandwidth() / 2)
                .y0(innerHeight)
                .y1(d => y(d.copper))
                .curve(d3.curveMonotoneX);
            
            g.append('path')
                .datum(miningData)
                .attr('fill', 'url(#copper-gdp-gradient)')
                .attr('d', copperArea);
            
            // Area for total (copper + other) - creates the "other" visual on top
            const totalArea = d3.area()
                .x(d => x(d.period) + x.bandwidth() / 2)
                .y0(d => y(d.copper))
                .y1(d => y(d.copper + d.other))
                .curve(d3.curveMonotoneX);
            
            g.append('path')
                .datum(miningData)
                .attr('fill', 'url(#other-gdp-gradient)')
                .attr('d', totalArea);
            
            // Top line for total
            const topLine = d3.line()
                .x(d => x(d.period) + x.bandwidth() / 2)
                .y(d => y(d.copper + d.other))
                .curve(d3.curveMonotoneX);
            
            g.append('path')
                .datum(miningData)
                .attr('fill', 'none')
                .attr('stroke', '#D4956A')
                .attr('stroke-width', 2)
                .attr('d', topLine);
            
            // Key annotations (peak, low, current)
            const annotations = [
                {period: 'Avg 06-10', label: 'Baseline', share: 16.7, position: 'above'},
                {period: '2016', label: 'Low', share: 8.1, position: 'above'},
                {period: '2021', label: 'Peak', share: 14.1, position: 'above', highlight: true},
                {period: '2023', label: 'Current', share: 11.9, position: 'above'}
            ];
            
            annotations.forEach(ann => {
                const dataPoint = miningData.find(d => d.period === ann.period);
                if (!dataPoint) return;
                
                const xPos = x(ann.period) + x.bandwidth() / 2;
                const yPos = y(dataPoint.copper + dataPoint.other);
                
                // Dot
                g.append('circle')
                    .attr('cx', xPos)
                    .attr('cy', yPos)
                    .attr('r', ann.highlight ? 8 : 5)
                    .attr('fill', ann.highlight ? '#f5f0e8' : '#B87333')
                    .attr('stroke', ann.highlight ? '#B87333' : 'none')
                    .attr('stroke-width', 3);
                
                // Label background
                const labelY = yPos - 25;
                g.append('text')
                    .attr('x', xPos)
                    .attr('y', labelY)
                    .attr('text-anchor', 'middle')
                    .attr('fill', ann.highlight ? '#f5f0e8' : '#a09890')
                    .attr('font-size', ann.highlight ? '12px' : '10px')
                    .attr('font-weight', ann.highlight ? '700' : '500')
                    .text(`${ann.share}%`);
                
                if (ann.highlight) {
                    // Add "Peak" label for 2021
                    g.append('text')
                        .attr('x', xPos)
                        .attr('y', labelY - 14)
                        .attr('text-anchor', 'middle')
                        .attr('fill', '#B87333')
                        .attr('font-size', '9px')
                        .attr('font-weight', '600')
                        .text('$44.5B');
                }
            });
            
            // X axis
            g.append('g')
                .attr('transform', `translate(0,${innerHeight})`)
                .call(d3.axisBottom(x))
                .selectAll('text')
                .attr('fill', '#a09890')
                .attr('font-size', '10px')
                .attr('transform', 'rotate(-40)')
                .attr('text-anchor', 'end');
            
            // Y axis
            g.append('g')
                .call(d3.axisLeft(y).ticks(5).tickFormat(d => '$' + (d / 1000).toFixed(0) + 'B'))
                .selectAll('text').attr('fill', '#a09890').attr('font-size', '10px');
            
            // Legend (minimal, bottom)
            const legend = g.append('g')
                .attr('transform', `translate(${innerWidth / 2 - 120}, ${innerHeight + 38})`);
            
            legend.append('rect').attr('width', 12).attr('height', 12).attr('fill', '#B87333').attr('rx', 2);
            legend.append('text').attr('x', 16).attr('y', 10).attr('fill', '#a09890').attr('font-size', '11px').text('Copper mining');
            
            legend.append('rect').attr('x', 110).attr('width', 12).attr('height', 12).attr('fill', '#D4956A').attr('rx', 2);
            legend.append('text').attr('x', 126).attr('y', 10).attr('fill', '#a09890').attr('font-size', '11px').text('Other mining');
            
            // Interactive tooltip
            const tooltipLine = g.append('line')
                .attr('y1', 0).attr('y2', innerHeight)
                .attr('stroke', '#fff').attr('stroke-width', 1)
                .attr('stroke-dasharray', '4,4').attr('opacity', 0);
            
            const tooltipDot = g.append('circle')
                .attr('r', 6).attr('fill', '#f5f0e8')
                .attr('stroke', '#B87333').attr('stroke-width', 2).attr('opacity', 0);
            
            const tooltipBox = g.append('g').attr('class', 'tooltip-box').attr('opacity', 0);
            tooltipBox.append('rect')
                .attr('fill', 'rgba(10,10,18,0.95)')
                .attr('stroke', 'rgba(184,115,51,0.3)')
                .attr('rx', 8).attr('width', 160).attr('height', 85);
            const tooltipContent = tooltipBox.append('g').attr('transform', 'translate(12, 18)');
            tooltipContent.append('text').attr('class', 'tooltip-period').attr('fill', '#B87333').attr('font-size', '12px').attr('font-weight', '700');
            tooltipContent.append('text').attr('class', 'tooltip-total').attr('y', 20).attr('fill', '#f5f0e8').attr('font-size', '14px').attr('font-weight', '600');
            tooltipContent.append('text').attr('class', 'tooltip-copper').attr('y', 40).attr('fill', '#B87333').attr('font-size', '11px');
            tooltipContent.append('text').attr('class', 'tooltip-other').attr('y', 55).attr('fill', '#D4956A').attr('font-size', '11px');
            tooltipContent.append('text').attr('class', 'tooltip-share').attr('y', 70).attr('fill', '#a09890').attr('font-size', '10px');
            
            // Hover overlay
            g.append('rect')
                .attr('width', innerWidth).attr('height', innerHeight)
                .attr('fill', 'none').attr('pointer-events', 'all')
                .on('mousemove touchmove', function(event) {
                    event.preventDefault();
                    const [mx] = d3.pointer(event);
                    
                    // Find closest data point
                    let closestDist = Infinity;
                    let closestData = null;
                    miningData.forEach(d => {
                        const xPos = x(d.period) + x.bandwidth() / 2;
                        const dist = Math.abs(mx - xPos);
                        if (dist < closestDist) {
                            closestDist = dist;
                            closestData = d;
                        }
                    });
                    
                    if (!closestData) return;
                    
                    const xPos = x(closestData.period) + x.bandwidth() / 2;
                    const yPos = y(closestData.copper + closestData.other);
                    const total = closestData.copper + closestData.other;
                    
                    tooltipLine.attr('x1', xPos).attr('x2', xPos).attr('opacity', 0.4);
                    tooltipDot.attr('cx', xPos).attr('cy', yPos).attr('opacity', 1);
                    
                    tooltipContent.select('.tooltip-period').text(closestData.period);
                    tooltipContent.select('.tooltip-total').text('$' + (total / 1000).toFixed(1) + ' Billion');
                    tooltipContent.select('.tooltip-copper').text('Copper: $' + (closestData.copper / 1000).toFixed(1) + 'B');
                    tooltipContent.select('.tooltip-other').text('Other: $' + (closestData.other / 1000).toFixed(1) + 'B');
                    tooltipContent.select('.tooltip-share').text('Share of GDP: ' + closestData.share + '%');
                    
                    let tooltipX = xPos + 15;
                    if (tooltipX + 160 > innerWidth) tooltipX = xPos - 175;
                    tooltipBox.attr('transform', `translate(${tooltipX}, 20)`).attr('opacity', 1);
                })
                .on('mouseleave touchend', function() {
                    tooltipLine.attr('opacity', 0);
                    tooltipDot.attr('opacity', 0);
                    tooltipBox.attr('opacity', 0);
                });
        }
        
        // Sankey Diagram - Mine to Company flow
        // Sankey Diagram - Mine to Company flow
        function createSankeyChart() {
            const container = d3.select('#sankey-chart');
            const width = container.node().getBoundingClientRect().width;
            const height = 720;
            const margin = {top: 30, right: 220, bottom: 50, left: 200};
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
            
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            // Company colors
            const companyColors = {
                'BHP': '#4a9eff',
                'Codelco': '#B87333',
                'Antofagasta Minerals': '#2ecc71',
                'Anglo American': '#9b59b6',
                'Teck': '#e67e22',
                'Lundin Mining': '#1abc9c',
                'Freeport-McMoRan': '#e74c3c',
                'Collahuasi': '#f39c12',
                'Glencore': '#34495e',
                'Otros': '#7f8c8d'
            };
            
            // Prepare data - sort mines by production
            const mines = [...data.companies].sort((a, b) => b.value - a.value);
            mines.push({mine: "Otros", company: "Otros", value: 601.6});
            
            // Aggregate companies
            const companyTotals = {};
            mines.forEach(d => {
                companyTotals[d.company] = (companyTotals[d.company] || 0) + d.value;
            });
            
            const companiesSorted = Object.entries(companyTotals)
                .sort((a, b) => b[1] - a[1])
                .map(d => d[0]);
            
            const totalProduction = d3.sum(mines, d => d.value);
            
            // Calculate positions for mines (left side)
            const mineScale = d3.scaleBand()
                .domain(mines.map(d => d.mine))
                .range([0, innerHeight])
                .padding(0.08);
            
            // Calculate proportional heights for companies (right side)
            const companyPadding = 8;
            const totalPadding = companyPadding * (companiesSorted.length - 1);
            const availableHeight = innerHeight - totalPadding;
            
            let companyPositions = {};
            let currentY = 0;
            companiesSorted.forEach(company => {
                const h = (companyTotals[company] / totalProduction) * availableHeight;
                companyPositions[company] = { y: currentY, height: h };
                currentY += h + companyPadding;
            });
            
            // Track company current Y position for stacking links
            const companyYOffset = {};
            companiesSorted.forEach(c => companyYOffset[c] = 0);
            
            // State for selection
            let selectedMine = null;
            let selectedCompany = null;
            
            // Draw links (flows)
            const links = g.append('g').attr('class', 'links');
            
            mines.forEach(mine => {
                const sourceY = mineScale(mine.mine);
                const sourceHeight = mineScale.bandwidth();
                
                const company = mine.company;
                const companyTotal = companyTotals[company];
                const companyPos = companyPositions[company];
                const linkHeight = (mine.value / companyTotal) * companyPos.height;
                
                const targetY = companyPos.y + companyYOffset[company];
                companyYOffset[company] += linkHeight;
                
                // Create gradient
                const gradientId = `gradient-${mine.mine.replace(/[^a-zA-Z0-9]/g, '')}`;
                const gradient = svg.append('defs').append('linearGradient')
                    .attr('id', gradientId)
                    .attr('x1', '0%').attr('x2', '100%');
                gradient.append('stop').attr('offset', '0%').attr('stop-color', companyColors[company] || '#666').attr('stop-opacity', 0.5);
                gradient.append('stop').attr('offset', '100%').attr('stop-color', companyColors[company] || '#666').attr('stop-opacity', 0.85);
                
                const areaPath = `
                    M 0,${sourceY}
                    C ${innerWidth * 0.4},${sourceY} ${innerWidth * 0.6},${targetY} ${innerWidth},${targetY}
                    L ${innerWidth},${targetY + linkHeight}
                    C ${innerWidth * 0.6},${targetY + linkHeight} ${innerWidth * 0.4},${sourceY + sourceHeight} 0,${sourceY + sourceHeight}
                    Z
                `;
                
                const path = links.append('path')
                    .attr('class', 'sankey-link')
                    .attr('data-mine', mine.mine)
                    .attr('data-company', company)
                    .attr('d', areaPath)
                    .attr('fill', `url(#${gradientId})`)
                    .attr('stroke', 'none')
                    .attr('opacity', 0.7)
                    .style('cursor', 'pointer');
                
                path.on('click', function(event) {
                    event.stopPropagation();
                    if (selectedMine === mine.mine) {
                        selectedMine = null;
                        selectedCompany = null;
                        resetSelection();
                    } else {
                        selectedMine = mine.mine;
                        selectedCompany = null;
                        highlightMineSelection(mine.mine, company);
                    }
                });
                
                path.on('mouseover', function(event) {
                    if (!selectedMine && !selectedCompany) {
                        d3.select(this).attr('opacity', 1);
                    }
                    const pct = (mine.value / totalProduction * 100).toFixed(1);
                    const companyPct = (mine.value / companyTotal * 100).toFixed(1);
                    showTooltip(event, `
                        <div class="tooltip-title">${mine.mine}</div>
                        <div class="tooltip-value">${mine.value.toFixed(1)}</div>
                        <div class="tooltip-sub">‚Üí ${company}</div>
                        <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <div style="color: #a09890;">${pct}% of Chile total</div>
                            <div style="color: #a09890;">${companyPct}% of ${company}</div>
                        </div>
                        <div style="margin-top: 8px; color: #ffd93d; font-size: 10px;">Click to select</div>
                    `);
                })
                .on('mousemove', function(event) {
                    tooltip.style('left', (event.pageX + 15) + 'px').style('top', (event.pageY - 10) + 'px');
                })
                .on('mouseout', function() {
                    if (!selectedMine && !selectedCompany) {
                        d3.select(this).attr('opacity', 0.7);
                    }
                    hideTooltip();
                });
            });
            
            // Selection functions
            function highlightMineSelection(mineName, companyName) {
                links.selectAll('.sankey-link').attr('opacity', 0.15).attr('stroke', 'none');
                links.select(`[data-mine="${mineName}"]`).attr('opacity', 1).attr('stroke', '#fff').attr('stroke-width', 2);
                g.selectAll('.mine-label, .mine-value, .company-label, .company-value, .company-pct').attr('opacity', 0.3);
                g.selectAll(`.mine-label[data-mine="${mineName}"], .mine-value[data-mine="${mineName}"]`).attr('opacity', 1);
                g.selectAll(`.company-label[data-company="${companyName}"], .company-value[data-company="${companyName}"], .company-pct[data-company="${companyName}"]`).attr('opacity', 1);
                const mine = mines.find(m => m.mine === mineName);
                showSelectionInfo(`${mineName}: ${mine.value.toFixed(1)} ‚Üí ${companyName}`);
            }
            
            function highlightCompanySelection(companyName) {
                links.selectAll('.sankey-link').attr('opacity', 0.15).attr('stroke', 'none');
                links.selectAll(`[data-company="${companyName}"]`).attr('opacity', 1).attr('stroke', '#fff').attr('stroke-width', 1);
                g.selectAll('.mine-label, .mine-value, .company-label, .company-value, .company-pct').attr('opacity', 0.3);
                g.selectAll(`.company-label[data-company="${companyName}"], .company-value[data-company="${companyName}"], .company-pct[data-company="${companyName}"]`).attr('opacity', 1);
                g.selectAll('.company-node').attr('stroke', 'none');
                g.select(`.company-node[data-company="${companyName}"]`).attr('stroke', '#fff').attr('stroke-width', 2);
                const companyMines = mines.filter(m => m.company === companyName);
                companyMines.forEach(m => {
                    g.selectAll(`.mine-label[data-mine="${m.mine}"], .mine-value[data-mine="${m.mine}"]`).attr('opacity', 1);
                });
                const total = companyTotals[companyName];
                const pct = (total / totalProduction * 100).toFixed(1);
                showSelectionInfo(`${companyName}: ${total.toFixed(0)} (${companyMines.length} mines, ${pct}% of total)`);
            }
            
            function resetSelection() {
                links.selectAll('.sankey-link').attr('opacity', 0.7).attr('stroke', 'none');
                g.selectAll('.mine-label, .mine-value, .company-label, .company-value, .company-pct').attr('opacity', 1);
                g.selectAll('.company-node').attr('stroke', 'none');
                hideSelectionInfo();
            }
            
            // Selection info box
            const selectionInfo = g.append('g')
                .attr('class', 'selection-info')
                .attr('transform', `translate(${innerWidth / 2 - 150}, ${innerHeight + 20})`)
                .attr('opacity', 0);
            selectionInfo.append('rect').attr('width', 300).attr('height', 30)
                .attr('fill', 'rgba(10,10,18,0.9)').attr('stroke', '#ffd93d').attr('stroke-width', 1).attr('rx', 6);
            selectionInfo.append('text').attr('class', 'selection-text')
                .attr('x', 150).attr('y', 20).attr('text-anchor', 'middle').attr('fill', '#ffd93d').attr('font-size', '11px');
            
            function showSelectionInfo(text) {
                selectionInfo.select('.selection-text').text(text);
                selectionInfo.attr('opacity', 1);
            }
            function hideSelectionInfo() {
                selectionInfo.attr('opacity', 0);
            }
            
            // Click on background to deselect
            svg.on('click', function() {
                if (selectedMine || selectedCompany) {
                    selectedMine = null;
                    selectedCompany = null;
                    resetSelection();
                }
            });
            
            // Draw mine nodes (left)
            mines.forEach(mine => {
                const y = mineScale(mine.mine);
                const h = mineScale.bandwidth();
                g.append('rect').attr('x', -8).attr('y', y).attr('width', 8).attr('height', h)
                    .attr('fill', companyColors[mine.company] || '#666').attr('rx', 2);
                g.append('text').attr('class', 'mine-label').attr('data-mine', mine.mine)
                    .attr('x', -15).attr('y', y + h / 2).attr('text-anchor', 'end').attr('dominant-baseline', 'middle')
                    .attr('fill', '#f5f0e8').attr('font-size', '13px').attr('font-weight', '500').text(mine.mine);
                g.append('text').attr('class', 'mine-value').attr('data-mine', mine.mine)
                    .attr('x', -15).attr('y', y + h / 2 + 14).attr('text-anchor', 'end').attr('dominant-baseline', 'middle')
                    .attr('fill', '#a09890').attr('font-size', '11px').text(`${mine.value.toFixed(0)}`);
            });
            
            // Draw company nodes (right) - clickable
            companiesSorted.forEach(company => {
                const pos = companyPositions[company];
                const total = companyTotals[company];
                const pct = (total / totalProduction * 100).toFixed(1);
                
                g.append('rect').attr('class', 'company-node').attr('data-company', company)
                    .attr('x', innerWidth).attr('y', pos.y).attr('width', 12).attr('height', pos.height)
                    .attr('fill', companyColors[company] || '#666').attr('rx', 3).style('cursor', 'pointer')
                    .on('click', function(event) {
                        event.stopPropagation();
                        if (selectedCompany === company) {
                            selectedCompany = null;
                            selectedMine = null;
                            resetSelection();
                        } else {
                            selectedCompany = company;
                            selectedMine = null;
                            highlightCompanySelection(company);
                        }
                    })
                    .on('mouseover', function(event) {
                        if (!selectedMine && !selectedCompany) {
                            d3.select(this).attr('stroke', '#fff').attr('stroke-width', 2);
                        }
                        const companyMines = mines.filter(m => m.company === company).map(m => m.mine).join(', ');
                        showTooltip(event, `
                            <div class="tooltip-title">${company}</div>
                            <div class="tooltip-value">${total.toFixed(1)}</div>
                            <div class="tooltip-sub">${pct}% of Chile total</div>
                            <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); color: #a09890; font-size: 10px;">Mines: ${companyMines}</div>
                            <div style="margin-top: 8px; color: #ffd93d; font-size: 10px;">Click to highlight all mines</div>
                        `);
                    })
                    .on('mousemove', function(event) {
                        tooltip.style('left', (event.pageX + 15) + 'px').style('top', (event.pageY - 10) + 'px');
                    })
                    .on('mouseout', function() {
                        if (!selectedMine && !selectedCompany) {
                            d3.select(this).attr('stroke', 'none');
                        }
                        hideTooltip();
                    });
                
                if (pos.height > 25) {
                    g.append('text').attr('class', 'company-label').attr('data-company', company)
                        .attr('x', innerWidth + 20).attr('y', pos.y + pos.height / 2 - 10).attr('dominant-baseline', 'middle')
                        .attr('fill', '#f5f0e8').attr('font-size', '14px').attr('font-weight', '600').text(company);
                    g.append('text').attr('class', 'company-value').attr('data-company', company)
                        .attr('x', innerWidth + 20).attr('y', pos.y + pos.height / 2 + 6).attr('dominant-baseline', 'middle')
                        .attr('fill', companyColors[company] || '#666').attr('font-size', '13px').attr('font-weight', '700').text(`${total.toFixed(0)}`);
                    g.append('text').attr('class', 'company-pct').attr('data-company', company)
                        .attr('x', innerWidth + 20).attr('y', pos.y + pos.height / 2 + 22).attr('dominant-baseline', 'middle')
                        .attr('fill', '#a09890').attr('font-size', '11px').text(`${pct}%`);
                } else {
                    g.append('text').attr('class', 'company-label').attr('data-company', company)
                        .attr('x', innerWidth + 20).attr('y', pos.y + pos.height / 2).attr('dominant-baseline', 'middle')
                        .attr('fill', '#f5f0e8').attr('font-size', '11px').text(`${company.replace('-McMoRan', '')} ${total.toFixed(0)}`);
                }
            });
            
            // Title labels
            g.append('text').attr('x', -15).attr('y', -15).attr('text-anchor', 'end')
                .attr('fill', '#a09890').attr('font-size', '13px').attr('font-weight', '600').text('MINES');
            g.append('text').attr('x', innerWidth + 20).attr('y', -15)
                .attr('fill', '#a09890').attr('font-size', '13px').attr('font-weight', '600').text('COMPANIES');
            g.append('text').attr('x', innerWidth / 2).attr('y', -15).attr('text-anchor', 'middle')
                .attr('fill', '#666').attr('font-size', '11px').text('Click flow or company to highlight ‚Ä¢ Click background to reset');
        }
        
        function createCompanyTrendsChart() {
            const container = d3.select('#company-trends-chart');
            const width = container.node().getBoundingClientRect().width;
            const height = 320;
            const margin = {top: 20, right: 120, bottom: 40, left: 50};
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
            
            const companies = [
                {key: 'BHP', color: '#4a9eff', label: 'BHP'},
                {key: 'Codelco', color: '#B87333', label: 'Codelco'},
                {key: 'Antofagasta', color: '#2ecc71', label: 'Antofagasta Minerals'},
                {key: 'Collahuasi', color: '#f39c12', label: 'Collahuasi'},
                {key: 'Anglo', color: '#9b59b6', label: 'Anglo American'}
            ];
            
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const x = d3.scaleLinear().domain([2003, 2024]).range([0, innerWidth]);
            const y = d3.scaleLinear().domain([0, 2000]).range([innerHeight, 0]);
            
            // Grid
            g.append('g').attr('class', 'grid')
                .call(d3.axisLeft(y).tickSize(-innerWidth).tickFormat(''));
            
            // Lines
            companies.forEach(comp => {
                const line = d3.line()
                    .x(d => x(d.year))
                    .y(d => y(d[comp.key]))
                    .curve(d3.curveMonotoneX);
                
                g.append('path')
                    .datum(data.companyTrends)
                    .attr('fill', 'none')
                    .attr('stroke', comp.color)
                    .attr('stroke-width', comp.key === 'BHP' || comp.key === 'Codelco' ? 3 : 2)
                    .attr('d', line);
                
                // End label
                const lastPoint = data.companyTrends[data.companyTrends.length - 1];
                g.append('text')
                    .attr('x', x(2024) + 8)
                    .attr('y', y(lastPoint[comp.key]))
                    .attr('fill', comp.color)
                    .attr('font-size', '10px')
                    .attr('font-weight', '600')
                    .attr('dominant-baseline', 'middle')
                    .text(comp.label);
            });
            
            // Axes
            g.append('g').attr('class', 'axis')
                .attr('transform', `translate(0,${innerHeight})`)
                .call(d3.axisBottom(x).tickFormat(d3.format('d')).ticks(10));
            
            g.append('g').attr('class', 'axis')
                .call(d3.axisLeft(y).tickFormat(d => d > 0 ? d : ''));
            
            // Interactive elements
            const verticalLine = g.append('line')
                .attr('class', 'hover-line')
                .attr('y1', 0)
                .attr('y2', innerHeight)
                .attr('stroke', '#fff')
                .attr('stroke-width', 1)
                .attr('stroke-dasharray', '4,4')
                .attr('opacity', 0);
            
            // Dots for each company (hidden initially)
            const hoverDots = g.append('g').attr('class', 'hover-dots');
            companies.forEach(comp => {
                hoverDots.append('circle')
                    .attr('class', `hover-dot-${comp.key}`)
                    .attr('r', 6)
                    .attr('fill', comp.color)
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 2)
                    .attr('opacity', 0);
            });
            
            // Tooltip box
            const tooltipBox = g.append('g').attr('class', 'tooltip-box').attr('opacity', 0);
            tooltipBox.append('rect')
                .attr('fill', 'rgba(10,10,18,0.95)')
                .attr('stroke', 'rgba(255,255,255,0.1)')
                .attr('rx', 8)
                .attr('width', 160)
                .attr('height', 140);
            const tooltipContent = tooltipBox.append('g').attr('transform', 'translate(12, 20)');
            
            // Year label
            tooltipContent.append('text')
                .attr('class', 'tooltip-year')
                .attr('fill', '#f5f0e8')
                .attr('font-size', '14px')
                .attr('font-weight', '700');
            
            // Company values
            companies.forEach((comp, i) => {
                const row = tooltipContent.append('g').attr('transform', `translate(0, ${22 + i * 20})`);
                row.append('circle').attr('r', 5).attr('fill', comp.color).attr('cx', 5).attr('cy', -4);
                row.append('text')
                    .attr('class', `tooltip-${comp.key}`)
                    .attr('x', 15)
                    .attr('fill', '#a09890')
                    .attr('font-size', '11px');
            });
            
            // Overlay for mouse events
            g.append('rect')
                .attr('class', 'overlay')
                .attr('width', innerWidth)
                .attr('height', innerHeight)
                .attr('fill', 'none')
                .attr('pointer-events', 'all')
                .on('mousemove', function(event) {
                    const [mx] = d3.pointer(event);
                    const year = Math.round(x.invert(mx));
                    const clampedYear = Math.max(2003, Math.min(2024, year));
                    
                    const yearData = data.companyTrends.find(d => d.year === clampedYear);
                    if (!yearData) return;
                    
                    const xPos = x(clampedYear);
                    
                    // Update vertical line
                    verticalLine.attr('x1', xPos).attr('x2', xPos).attr('opacity', 0.5);
                    
                    // Update dots
                    companies.forEach(comp => {
                        hoverDots.select(`.hover-dot-${comp.key}`)
                            .attr('cx', xPos)
                            .attr('cy', y(yearData[comp.key]))
                            .attr('opacity', 1);
                    });
                    
                    // Update tooltip
                    tooltipContent.select('.tooltip-year').text(clampedYear);
                    companies.forEach(comp => {
                        tooltipContent.select(`.tooltip-${comp.key}`)
                            .text(`${comp.label}: ${yearData[comp.key].toLocaleString()}`);
                    });
                    
                    // Position tooltip
                    let tooltipX = xPos + 15;
                    if (tooltipX + 160 > innerWidth) tooltipX = xPos - 175;
                    tooltipBox.attr('transform', `translate(${tooltipX}, 10)`).attr('opacity', 1);
                })
                .on('mouseleave', function() {
                    verticalLine.attr('opacity', 0);
                    hoverDots.selectAll('circle').attr('opacity', 0);
                    tooltipBox.attr('opacity', 0);
                });
        }
        
        // Mine breakdown by company
        let currentCompanyView = 'Codelco';
        function createMineBreakdownChart(companyName) {
            currentCompanyView = companyName;
            const container = d3.select('#mine-breakdown-chart');
            container.selectAll('*').remove();
            
            const width = container.node().getBoundingClientRect().width;
            const height = 450;
            const margin = {top: 30, right: 150, bottom: 50, left: 60};
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
            
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const mines = data.mineYearlyData[companyName];
            if (!mines || mines.length === 0) return;
            
            // Calculate max value for y-axis
            const maxValue = d3.max(mines, m => d3.max(m.data, d => d.value));
            
            const x = d3.scaleLinear().domain([2003, 2024]).range([0, innerWidth]);
            const y = d3.scaleLinear().domain([0, maxValue * 1.1]).range([innerHeight, 0]);
            
            // Grid
            g.append('g').attr('class', 'grid')
                .call(d3.axisLeft(y).tickSize(-innerWidth).tickFormat(''))
                .selectAll('line').attr('stroke', 'rgba(255,255,255,0.05)');
            
            // Area fills (stacked feel)
            mines.forEach((mine, i) => {
                const area = d3.area()
                    .x(d => x(d.year))
                    .y0(innerHeight)
                    .y1(d => y(d.value))
                    .curve(d3.curveMonotoneX);
                
                g.append('path')
                    .datum(mine.data)
                    .attr('fill', mine.color)
                    .attr('fill-opacity', 0.1)
                    .attr('d', area);
            });
            
            // Lines
            mines.forEach(mine => {
                const line = d3.line()
                    .x(d => x(d.year))
                    .y(d => y(d.value))
                    .curve(d3.curveMonotoneX);
                
                g.append('path')
                    .datum(mine.data)
                    .attr('fill', 'none')
                    .attr('stroke', mine.color)
                    .attr('stroke-width', 2.5)
                    .attr('d', line);
                
                // End label
                const lastPoint = mine.data[mine.data.length - 1];
                g.append('text')
                    .attr('x', innerWidth + 10)
                    .attr('y', y(lastPoint.value))
                    .attr('fill', mine.color)
                    .attr('font-size', '11px')
                    .attr('font-weight', '600')
                    .attr('dominant-baseline', 'middle')
                    .text(mine.name);
                
                g.append('text')
                    .attr('x', innerWidth + 10)
                    .attr('y', y(lastPoint.value) + 14)
                    .attr('fill', '#a09890')
                    .attr('font-size', '10px')
                    .attr('dominant-baseline', 'middle')
                    .text(`${lastPoint.value.toFixed(0)} TMT`);
            });
            
            // Axes
            g.append('g').attr('class', 'axis')
                .attr('transform', `translate(0,${innerHeight})`)
                .call(d3.axisBottom(x).tickFormat(d3.format('d')).ticks(10));
            
            g.append('g').attr('class', 'axis')
                .call(d3.axisLeft(y).tickFormat(d => d > 0 ? d : ''));
            
            // Y-axis label
            g.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -innerHeight / 2)
                .attr('y', -45)
                .attr('text-anchor', 'middle')
                .attr('fill', '#a09890')
                .attr('font-size', '11px')
                .text('Production (Thousand Metric Tonnes)');
            
            // Interactive overlay
            const verticalLine = g.append('line')
                .attr('class', 'hover-line')
                .attr('y1', 0)
                .attr('y2', innerHeight)
                .attr('stroke', '#fff')
                .attr('stroke-width', 1)
                .attr('stroke-dasharray', '4,4')
                .attr('opacity', 0);
            
            // Hover dots
            const hoverDots = g.append('g').attr('class', 'hover-dots');
            mines.forEach(mine => {
                hoverDots.append('circle')
                    .attr('class', `hover-dot-${mine.name.replace(/[^a-zA-Z0-9]/g, '')}`)
                    .attr('r', 5)
                    .attr('fill', mine.color)
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 2)
                    .attr('opacity', 0);
            });
            
            // Tooltip box
            const tooltipBox = g.append('g').attr('class', 'tooltip-box').attr('opacity', 0);
            const boxHeight = 30 + mines.length * 22;
            tooltipBox.append('rect')
                .attr('fill', 'rgba(10,10,18,0.95)')
                .attr('stroke', 'rgba(255,255,255,0.15)')
                .attr('rx', 8)
                .attr('width', 180)
                .attr('height', boxHeight);
            
            const tooltipContent = tooltipBox.append('g').attr('transform', 'translate(12, 22)');
            tooltipContent.append('text')
                .attr('class', 'tooltip-year')
                .attr('fill', '#f5f0e8')
                .attr('font-size', '13px')
                .attr('font-weight', '700');
            
            mines.forEach((mine, i) => {
                const row = tooltipContent.append('g').attr('transform', `translate(0, ${20 + i * 20})`);
                row.append('circle').attr('r', 5).attr('fill', mine.color).attr('cx', 5).attr('cy', -3);
                row.append('text')
                    .attr('class', `tooltip-mine-${mine.name.replace(/[^a-zA-Z0-9]/g, '')}`)
                    .attr('x', 15)
                    .attr('fill', '#a09890')
                    .attr('font-size', '11px');
            });
            
            // Mouse overlay
            g.append('rect')
                .attr('class', 'overlay')
                .attr('width', innerWidth)
                .attr('height', innerHeight)
                .attr('fill', 'none')
                .attr('pointer-events', 'all')
                .on('mousemove', function(event) {
                    const [mx] = d3.pointer(event);
                    const year = Math.round(x.invert(mx));
                    const clampedYear = Math.max(2003, Math.min(2024, year));
                    const xPos = x(clampedYear);
                    
                    verticalLine.attr('x1', xPos).attr('x2', xPos).attr('opacity', 0.6);
                    
                    // Update dots and tooltip
                    let total = 0;
                    mines.forEach(mine => {
                        const yearData = mine.data.find(d => d.year === clampedYear);
                        const value = yearData ? yearData.value : 0;
                        total += value;
                        
                        hoverDots.select(`.hover-dot-${mine.name.replace(/[^a-zA-Z0-9]/g, '')}`)
                            .attr('cx', xPos)
                            .attr('cy', y(value))
                            .attr('opacity', value > 0 ? 1 : 0);
                        
                        tooltipContent.select(`.tooltip-mine-${mine.name.replace(/[^a-zA-Z0-9]/g, '')}`)
                            .text(`${mine.name}: ${value.toFixed(0)} TMT`);
                    });
                    
                    tooltipContent.select('.tooltip-year').text(`${companyName} - ${clampedYear}`);
                    
                    // Position tooltip
                    let tooltipX = xPos + 15;
                    if (tooltipX + 180 > innerWidth) tooltipX = xPos - 195;
                    tooltipBox.attr('transform', `translate(${tooltipX}, 20)`).attr('opacity', 1);
                })
                .on('mouseleave', function() {
                    verticalLine.attr('opacity', 0);
                    hoverDots.selectAll('circle').attr('opacity', 0);
                    tooltipBox.attr('opacity', 0);
                });
            
            // Company title in chart
            g.append('text')
                .attr('x', innerWidth / 2)
                .attr('y', -10)
                .attr('text-anchor', 'middle')
                .attr('fill', '#f5f0e8')
                .attr('font-size', '14px')
                .attr('font-weight', '600')
                .text(`${companyName} Mine Production (2003-2024)`);
        }
        
        // Codelco trend
        function createCodelcoTrend() {
            const container = d3.select('#codelco-trend-chart');
            const width = container.node().getBoundingClientRect().width;
            const height = 280;
            const margin = {top: 20, right: 30, bottom: 40, left: 50};
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
            
            const x = d3.scaleLinear().domain([2003, 2024]).range([0, width - margin.left - margin.right]);
            const y = d3.scaleLinear().domain([1200, 2000]).range([height - margin.top - margin.bottom, 0]);
            
            // Area
            const area = d3.area().x(d => x(d.year)).y0(y(1200)).y1(d => y(d.value)).curve(d3.curveMonotoneX);
            g.append('path').datum(data.codelcoTrend).attr('fill', 'rgba(184,115,51,0.2)').attr('d', area);
            
            // Line
            const line = d3.line().x(d => x(d.year)).y(d => y(d.value)).curve(d3.curveMonotoneX);
            g.append('path').datum(data.codelcoTrend)
                .attr('fill', 'none').attr('stroke', '#B87333').attr('stroke-width', 3).attr('d', line);
            
            // Annotations
            g.append('line').attr('x1', x(2015)).attr('x2', x(2015)).attr('y1', 0).attr('y2', height - margin.top - margin.bottom)
                .attr('stroke', '#2ecc71').attr('stroke-dasharray', '4,4').attr('opacity', 0.5);
            g.append('text').attr('x', x(2015) + 5).attr('y', 15).attr('fill', '#2ecc71').attr('font-size', '9px').text('Peak: 1,891');
            
            g.append('line').attr('x1', x(2022)).attr('x2', x(2022)).attr('y1', 0).attr('y2', height - margin.top - margin.bottom)
                .attr('stroke', '#e74c3c').attr('stroke-dasharray', '4,4').attr('opacity', 0.5);
            g.append('text').attr('x', x(2022) + 5).attr('y', 15).attr('fill', '#e74c3c').attr('font-size', '9px').text('Decline starts');
            
            g.append('g').attr('class', 'axis').attr('transform', `translate(0,${height - margin.top - margin.bottom})`)
                .call(d3.axisBottom(x).tickFormat(d3.format('d')).ticks(8));
            g.append('g').attr('class', 'axis').call(d3.axisLeft(y));
        }
        
        // Ridgeline (Joy) Plot - Monthly Production Patterns
        function createRidgelinePlot() {
            const container = d3.select('#ridgeline-chart');
            container.selectAll('*').remove();
            
            const width = container.node().getBoundingClientRect().width;
            const height = 650;
            const margin = {top: 40, right: 40, bottom: 50, left: 90};
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
            
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
            const months = d3.range(1, 13);
            
            // Group data by month
            const monthlyData = months.map(month => {
                const values = data.monthlyProduction
                    .filter(d => d.month === month)
                    .map(d => ({ year: d.year, value: d.total }))
                    .sort((a, b) => a.year - b.year);
                return { month, name: monthNames[month - 1], values };
            });
            
            // Scales
            const xScale = d3.scaleLinear()
                .domain([2003, 2024])
                .range([0, innerWidth]);
            
            const yScale = d3.scaleBand()
                .domain(months)
                .range([0, innerHeight])
                .padding(0.15);
            
            const rowHeight = yScale.bandwidth();
            const overlap = 2.2; // How much ridges overlap
            
            // Find min/max across ALL monthly values for proper scaling
            const allValues = monthlyData.flatMap(m => m.values.map(v => v.value));
            const globalMin = d3.min(allValues);
            const globalMax = d3.max(allValues);
            
            // Value scale - use the RANGE of values, not absolute
            // This makes the ridges show relative variation more clearly
            const valueRange = globalMax - globalMin;
            const valueScale = d3.scaleLinear()
                .domain([globalMin - valueRange * 0.1, globalMax])
                .range([0, rowHeight * overlap]);
            
            // Color scale - viridis based on month average
            const monthAverages = monthlyData.map(m => d3.mean(m.values, v => v.value));
            const colorScale = d3.scaleSequential()
                .domain([d3.min(monthAverages), d3.max(monthAverages)])
                .interpolator(d3.interpolateViridis);
            
            // Draw ridges (from bottom to top for proper overlap)
            monthlyData.slice().reverse().forEach((monthData, i) => {
                const monthIndex = 12 - i;
                const baseY = yScale(monthIndex) + rowHeight;
                const avg = d3.mean(monthData.values, v => v.value);
                const color = colorScale(avg);
                
                // Create area generator
                const area = d3.area()
                    .x(d => xScale(d.year))
                    .y0(baseY)
                    .y1(d => baseY - valueScale(d.value))
                    .curve(d3.curveMonotoneX);
                
                // Create line generator
                const line = d3.line()
                    .x(d => xScale(d.year))
                    .y(d => baseY - valueScale(d.value))
                    .curve(d3.curveMonotoneX);
                
                // Draw gradient fill
                const gradientId = `ridge-gradient-${monthIndex}`;
                const gradient = svg.append('defs').append('linearGradient')
                    .attr('id', gradientId)
                    .attr('x1', '0%').attr('y1', '100%')
                    .attr('x2', '0%').attr('y2', '0%');
                gradient.append('stop').attr('offset', '0%').attr('stop-color', color).attr('stop-opacity', 0.1);
                gradient.append('stop').attr('offset', '100%').attr('stop-color', color).attr('stop-opacity', 0.6);
                
                // Ridge group
                const ridgeGroup = g.append('g').attr('class', `ridge ridge-${monthIndex}`);
                
                // Area fill
                ridgeGroup.append('path')
                    .datum(monthData.values)
                    .attr('d', area)
                    .attr('fill', `url(#${gradientId})`)
                    .attr('stroke', 'none');
                
                // Line stroke
                ridgeGroup.append('path')
                    .datum(monthData.values)
                    .attr('d', line)
                    .attr('fill', 'none')
                    .attr('stroke', color)
                    .attr('stroke-width', 2);
                
                // Baseline
                ridgeGroup.append('line')
                    .attr('x1', 0)
                    .attr('x2', innerWidth)
                    .attr('y1', baseY)
                    .attr('y2', baseY)
                    .attr('stroke', 'rgba(255,255,255,0.1)')
                    .attr('stroke-width', 1);
                
                // Month label
                g.append('text')
                    .attr('x', -10)
                    .attr('y', baseY - rowHeight * 0.3)
                    .attr('text-anchor', 'end')
                    .attr('fill', color)
                    .attr('font-size', '11px')
                    .attr('font-weight', '500')
                    .text(monthData.name.slice(0, 3));
                
                // Highlight dots for min/max years
                const minYear = monthData.values.reduce((a, b) => a.value < b.value ? a : b);
                const maxYear = monthData.values.reduce((a, b) => a.value > b.value ? a : b);
                
                // Max dot
                ridgeGroup.append('circle')
                    .attr('cx', xScale(maxYear.year))
                    .attr('cy', baseY - valueScale(maxYear.value))
                    .attr('r', 4)
                    .attr('fill', '#ffd93d')
                    .attr('stroke', '#0a0a12')
                    .attr('stroke-width', 1.5);
                
                // Interactive overlay for this ridge
                ridgeGroup.append('rect')
                    .attr('x', 0)
                    .attr('y', baseY - rowHeight * overlap)
                    .attr('width', innerWidth)
                    .attr('height', rowHeight * overlap)
                    .attr('fill', 'transparent')
                    .style('cursor', 'pointer')
                    .on('mousemove', function(event) {
                        const [mx] = d3.pointer(event);
                        const year = Math.round(xScale.invert(mx));
                        const clampedYear = Math.max(2003, Math.min(2024, year));
                        const yearData = monthData.values.find(v => v.year === clampedYear);
                        
                        if (yearData) {
                            // Show tooltip
                            const avgVal = d3.mean(monthData.values, v => v.value);
                            const diff = ((yearData.value - avgVal) / avgVal * 100).toFixed(1);
                            const diffColor = diff > 5 ? '#2ecc71' : diff < -5 ? '#e74c3c' : '#f5f0e8';
                            
                            showTooltip(event, `
                                <div class="tooltip-title">${monthData.name} ${clampedYear}</div>
                                <div class="tooltip-value" style="font-size: 18px; color: ${color};">${yearData.value.toFixed(1)} TMT</div>
                                <div style="color: ${diffColor}; margin-top: 4px;">${diff > 0 ? '+' : ''}${diff}% vs ${monthData.name} avg</div>
                                <div style="color: #a09890; margin-top: 4px; font-size: 10px;">Avg: ${avgVal.toFixed(1)} TMT</div>
                            `);
                            
                            // Highlight dot
                            ridgeGroup.selectAll('.hover-dot').remove();
                            ridgeGroup.append('circle')
                                .attr('class', 'hover-dot')
                                .attr('cx', xScale(clampedYear))
                                .attr('cy', baseY - valueScale(yearData.value))
                                .attr('r', 6)
                                .attr('fill', color)
                                .attr('stroke', '#fff')
                                .attr('stroke-width', 2);
                        }
                    })
                    .on('mouseleave', function() {
                        hideTooltip();
                        ridgeGroup.selectAll('.hover-dot').remove();
                    });
            });
            
            // X axis
            g.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${innerHeight + 10})`)
                .call(d3.axisBottom(xScale).tickFormat(d3.format('d')).ticks(11))
                .selectAll('text').attr('font-size', '10px');
            
            // Title annotation
            g.append('text')
                .attr('x', innerWidth)
                .attr('y', -10)
                .attr('text-anchor', 'end')
                .attr('fill', '#ffd93d')
                .attr('font-size', '10px')
                .text('‚óè Peak year for month');
            
            // Legend for color meaning
            const legendWidth = 100;
            const legendG = g.append('g')
                .attr('transform', `translate(${innerWidth - legendWidth - 10}, -10)`);
            
            legendG.append('text')
                .attr('x', 0)
                .attr('y', 0)
                .attr('fill', '#a09890')
                .attr('font-size', '9px')
                .text('Avg production:');
            
            // Mini gradient legend
            const miniGradient = svg.append('defs').append('linearGradient')
                .attr('id', 'ridge-legend-gradient')
                .attr('x1', '0%').attr('x2', '100%');
            miniGradient.append('stop').attr('offset', '0%').attr('stop-color', colorScale(d3.min(monthAverages)));
            miniGradient.append('stop').attr('offset', '100%').attr('stop-color', colorScale(d3.max(monthAverages)));
            
            legendG.append('rect')
                .attr('x', 0)
                .attr('y', 5)
                .attr('width', 60)
                .attr('height', 8)
                .attr('fill', 'url(#ridge-legend-gradient)')
                .attr('rx', 2);
            
            legendG.append('text').attr('x', 0).attr('y', 22).attr('fill', '#666').attr('font-size', '8px').text('Low');
            legendG.append('text').attr('x', 60).attr('y', 22).attr('fill', '#666').attr('font-size', '8px').attr('text-anchor', 'end').text('High');
        }
        
        // Rolling 12-Month Production Trend
        function createRollingTrendChart() {
            const container = d3.select('#rolling-trend-chart');
            container.selectAll('*').remove();
            
            const width = container.node().getBoundingClientRect().width;
            const height = 320;
            const margin = {top: 20, right: 60, bottom: 40, left: 50};
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
            
            // Use raw monthly production data
            const monthlyData = data.monthlyProduction;
            const parseDate = d => new Date(d.year, d.month - 1);
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            const x = d3.scaleTime()
                .domain([parseDate(monthlyData[0]), parseDate(monthlyData[monthlyData.length - 1])])
                .range([0, innerWidth]);
            
            const yMin = d3.min(monthlyData, d => d.total) * 0.95;
            const yMax = d3.max(monthlyData, d => d.total) * 1.02;
            const y = d3.scaleLinear()
                .domain([yMin, yMax])
                .range([innerHeight, 0]);
            
            // Grid lines
            g.append('g').attr('class', 'grid')
                .call(d3.axisLeft(y).tickSize(-innerWidth).tickFormat('').ticks(5))
                .selectAll('line').attr('stroke', 'rgba(255,255,255,0.05)');
            
            // Key event annotation - only Escondida Strike
            const events = [
                {date: new Date(2017, 1), label: 'Escondida Strike', yPos: 0.15}
            ];
            
            events.forEach(evt => {
                g.append('line')
                    .attr('x1', x(evt.date)).attr('x2', x(evt.date))
                    .attr('y1', 0).attr('y2', innerHeight)
                    .attr('stroke', 'rgba(255,255,255,0.2)')
                    .attr('stroke-dasharray', '3,3');
                g.append('text')
                    .attr('x', x(evt.date) + 4)
                    .attr('y', innerHeight * evt.yPos)
                    .attr('fill', '#a09890')
                    .attr('font-size', '9px')
                    .text(evt.label);
            });
            
            // Area gradient
            const gradient = svg.append('defs').append('linearGradient')
                .attr('id', 'monthly-gradient')
                .attr('x1', '0%').attr('y1', '0%').attr('x2', '0%').attr('y2', '100%');
            gradient.append('stop').attr('offset', '0%').attr('stop-color', '#B87333').attr('stop-opacity', 0.3);
            gradient.append('stop').attr('offset', '100%').attr('stop-color', '#B87333').attr('stop-opacity', 0.02);
            
            // Area
            const area = d3.area()
                .x(d => x(parseDate(d)))
                .y0(innerHeight)
                .y1(d => y(d.total))
                .curve(d3.curveMonotoneX);
            
            g.append('path')
                .datum(monthlyData)
                .attr('fill', 'url(#monthly-gradient)')
                .attr('d', area);
            
            // Line
            const line = d3.line()
                .x(d => x(parseDate(d)))
                .y(d => y(d.total))
                .curve(d3.curveMonotoneX);
            
            g.append('path')
                .datum(monthlyData)
                .attr('fill', 'none')
                .attr('stroke', '#B87333')
                .attr('stroke-width', 1.5)
                .attr('d', line);
            
            // Find peak and low points
            const peak = monthlyData.reduce((a, b) => a.total > b.total ? a : b);
            const low = monthlyData.reduce((a, b) => a.total < b.total ? a : b);
            const current = monthlyData[monthlyData.length - 1];
            
            // Peak marker
            g.append('circle')
                .attr('cx', x(parseDate(peak)))
                .attr('cy', y(peak.total))
                .attr('r', 5)
                .attr('fill', '#2ecc71')
                .attr('stroke', '#0a0a12')
                .attr('stroke-width', 2);
            
            g.append('text')
                .attr('x', x(parseDate(peak)))
                .attr('y', y(peak.total) + 18)
                .attr('text-anchor', 'middle')
                .attr('fill', '#2ecc71')
                .attr('font-size', '10px')
                .attr('font-weight', '600')
                .text(`Peak: ${peak.total.toFixed(1)} (${monthNames[peak.month-1]} ${peak.year})`);
            
            // Low marker
            g.append('circle')
                .attr('cx', x(parseDate(low)))
                .attr('cy', y(low.total))
                .attr('r', 5)
                .attr('fill', '#e74c3c')
                .attr('stroke', '#0a0a12')
                .attr('stroke-width', 2);
            
            g.append('text')
                .attr('x', x(parseDate(low)) + 8)
                .attr('y', y(low.total) + 4)
                .attr('fill', '#e74c3c')
                .attr('font-size', '10px')
                .attr('font-weight', '600')
                .text(`Low: ${low.total.toFixed(0)} (${monthNames[low.month-1]} ${low.year})`);
            
            // Current marker
            g.append('circle')
                .attr('cx', x(parseDate(current)))
                .attr('cy', y(current.total))
                .attr('r', 5)
                .attr('fill', '#4a9eff')
                .attr('stroke', '#0a0a12')
                .attr('stroke-width', 2);
            
            // Axes
            g.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${innerHeight})`)
                .call(d3.axisBottom(x).ticks(10))
                .selectAll('text').attr('font-size', '10px');
            
            g.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(y).ticks(6).tickFormat(d => d.toFixed(0)))
                .selectAll('text').attr('font-size', '10px');
            
            // Hover interaction
            const hoverLine = g.append('line')
                .attr('y1', 0).attr('y2', innerHeight)
                .attr('stroke', '#fff').attr('stroke-width', 1)
                .attr('stroke-dasharray', '4,4').attr('opacity', 0);
            
            const hoverDot = g.append('circle')
                .attr('r', 6).attr('fill', '#B87333')
                .attr('stroke', '#fff').attr('stroke-width', 2).attr('opacity', 0);
            
            g.append('rect')
                .attr('width', innerWidth).attr('height', innerHeight)
                .attr('fill', 'transparent')
                .style('cursor', 'crosshair')
                .on('mousemove', function(event) {
                    const [mx] = d3.pointer(event);
                    const dateAtMouse = x.invert(mx);
                    
                    // Find closest data point
                    const bisect = d3.bisector(d => parseDate(d)).left;
                    const idx = bisect(monthlyData, dateAtMouse);
                    const d0 = monthlyData[Math.max(0, idx - 1)];
                    const d1 = monthlyData[Math.min(monthlyData.length - 1, idx)];
                    const d = dateAtMouse - parseDate(d0) > parseDate(d1) - dateAtMouse ? d1 : d0;
                    
                    const xPos = x(parseDate(d));
                    hoverLine.attr('x1', xPos).attr('x2', xPos).attr('opacity', 0.7);
                    hoverDot.attr('cx', xPos).attr('cy', y(d.total)).attr('opacity', 1);
                    
                    // Calculate YoY change
                    const prevYearData = monthlyData.find(p => p.year === d.year - 1 && p.month === d.month);
                    let yoyHtml = '';
                    if (prevYearData) {
                        const yoyChange = ((d.total - prevYearData.total) / prevYearData.total * 100);
                        const yoyColor = yoyChange >= 0 ? '#2ecc71' : '#e74c3c';
                        const yoyArrow = yoyChange >= 0 ? '‚Üë' : '‚Üì';
                        yoyHtml = `<div style="margin-top: 8px; color: ${yoyColor}; font-size: 12px;">${yoyArrow} ${Math.abs(yoyChange).toFixed(1)}% vs ${d.year - 1}</div>`;
                    }
                    
                    showTooltip(event, `
                        <div style="font-weight: 700; margin-bottom: 6px;">${monthNames[d.month-1]} ${d.year}</div>
                        <div style="font-size: 22px; color: #B87333; font-weight: 700;">${d.total.toFixed(1)}</div>
                        ${yoyHtml}
                        <div style="margin-top: 10px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 11px;">
                            <div style="display: flex; justify-content: space-between; margin: 3px 0;">
                                <span style="color: #a09890;">Codelco</span>
                                <span style="color: #2ecc71; font-weight: 600;">${d.codelco.toFixed(1)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 3px 0;">
                                <span style="color: #a09890;">Escondida</span>
                                <span style="color: #4a9eff; font-weight: 600;">${d.escondida.toFixed(1)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 3px 0;">
                                <span style="color: #a09890;">Collahuasi</span>
                                <span style="color: #f39c12; font-weight: 600;">${d.collahuasi.toFixed(1)}</span>
                            </div>
                        </div>
                    `);
                })
                .on('mouseleave', function() {
                    hoverLine.attr('opacity', 0);
                    hoverDot.attr('opacity', 0);
                    hideTooltip();
                });
        }
        
        // Year-over-Year Comparison Chart
        function createYoYChart() {
            const container = d3.select('#yoy-chart');
            container.selectAll('*').remove();
            
            const width = container.node().getBoundingClientRect().width;
            const height = 320;
            const margin = {top: 20, right: 80, bottom: 40, left: 50};
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
            
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            const x = d3.scalePoint()
                .domain(months)
                .range([0, innerWidth])
                .padding(0.5);
            
            const y = d3.scaleLinear()
                .domain([350, 580])
                .range([innerHeight, 0]);
            
            // Grid lines
            g.append('g').attr('class', 'grid')
                .call(d3.axisLeft(y).tickSize(-innerWidth).tickFormat('').ticks(5))
                .selectAll('line').attr('stroke', 'rgba(255,255,255,0.05)');
            
            // Historical range (min-max band)
            const historicalYears = data.yearlyPatterns.filter(d => d.year < 2024);
            const rangeData = months.map((m, i) => {
                const values = historicalYears.map(yr => yr.values[i]);
                return {
                    month: m,
                    monthIdx: i,
                    min: d3.min(values),
                    max: d3.max(values),
                    avg: d3.mean(values)
                };
            });
            
            // Range area
            const areaGen = d3.area()
                .x(d => x(d.month))
                .y0(d => y(d.min))
                .y1(d => y(d.max))
                .curve(d3.curveMonotoneX);
            
            g.append('path')
                .datum(rangeData)
                .attr('fill', 'rgba(255,255,255,0.08)')
                .attr('d', areaGen);
            
            // Historical average line
            const avgLine = d3.line()
                .x(d => x(d.month))
                .y(d => y(d.avg))
                .curve(d3.curveMonotoneX);
            
            g.append('path')
                .datum(rangeData)
                .attr('fill', 'none')
                .attr('stroke', 'rgba(255,255,255,0.3)')
                .attr('stroke-width', 1.5)
                .attr('stroke-dasharray', '4,4')
                .attr('d', avgLine);
            
            // 2024 line (highlighted)
            const year2024 = data.yearlyPatterns.find(d => d.year === 2024);
            const data2024 = months.map((m, i) => ({month: m, monthIdx: i, value: year2024.values[i]}));
            
            const line2024 = d3.line()
                .x(d => x(d.month))
                .y(d => y(d.value))
                .curve(d3.curveMonotoneX);
            
            g.append('path')
                .datum(data2024)
                .attr('fill', 'none')
                .attr('stroke', '#B87333')
                .attr('stroke-width', 3)
                .attr('d', line2024);
            
            // 2024 dots
            g.selectAll('.dot-2024')
                .data(data2024)
                .enter().append('circle')
                .attr('class', 'dot-2024')
                .attr('cx', d => x(d.month))
                .attr('cy', d => y(d.value))
                .attr('r', 4)
                .attr('fill', '#B87333')
                .attr('stroke', '#fff')
                .attr('stroke-width', 1.5);
            
            // December record highlight
            const decValue = year2024.values[11];
            g.append('circle')
                .attr('cx', x('Dec'))
                .attr('cy', y(decValue))
                .attr('r', 8)
                .attr('fill', 'none')
                .attr('stroke', '#2ecc71')
                .attr('stroke-width', 2);
            g.append('text')
                .attr('x', x('Dec') + 12)
                .attr('y', y(decValue) - 8)
                .attr('fill', '#2ecc71')
                .attr('font-size', '10px')
                .attr('font-weight', '600')
                .text('Record!');
            g.append('text')
                .attr('x', x('Dec') + 12)
                .attr('y', y(decValue) + 5)
                .attr('fill', '#2ecc71')
                .attr('font-size', '11px')
                .attr('font-weight', '700')
                .text(`${decValue.toFixed(1)}`);
            
            // Axes
            g.append('g')
                .attr('transform', `translate(0,${innerHeight})`)
                .call(d3.axisBottom(x))
                .selectAll('text').attr('fill', '#a09890').attr('font-size', '9px');
            
            g.append('g')
                .call(d3.axisLeft(y).ticks(5))
                .selectAll('text').attr('fill', '#a09890').attr('font-size', '10px');
            
            // Interactive elements
            const verticalLine = g.append('line')
                .attr('class', 'hover-line')
                .attr('y1', 0)
                .attr('y2', innerHeight)
                .attr('stroke', '#fff')
                .attr('stroke-width', 1)
                .attr('stroke-dasharray', '4,4')
                .attr('opacity', 0);
            
            // Hover dots for 2024 and average
            const hoverDot2024 = g.append('circle')
                .attr('r', 7)
                .attr('fill', '#B87333')
                .attr('stroke', '#fff')
                .attr('stroke-width', 2)
                .attr('opacity', 0);
            
            const hoverDotAvg = g.append('circle')
                .attr('r', 5)
                .attr('fill', 'rgba(255,255,255,0.5)')
                .attr('stroke', '#fff')
                .attr('stroke-width', 1)
                .attr('opacity', 0);
            
            // Tooltip box
            const tooltipBox = g.append('g').attr('class', 'tooltip-box').attr('opacity', 0);
            tooltipBox.append('rect')
                .attr('fill', 'rgba(10,10,18,0.95)')
                .attr('stroke', 'rgba(184,115,51,0.3)')
                .attr('rx', 8)
                .attr('width', 165)
                .attr('height', 110);
            const tooltipContent = tooltipBox.append('g').attr('transform', 'translate(12, 18)');
            
            tooltipContent.append('text')
                .attr('class', 'tooltip-month')
                .attr('fill', '#B87333')
                .attr('font-size', '13px')
                .attr('font-weight', '700');
            
            // 2024 value row
            tooltipContent.append('circle').attr('cx', 5).attr('cy', 20).attr('r', 5).attr('fill', '#B87333');
            tooltipContent.append('text')
                .attr('class', 'tooltip-2024')
                .attr('x', 15)
                .attr('y', 24)
                .attr('fill', '#f5f0e8')
                .attr('font-size', '12px');
            
            // Average value row
            tooltipContent.append('circle').attr('cx', 5).attr('cy', 42).attr('r', 4).attr('fill', 'rgba(255,255,255,0.5)');
            tooltipContent.append('text')
                .attr('class', 'tooltip-avg')
                .attr('x', 15)
                .attr('y', 46)
                .attr('fill', '#a09890')
                .attr('font-size', '11px');
            
            // Range row
            tooltipContent.append('text')
                .attr('class', 'tooltip-range')
                .attr('x', 0)
                .attr('y', 68)
                .attr('fill', '#666')
                .attr('font-size', '10px');
            
            // Diff row
            tooltipContent.append('text')
                .attr('class', 'tooltip-diff')
                .attr('x', 0)
                .attr('y', 86)
                .attr('font-size', '11px');
            
            // Overlay for mouse events
            g.append('rect')
                .attr('class', 'overlay')
                .attr('width', innerWidth)
                .attr('height', innerHeight)
                .attr('fill', 'none')
                .attr('pointer-events', 'all')
                .on('mousemove touchmove', function(event) {
                    event.preventDefault();
                    const [mx] = d3.pointer(event);
                    
                    // Find closest month
                    let closestMonth = months[0];
                    let closestDist = Infinity;
                    months.forEach(m => {
                        const dist = Math.abs(x(m) - mx);
                        if (dist < closestDist) {
                            closestDist = dist;
                            closestMonth = m;
                        }
                    });
                    
                    const monthIdx = months.indexOf(closestMonth);
                    const xPos = x(closestMonth);
                    const val2024 = data2024[monthIdx].value;
                    const valAvg = rangeData[monthIdx].avg;
                    const valMin = rangeData[monthIdx].min;
                    const valMax = rangeData[monthIdx].max;
                    
                    // Update vertical line
                    verticalLine.attr('x1', xPos).attr('x2', xPos).attr('opacity', 0.5);
                    
                    // Update hover dots
                    hoverDot2024.attr('cx', xPos).attr('cy', y(val2024)).attr('opacity', 1);
                    hoverDotAvg.attr('cx', xPos).attr('cy', y(valAvg)).attr('opacity', 1);
                    
                    // Calculate diff from average
                    const diff = val2024 - valAvg;
                    const diffPct = (diff / valAvg) * 100;
                    const diffColor = diff >= 0 ? '#2ecc71' : '#e74c3c';
                    const diffArrow = diff >= 0 ? '‚Üë' : '‚Üì';
                    
                    // Update tooltip
                    tooltipContent.select('.tooltip-month').text(closestMonth + ' 2024');
                    tooltipContent.select('.tooltip-2024').text(`2024: ${val2024.toFixed(1)}`);
                    tooltipContent.select('.tooltip-avg').text(`Avg: ${valAvg.toFixed(1)}`);
                    tooltipContent.select('.tooltip-range').text(`Range: ${valMin.toFixed(0)} - ${valMax.toFixed(0)}`);
                    tooltipContent.select('.tooltip-diff')
                        .attr('fill', diffColor)
                        .text(`${diffArrow} ${Math.abs(diff).toFixed(1)} (${diffArrow}${Math.abs(diffPct).toFixed(1)}%)`);
                    
                    // Position tooltip
                    let tooltipX = xPos + 15;
                    if (tooltipX + 165 > innerWidth) tooltipX = xPos - 180;
                    tooltipBox.attr('transform', `translate(${tooltipX}, 20)`).attr('opacity', 1);
                })
                .on('mouseleave touchend', function() {
                    verticalLine.attr('opacity', 0);
                    hoverDot2024.attr('opacity', 0);
                    hoverDotAvg.attr('opacity', 0);
                    tooltipBox.attr('opacity', 0);
                });
        }
        
        // Heatmap with cell values like reference image
        let currentHeatmapKey = 'total';
        function createHeatmap(key) {
            currentHeatmapKey = key;
            const container = d3.select('#heatmap');
            container.selectAll('*').remove();
            
            const width = container.node().getBoundingClientRect().width;
            const height = 420;
            const margin = {top: 40, right: 80, bottom: 50, left: 55};
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
            
            const years = d3.range(2003, 2025);
            const months = d3.range(1, 13);
            const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            // Filter data for current key and calculate stats
            const values = data.monthlyProduction.map(d => d[key]).filter(v => v > 0);
            const minVal = d3.min(values);
            const maxVal = d3.max(values);
            const meanVal = d3.mean(values);
            
            // Create color scale - yellow to red like reference
            const colorScale = d3.scaleSequential()
                .domain([minVal, maxVal])
                .interpolator(d3.interpolateYlOrRd);
            
            const x = d3.scaleBand().domain(years).range([0, innerWidth]).padding(0.03);
            const y = d3.scaleBand().domain(months).range([0, innerHeight]).padding(0.03);
            
            const cellWidth = x.bandwidth();
            const cellHeight = y.bandwidth();
            
            // Create cells
            const cells = g.selectAll('.cell').data(data.monthlyProduction).enter()
                .append('g')
                .attr('class', 'heatmap-cell-group')
                .attr('transform', d => `translate(${x(d.year)}, ${y(d.month)})`);
            
            // Cell rectangles
            cells.append('rect')
                .attr('class', 'heatmap-cell')
                .attr('width', cellWidth)
                .attr('height', cellHeight)
                .attr('fill', d => {
                    if (d[key] === 0) return colorScale(minVal);
                    return colorScale(d[key]);
                })
                .attr('rx', 2)
                .attr('stroke', 'rgba(0,0,0,0.1)')
                .attr('stroke-width', 0.5)
                .style('cursor', 'pointer');
            
            // Cell text values
            cells.append('text')
                .attr('x', cellWidth / 2)
                .attr('y', cellHeight / 2)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'middle')
                .attr('fill', d => {
                    // Dark text for light cells, light text for dark cells
                    const val = d[key];
                    const ratio = (val - minVal) / (maxVal - minVal);
                    return ratio > 0.6 ? '#000' : '#fff';
                })
                .attr('font-size', cellWidth > 35 ? '11px' : '9px')
                .attr('font-weight', '500')
                .text(d => d[key] > 0 ? Math.round(d[key]) : '');
            
            // Add interactivity
            cells.on('mouseover', function(event, d) {
                // Highlight cell - raise entire group to keep text visible
                const cellGroup = d3.select(this);
                cellGroup.raise();
                
                cellGroup.select('rect')
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 2);
                
                // Highlight row and column (but not the current cell)
                g.selectAll('.heatmap-cell-group').each(function(cellData) {
                    if ((cellData.year === d.year || cellData.month === d.month) && 
                        !(cellData.year === d.year && cellData.month === d.month)) {
                        d3.select(this).select('rect')
                            .attr('stroke', 'rgba(255,255,255,0.3)')
                            .attr('stroke-width', 1);
                    }
                });
                
                // Calculate stats
                const pctDiff = ((d[key] - meanVal) / meanVal * 100);
                const diffColor = pctDiff < -5 ? '#e74c3c' : pctDiff > 5 ? '#2ecc71' : '#f5f0e8';
                
                showTooltip(event, `
                    <div style="font-weight: 700; font-size: 14px; margin-bottom: 6px;">${monthNames[d.month-1]} ${d.year}</div>
                    <div style="font-size: 22px; color: #B87333; font-weight: 700;">${d[key].toFixed(1)} TMT</div>
                    <div style="color: ${diffColor}; margin-top: 6px;">${pctDiff > 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(pctDiff).toFixed(1)}% vs average</div>
                `);
            })
            .on('mousemove', function(event) {
                tooltip.style('left', (event.pageX + 15) + 'px').style('top', (event.pageY - 10) + 'px');
            })
            .on('mouseout', function() {
                g.selectAll('.heatmap-cell-group rect')
                    .attr('stroke', 'rgba(0,0,0,0.1)')
                    .attr('stroke-width', 0.5);
                hideTooltip();
            });
            
            // X axis - years
            g.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0,${innerHeight})`)
                .call(d3.axisBottom(x).tickValues(years))
                .selectAll('text')
                .attr('transform', 'rotate(-45)')
                .attr('text-anchor', 'end')
                .attr('dx', '-0.5em')
                .attr('dy', '0.5em')
                .attr('font-size', '10px');
            
            // Y axis - months
            g.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(y).tickFormat(d => monthNames[d - 1]))
                .selectAll('text')
                .attr('font-size', '11px');
            
            // Color legend (vertical on right side)
            const legendHeight = innerHeight * 0.8;
            const legendWidth = 15;
            const legendX = innerWidth + 20;
            const legendY = (innerHeight - legendHeight) / 2;
            
            // Create gradient for legend
            const defs = svg.append('defs');
            const gradient = defs.append('linearGradient')
                .attr('id', 'heatmap-legend-gradient')
                .attr('x1', '0%').attr('y1', '100%')
                .attr('x2', '0%').attr('y2', '0%');
            
            // Add gradient stops
            for (let i = 0; i <= 10; i++) {
                const t = i / 10;
                const val = minVal + t * (maxVal - minVal);
                gradient.append('stop')
                    .attr('offset', `${t * 100}%`)
                    .attr('stop-color', colorScale(val));
            }
            
            // Legend bar
            const legend = g.append('g').attr('transform', `translate(${legendX}, ${legendY})`);
            
            legend.append('rect')
                .attr('width', legendWidth)
                .attr('height', legendHeight)
                .attr('fill', 'url(#heatmap-legend-gradient)')
                .attr('rx', 3);
            
            // Legend scale
            const legendScale = d3.scaleLinear()
                .domain([minVal, maxVal])
                .range([legendHeight, 0]);
            
            legend.append('g')
                .attr('transform', `translate(${legendWidth + 5}, 0)`)
                .call(d3.axisRight(legendScale).ticks(6).tickFormat(d => Math.round(d)))
                .selectAll('text')
                .attr('font-size', '9px');
            
            // Legend title
            legend.append('text')
                .attr('transform', `rotate(-90)`)
                .attr('x', -legendHeight / 2)
                .attr('y', -8)
                .attr('text-anchor', 'middle')
                .attr('fill', '#a09890')
                .attr('font-size', '10px')
                .text('Production (Thousand Metric Tonnes)');
            
            // Title
            g.append('text')
                .attr('x', innerWidth / 2)
                .attr('y', -20)
                .attr('text-anchor', 'middle')
                .attr('fill', '#f5f0e8')
                .attr('font-size', '14px')
                .attr('font-weight', '600')
                .text(`Monthly ${key === 'total' ? 'Chile Total' : key.charAt(0).toUpperCase() + key.slice(1)} Production (2003-2024)`);
        }
        
        // Seasonal chart
        // Monthly Production Distribution Histograms
        function createHistogramChart() {
            const container = d3.select('#histogram-chart');
            container.selectAll('*').remove();
            
            const width = container.node().getBoundingClientRect().width;
            const height = 400;
            const margin = {top: 60, right: 30, bottom: 60, left: 60};
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const g = svg.append('g').attr('transform', `translate(${margin.left}, ${margin.top})`);
            
            // Two companies to compare
            const companies = [
                { key: 'escondida', name: 'BHP (Escondida)', color: '#4a9eff' },
                { key: 'chuqui', name: 'Codelco (Chuqui, RT y MH)', color: '#2ecc71' }
            ];
            
            // Get all values and find global min/max
            const allCompanyData = companies.map(c => {
                const values = data.monthlyProduction.map(d => d[c.key]).filter(v => v > 0);
                return {
                    ...c,
                    values: values,
                    mean: d3.mean(values),
                    min: d3.min(values),
                    max: d3.max(values)
                };
            });
            
            const globalMax = d3.max(allCompanyData, c => c.max);
            
            // X scale - start from 0 to show full range
            const xScale = d3.scaleLinear()
                .domain([0, globalMax * 1.05])
                .range([0, innerWidth]);
            
            // Create histogram generator
            const numBins = 25;
            const histogram = d3.histogram()
                .domain([0, globalMax * 1.05])
                .thresholds(numBins);
            
            // Generate bins for each company
            allCompanyData.forEach(c => {
                c.bins = histogram(c.values);
            });
            
            // Find max frequency across all companies
            const maxFreq = d3.max(allCompanyData, c => d3.max(c.bins, b => b.length));
            
            // Y scale for frequency
            const yScale = d3.scaleLinear()
                .domain([0, maxFreq * 1.1])
                .range([innerHeight, 0]);
            
            // Background
            g.append('rect')
                .attr('x', 0)
                .attr('y', 0)
                .attr('width', innerWidth)
                .attr('height', innerHeight)
                .attr('fill', 'rgba(255,255,255,0.01)')
                .attr('rx', 4);
            
            // Grid lines
            g.append('g')
                .attr('class', 'grid')
                .call(d3.axisLeft(yScale).tickSize(-innerWidth).tickFormat('').ticks(6))
                .selectAll('line')
                .attr('stroke', 'rgba(255,255,255,0.05)');
            
            // Draw histograms for each company - clipped to their actual data range
            allCompanyData.forEach((company, idx) => {
                // Create area data only for bins within the company's actual range
                const areaData = [];
                
                // Start at company's min value at y=0
                areaData.push({ x: company.min, y: 0 });
                
                // Add bin midpoints only for bins that have data or are within range
                company.bins.forEach(b => {
                    const midX = (b.x0 + b.x1) / 2;
                    // Only include if within the company's actual data range
                    if (midX >= company.min * 0.95 && midX <= company.max * 1.05) {
                        areaData.push({ x: midX, y: b.length });
                    }
                });
                
                // End at company's max value at y=0
                areaData.push({ x: company.max, y: 0 });
                
                const area = d3.area()
                    .x(d => xScale(d.x))
                    .y0(innerHeight)
                    .y1(d => yScale(d.y))
                    .curve(d3.curveBasis);
                
                const line = d3.line()
                    .x(d => xScale(d.x))
                    .y(d => yScale(d.y))
                    .curve(d3.curveBasis);
                
                // Area fill
                g.append('path')
                    .datum(areaData)
                    .attr('fill', company.color)
                    .attr('fill-opacity', 0.25)
                    .attr('d', area);
                
                // Line stroke
                g.append('path')
                    .datum(areaData)
                    .attr('fill', 'none')
                    .attr('stroke', company.color)
                    .attr('stroke-width', 2.5)
                    .attr('d', line);
                
                // Mean line
                g.append('line')
                    .attr('x1', xScale(company.mean))
                    .attr('x2', xScale(company.mean))
                    .attr('y1', 0)
                    .attr('y2', innerHeight)
                    .attr('stroke', company.color)
                    .attr('stroke-width', 2)
                    .attr('stroke-dasharray', '6,4')
                    .attr('opacity', 0.8);
                
                // Mean label at top
                g.append('text')
                    .attr('x', xScale(company.mean))
                    .attr('y', -8 - idx * 14)
                    .attr('text-anchor', 'middle')
                    .attr('fill', company.color)
                    .attr('font-size', '10px')
                    .attr('font-weight', '600')
                    .text(`Œº = ${company.mean.toFixed(0)}`);
            });
            
            // X axis
            g.append('g')
                .attr('class', 'axis')
                .attr('transform', `translate(0, ${innerHeight})`)
                .call(d3.axisBottom(xScale).ticks(10).tickFormat(d => d.toFixed(0)))
                .selectAll('text')
                .attr('font-size', '11px');
            
            // Y axis
            g.append('g')
                .attr('class', 'axis')
                .call(d3.axisLeft(yScale).ticks(6))
                .selectAll('text')
                .attr('font-size', '11px');
            
            // X axis label
            g.append('text')
                .attr('x', innerWidth / 2)
                .attr('y', innerHeight + 45)
                .attr('text-anchor', 'middle')
                .attr('fill', '#a09890')
                .attr('font-size', '12px')
                .text('Monthly Production (Thousand Metric Tonnes)');
            
            // Y axis label
            g.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -innerHeight / 2)
                .attr('y', -45)
                .attr('text-anchor', 'middle')
                .attr('fill', '#a09890')
                .attr('font-size', '12px')
                .text('Frequency (months)');
            
            // Legend with actual ranges
            const legend = g.append('g')
                .attr('transform', `translate(${innerWidth - 280}, 5)`);
            
            allCompanyData.forEach((company, i) => {
                const legendRow = legend.append('g')
                    .attr('transform', `translate(0, ${i * 20})`);
                
                legendRow.append('rect')
                    .attr('width', 14)
                    .attr('height', 14)
                    .attr('fill', company.color)
                    .attr('fill-opacity', 0.5)
                    .attr('stroke', company.color)
                    .attr('stroke-width', 2)
                    .attr('rx', 2);
                
                legendRow.append('text')
                    .attr('x', 20)
                    .attr('y', 11)
                    .attr('fill', '#f5f0e8')
                    .attr('font-size', '11px')
                    .text(company.name);
            });
            
            // Add hover interaction
            const hoverLine = g.append('line')
                .attr('y1', 0)
                .attr('y2', innerHeight)
                .attr('stroke', '#fff')
                .attr('stroke-width', 1)
                .attr('stroke-dasharray', '4,4')
                .attr('opacity', 0);
            
            g.append('rect')
                .attr('width', innerWidth)
                .attr('height', innerHeight)
                .attr('fill', 'none')
                .attr('pointer-events', 'all')
                .on('mousemove', function(event) {
                    const [mx] = d3.pointer(event);
                    const xValue = xScale.invert(mx);
                    
                    hoverLine.attr('x1', mx).attr('x2', mx).attr('opacity', 0.7);
                    
                    // Find frequency for each company at this x value
                    let tooltipHtml = `<div style="font-weight: 700; margin-bottom: 8px;">${xValue.toFixed(0)} TMT</div>`;
                    
                    allCompanyData.forEach(company => {
                        const bin = company.bins.find(b => xValue >= b.x0 && xValue < b.x1);
                        const freq = bin ? bin.length : 0;
                        const inRange = xValue >= company.min && xValue <= company.max;
                        tooltipHtml += `<div style="display: flex; align-items: center; margin: 4px 0;">
                            <span style="width: 10px; height: 10px; background: ${company.color}; border-radius: 2px; margin-right: 8px;"></span>
                            <span style="color: #a09890;">${company.name.split(' ')[0]}: </span>
                            <span style="color: ${inRange ? company.color : '#666'}; font-weight: 600; margin-left: 4px;">${inRange ? freq + ' months' : 'n/a'}</span>
                        </div>`;
                    });
                    
                    showTooltip(event, tooltipHtml);
                })
                .on('mouseleave', function() {
                    hoverLine.attr('opacity', 0);
                    hideTooltip();
                });
        }
        
        function createSeasonalChart() {
            const container = d3.select('#seasonal-chart');
            const width = container.node().getBoundingClientRect().width;
            const height = 220;
            const margin = {top: 30, right: 20, bottom: 30, left: 40};
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
            
            const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            const monthFullNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
            const monthlyAvg = d3.range(1, 13).map(m => {
                const vals = data.monthlyProduction.filter(d => d.month === m).map(d => d.total);
                return {month: m, avg: d3.mean(vals), count: vals.length};
            });
            
            const x = d3.scaleBand().domain(d3.range(1, 13)).range([0, width - margin.left - margin.right]).padding(0.2);
            const yMin = d3.min(monthlyAvg, d => d.avg) - 20;
            const yMax = d3.max(monthlyAvg, d => d.avg) + 20;
            const y = d3.scaleLinear().domain([yMin, yMax]).range([height - margin.top - margin.bottom, 0]);
            
            g.selectAll('.bar').data(monthlyAvg).enter().append('rect')
                .attr('x', d => x(d.month)).attr('y', d => y(d.avg))
                .attr('width', x.bandwidth()).attr('height', d => height - margin.top - margin.bottom - y(d.avg))
                .attr('fill', d => d.avg < 420 ? '#4a9eff' : d.avg > 480 ? '#B87333' : '#D4A574')
                .attr('rx', 3)
                .style('cursor', 'pointer')
                .on('mouseover', function(event, d) {
                    d3.select(this).attr('opacity', 0.8);
                    showTooltip(event, `<div class="tooltip-title">${monthFullNames[d.month - 1]}</div><div class="tooltip-value">${d.avg.toFixed(1)} TMT</div><div class="tooltip-sub">Mean of ${d.count} years (2003-2024)</div>`);
                })
                .on('mouseout', function() {
                    d3.select(this).attr('opacity', 1);
                    hideTooltip();
                });
            
            // Value labels on top of bars
            g.selectAll('.bar-label').data(monthlyAvg).enter().append('text')
                .attr('x', d => x(d.month) + x.bandwidth() / 2)
                .attr('y', d => y(d.avg) - 5)
                .attr('text-anchor', 'middle')
                .attr('fill', '#f5f0e8')
                .attr('font-size', '10px')
                .attr('font-family', 'Roboto, sans-serif')
                .text(d => d.avg.toFixed(0));
            
            g.append('g').attr('class', 'axis').attr('transform', `translate(0,${height - margin.top - margin.bottom})`)
                .call(d3.axisBottom(x).tickFormat(d => monthNames[d - 1]));
        }
        
        // Exports donut
        function createExportsChart() {
            const container = d3.select('#exports-chart');
            container.selectAll('*').remove();
            const width = container.node().getBoundingClientRect().width;
            const height = 380;
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            
            // Donut on the left
            const chartWidth = width * 0.55;
            const g = svg.append('g').attr('transform', `translate(${chartWidth/2},${height/2})`);
            
            const exportData = [
                {region: 'China', value: 3148, color: '#e74c3c', detail: '54% of total'},
                {region: 'Japan', value: 625, color: '#ff7f50', detail: '11% of total'},
                {region: 'USA', value: 606, color: '#4a9eff', detail: '10% of total'},
                {region: 'South Korea', value: 349, color: '#9b59b6', detail: '6% of total'},
                {region: 'Other', value: 1134, color: '#706860', detail: '19% of total'}
            ];
            
            const radius = Math.min(chartWidth, height) / 2 - 20;
            const pie = d3.pie().value(d => d.value).sort(null);
            const arc = d3.arc().innerRadius(radius * 0.55).outerRadius(radius);
            const arcHover = d3.arc().innerRadius(radius * 0.55).outerRadius(radius + 8);
            
            // Store arc paths for legend interaction
            const arcPaths = g.selectAll('.arc').data(pie(exportData)).enter().append('path')
                .attr('d', arc)
                .attr('fill', d => d.data.color)
                .attr('stroke', '#1a1a24')
                .attr('stroke-width', 2)
                .attr('cursor', 'pointer')
                .attr('class', (d, i) => `arc-${i}`)
                .on('mouseover', function(event, d) {
                    d3.select(this).transition().duration(200).attr('d', arcHover);
                    const total = d3.sum(exportData, e => e.value);
                    showTooltip(event, `
                        <div class="tooltip-title">${d.data.region}</div>
                        <div class="tooltip-value">${d.data.value.toLocaleString()}</div>
                        <div class="tooltip-sub">${d.data.detail}</div>
                    `);
                    // Highlight corresponding legend item
                    d3.select(`.legend-${d.index}`).select('rect').attr('stroke', '#f5f0e8').attr('stroke-width', 2);
                })
                .on('mouseout', function(event, d) {
                    d3.select(this).transition().duration(200).attr('d', arc);
                    hideTooltip();
                    d3.select(`.legend-${d.index}`).select('rect').attr('stroke', 'none');
                });
            
            // Center text
            g.append('text').attr('text-anchor', 'middle').attr('dy', '-0.2em')
                .attr('fill', '#f5f0e8').attr('font-size', '22px').attr('font-weight', '700').text('77%');
            g.append('text').attr('text-anchor', 'middle').attr('dy', '1.2em')
                .attr('fill', '#a09890').attr('font-size', '11px').text('to Asia');
            
            // Legend on the right - interactive
            const legendG = svg.append('g').attr('transform', `translate(${chartWidth + 10}, 50)`);
            
            exportData.forEach((d, i) => {
                const row = legendG.append('g')
                    .attr('transform', `translate(0, ${i * 58})`)
                    .attr('class', `legend-${i}`)
                    .attr('cursor', 'pointer')
                    .on('mouseover', function() {
                        // Highlight corresponding arc
                        g.select(`.arc-${i}`).transition().duration(200).attr('d', arcHover);
                        d3.select(this).select('rect').attr('stroke', '#f5f0e8').attr('stroke-width', 2);
                    })
                    .on('mouseout', function() {
                        g.select(`.arc-${i}`).transition().duration(200).attr('d', arc);
                        d3.select(this).select('rect').attr('stroke', 'none');
                    });
                
                row.append('rect')
                    .attr('width', 16).attr('height', 16)
                    .attr('fill', d.color)
                    .attr('rx', 3);
                
                row.append('text')
                    .attr('x', 24).attr('y', 12)
                    .attr('fill', '#f5f0e8')
                    .attr('font-size', '13px')
                    .attr('font-weight', '500')
                    .text(d.region);
                
                row.append('text')
                    .attr('x', 24).attr('y', 30)
                    .attr('fill', '#a09890')
                    .attr('font-size', '12px')
                    .text(d.value.toLocaleString());
                
                row.append('text')
                    .attr('x', 24).attr('y', 46)
                    .attr('fill', '#706860')
                    .attr('font-size', '11px')
                    .text(d.detail);
            });
        }
        
        // Bump chart showing export destination rank changes 2010 vs 2024
        function createChinaGrowthChart() {
            const container = d3.select('#china-growth-chart');
            container.selectAll('*').remove();
            const width = container.node().getBoundingClientRect().width;
            const height = 380;
            const margin = {top: 35, right: 110, bottom: 20, left: 110};
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;
            
            const svg = container.append('svg').attr('width', width).attr('height', height);
            const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
            
            // Data with ranks (1 = highest share)
            const bumpData = [
                {country: 'China', rank2010: 1, rank2024: 1, share2010: 32.8, share2024: 53.7, color: '#e74c3c', flag: 'üá®üá≥'},
                {country: 'Japan', rank2010: 2, rank2024: 2, share2010: 12.2, share2024: 10.7, color: '#ff7f50', flag: 'üáØüáµ'},
                {country: 'S. Korea', rank2010: 3, rank2024: 4, share2010: 7.3, share2024: 6.0, color: '#9b59b6', flag: 'üá∞üá∑'},
                {country: 'Brazil', rank2010: 4, rank2024: 5, share2010: 5.9, share2024: 3.9, color: '#2ecc71', flag: 'üáßüá∑'},
                {country: 'Italy', rank2010: 5, rank2024: 8, share2010: 4.3, share2024: 0.8, color: '#a09890', flag: 'üáÆüáπ'},
                {country: 'USA', rank2010: 6, rank2024: 3, share2010: 4.2, share2024: 10.3, color: '#4a9eff', flag: 'üá∫üá∏'},
                {country: 'India', rank2010: 7, rank2024: 6, share2010: 4.0, share2024: 3.6, color: '#f39c12', flag: 'üáÆüá≥'},
                {country: 'Taiwan', rank2010: 8, rank2024: 7, share2010: 3.6, share2024: 1.3, color: '#B87333', flag: 'üáπüáº'}
            ];
            
            const y = d3.scalePoint()
                .domain([1, 2, 3, 4, 5, 6, 7, 8])
                .range([0, innerHeight])
                .padding(0.5);
            
            const x = d3.scalePoint()
                .domain(['2010', '2024'])
                .range([0, innerWidth]);
            
            // Year labels
            g.append('text')
                .attr('x', x('2010'))
                .attr('y', -15)
                .attr('text-anchor', 'middle')
                .attr('fill', '#f5f0e8')
                .attr('font-size', '14px')
                .attr('font-weight', '600')
                .text('2010');
            
            g.append('text')
                .attr('x', x('2024'))
                .attr('y', -15)
                .attr('text-anchor', 'middle')
                .attr('fill', '#f5f0e8')
                .attr('font-size', '14px')
                .attr('font-weight', '600')
                .text('2024');
            
            // Horizontal grid lines for each rank
            [1, 2, 3, 4, 5, 6, 7, 8].forEach(rank => {
                g.append('line')
                    .attr('x1', -20).attr('x2', innerWidth + 20)
                    .attr('y1', y(rank)).attr('y2', y(rank))
                    .attr('stroke', '#2a2a34')
                    .attr('stroke-width', 1);
            });
            
            // Draw bump lines
            bumpData.forEach(d => {
                const y1 = y(d.rank2010);
                const y2 = y(d.rank2024);
                const rankChange = d.rank2010 - d.rank2024; // positive = moved up
                const isRising = rankChange > 0;
                const isFalling = rankChange < 0;
                
                // Curved connecting line
                const line = d3.line().curve(d3.curveBumpX);
                const pathData = line([[x('2010'), y1], [x('2024'), y2]]);
                
                g.append('path')
                    .attr('d', pathData)
                    .attr('fill', 'none')
                    .attr('stroke', d.color)
                    .attr('stroke-width', isRising ? 4 : (isFalling ? 2.5 : 3))
                    .attr('opacity', isRising ? 1 : 0.7)
                    .attr('cursor', 'pointer')
                    .on('mouseover', function(event) {
                        d3.select(this).attr('stroke-width', 6).attr('opacity', 1);
                        const changeText = rankChange > 0 ? `‚Üë ${rankChange} position${rankChange > 1 ? 's' : ''}` : 
                                          (rankChange < 0 ? `‚Üì ${Math.abs(rankChange)} position${Math.abs(rankChange) > 1 ? 's' : ''}` : 'No change');
                        const changeColor = rankChange > 0 ? '#2ecc71' : (rankChange < 0 ? '#e74c3c' : '#a09890');
                        showTooltip(event, `
                            <div class="tooltip-title">${d.flag} ${d.country}</div>
                            <div style="display: flex; justify-content: space-between; gap: 15px; margin: 4px 0;">
                                <span style="color: #a09890;">2010:</span>
                                <span>#${d.rank2010} (${d.share2010}%)</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; gap: 15px;">
                                <span style="color: #a09890;">2024:</span>
                                <span>#${d.rank2024} (${d.share2024}%)</span>
                            </div>
                            <div class="tooltip-sub" style="color: ${changeColor}; margin-top: 6px;">${changeText}</div>
                        `);
                    })
                    .on('mouseout', function() {
                        d3.select(this)
                            .attr('stroke-width', isRising ? 4 : (isFalling ? 2.5 : 3))
                            .attr('opacity', isRising ? 1 : 0.7);
                        hideTooltip();
                    });
                
                // Left dot
                g.append('circle')
                    .attr('cx', x('2010'))
                    .attr('cy', y1)
                    .attr('r', 6)
                    .attr('fill', d.color)
                    .attr('stroke', '#1a1a24')
                    .attr('stroke-width', 2);
                
                // Right dot
                g.append('circle')
                    .attr('cx', x('2024'))
                    .attr('cy', y2)
                    .attr('r', 6)
                    .attr('fill', d.color)
                    .attr('stroke', '#1a1a24')
                    .attr('stroke-width', 2);
                
                // Left label (country + share)
                g.append('text')
                    .attr('x', x('2010') - 12)
                    .attr('y', y1)
                    .attr('text-anchor', 'end')
                    .attr('dominant-baseline', 'middle')
                    .attr('fill', d.color)
                    .attr('font-size', '11px')
                    .attr('font-weight', '500')
                    .text(`${d.country} ${d.share2010}%`);
                
                // Right label (share + country)
                g.append('text')
                    .attr('x', x('2024') + 12)
                    .attr('y', y2)
                    .attr('text-anchor', 'start')
                    .attr('dominant-baseline', 'middle')
                    .attr('fill', d.color)
                    .attr('font-size', '11px')
                    .attr('font-weight', '500')
                    .text(`${d.share2024}% ${d.country}`);
            });
            
            // Rank numbers on the left edge
            g.append('text')
                .attr('x', -100)
                .attr('y', -15)
                .attr('fill', '#706860')
                .attr('font-size', '10px')
                .attr('font-weight', '500')
                .text('RANK');
            
            [1, 2, 3, 4, 5, 6, 7, 8].forEach(rank => {
                g.append('text')
                    .attr('x', -100)
                    .attr('y', y(rank))
                    .attr('dominant-baseline', 'middle')
                    .attr('fill', '#706860')
                    .attr('font-size', '11px')
                    .attr('font-weight', '600')
                    .text(`#${rank}`);
            });
        }
        
        // Nav scroll effect
        window.addEventListener('scroll', () => {
            document.getElementById('nav').classList.toggle('scrolled', window.scrollY > 50);
        });
        
        // Mobile menu toggle
        document.getElementById('mobile-menu-btn').addEventListener('click', function() {
            this.classList.toggle('active');
            document.getElementById('nav-links').classList.toggle('active');
        });
        
        // Close mobile menu when clicking a link
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', () => {
                document.getElementById('mobile-menu-btn').classList.remove('active');
                document.getElementById('nav-links').classList.remove('active');
            });
        });
        
        // Resize handler to redraw charts
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                // Redraw responsive charts
                if (document.getElementById('share-race-chart')) {
                    d3.select('#share-race-chart').selectAll('*').remove();
                    createShareRaceChart();
                }
                if (document.getElementById('rolling-trend-chart')) {
                    createRollingTrendChart();
                }
                if (document.getElementById('yoy-chart')) {
                    createYoYChart();
                }
            }, 250);
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            createSparkline('#spark-chile', data.worldProduction.map(d => d.Chile), '#B87333');
            createSparkline('#spark-congo', data.worldProduction.filter(d => d.year >= 2013).map(d => d.Congo), '#9b59b6');
            createSparkline('#spark-peru', data.worldProduction.map(d => d.Peru), '#4a9eff');
            createSparkline('#spark-china', data.worldProduction.map(d => d.China), '#e74c3c');
            createSparkline('#spark-usa', data.worldProduction.map(d => d.USA), '#666');
            createWorldMineChart();
            createShareRaceChart();
            createSankeyChart();
            createCompanyTrendsChart();
            createSmallMultiplesChart('all');
            createRollingTrendChart();
            createYoYChart();
            createHeatmap('total');
            createHistogramChart();
            createSeasonalChart();
            createExportsChart();
            createChinaGrowthChart();
            
            document.querySelectorAll('.heat-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.heat-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    createHeatmap(this.dataset.key);
                });
            });
        });
        
        // Company selector function
        function selectCompany(btn, companyName) {
            document.querySelectorAll('.company-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            createMineBreakdownChart(companyName);
        }
        
        // Filter small multiples
        function filterSmallMultiples(companyName) {
            createSmallMultiplesChart(companyName);
        }
        
        // Small multiples chart - all companies comparison
        function createSmallMultiplesChart(filterCompany = 'all') {
            const container = d3.select('#small-multiples-chart');
            container.selectAll('*').remove();
            
            const containerWidth = container.node().getBoundingClientRect().width;
            
            const companyColors = {
                'BHP': '#4a9eff',
                'Codelco': '#B87333',
                'Antofagasta Minerals': '#2ecc71',
                'Collahuasi': '#f39c12',
                'Anglo American': '#9b59b6',
                'Freeport-McMoRan': '#e74c3c',
                'Lundin Mining': '#1abc9c',
                'Teck': '#e67e22',
                'Glencore': '#5d7a8c'
            };
            
            // Single company view or all companies
            const isSingleView = filterCompany !== 'all';
            
            let companies, cols, rows, chartWidth, chartHeight, totalHeight;
            
            if (isSingleView) {
                // Single large chart
                companies = [[filterCompany]];
                cols = 1;
                rows = 1;
                chartHeight = 450;
                chartWidth = containerWidth - 30;
                totalHeight = chartHeight + 30;
            } else {
                // 3x3 grid layout
                companies = [
                    ['BHP', 'Codelco', 'Antofagasta Minerals'],
                    ['Collahuasi', 'Anglo American', 'Teck'],
                    ['Freeport-McMoRan', 'Lundin Mining', 'Glencore']
                ];
                cols = 3;
                rows = 3;
                const gap = 15;
                chartWidth = (containerWidth - gap * (cols + 1)) / cols;
                chartHeight = 240;
                totalHeight = rows * chartHeight + (rows + 1) * gap;
            }
            
            const gap = 15;
            const margin = isSingleView 
                ? {top: 50, right: 180, bottom: 50, left: 70}
                : {top: 40, right: 50, bottom: 35, left: 50};
            
            // Update container height
            container.style('min-height', totalHeight + 'px');
            
            // Create SVG
            const svg = container.append('svg')
                .attr('width', containerWidth)
                .attr('height', totalHeight);
            
            // Draw each mini chart
            function drawMiniChart(company, col, row) {
                const mines = data.mineYearlyData[company];
                if (!mines) return;
                
                const xOffset = isSingleView ? 15 : gap + col * (chartWidth + gap);
                const yOffset = isSingleView ? 15 : gap + row * (chartHeight + gap);
                
                const g = svg.append('g')
                    .attr('class', `mini-chart`)
                    .attr('transform', `translate(${xOffset}, ${yOffset})`);
                
                const innerWidth = chartWidth - margin.left - margin.right;
                const innerHeight = chartHeight - margin.top - margin.bottom;
                
                // Background card
                g.append('rect')
                    .attr('width', chartWidth)
                    .attr('height', chartHeight)
                    .attr('fill', 'rgba(255,255,255,0.02)')
                    .attr('rx', 10)
                    .attr('stroke', 'rgba(255,255,255,0.06)')
                    .attr('stroke-width', 1);
                
                // Chart area
                const chartG = g.append('g')
                    .attr('transform', `translate(${margin.left}, ${margin.top})`);
                
                // Calculate scales
                const maxValue = d3.max(mines, m => d3.max(m.data, d => d.value));
                const x = d3.scaleLinear().domain([2003, 2024]).range([0, innerWidth]);
                const y = d3.scaleLinear().domain([0, maxValue * 1.15]).range([innerHeight, 0]);
                
                // Grid lines
                chartG.append('g').attr('class', 'grid')
                    .call(d3.axisLeft(y).tickSize(-innerWidth).tickFormat('').ticks(isSingleView ? 8 : 5))
                    .selectAll('line').attr('stroke', 'rgba(255,255,255,0.04)');
                
                // Draw lines
                mines.forEach(mine => {
                    const line = d3.line()
                        .x(d => x(d.year))
                        .y(d => y(d.value))
                        .curve(d3.curveMonotoneX);
                    
                    chartG.append('path')
                        .datum(mine.data)
                        .attr('fill', 'none')
                        .attr('stroke', mine.color)
                        .attr('stroke-width', isSingleView ? 3 : 2.5)
                        .attr('d', line);
                    
                    // End dot and label for single view
                    const lastPoint = mine.data[mine.data.length - 1];
                    chartG.append('circle')
                        .attr('cx', x(lastPoint.year))
                        .attr('cy', y(lastPoint.value))
                        .attr('r', isSingleView ? 6 : 4)
                        .attr('fill', mine.color)
                        .attr('stroke', '#0a0a12')
                        .attr('stroke-width', 2);
                    
                    // Labels on right side for single view
                    if (isSingleView) {
                        chartG.append('text')
                            .attr('x', innerWidth + 15)
                            .attr('y', y(lastPoint.value))
                            .attr('fill', mine.color)
                            .attr('font-size', '13px')
                            .attr('font-weight', '600')
                            .attr('dominant-baseline', 'middle')
                            .text(mine.name);
                        
                        chartG.append('text')
                            .attr('x', innerWidth + 15)
                            .attr('y', y(lastPoint.value) + 16)
                            .attr('fill', '#a09890')
                            .attr('font-size', '11px')
                            .attr('dominant-baseline', 'middle')
                            .text(`${lastPoint.value.toFixed(0)}`);
                    }
                });
                
                // Axes
                chartG.append('g')
                    .attr('class', 'axis')
                    .attr('transform', `translate(0,${innerHeight})`)
                    .call(d3.axisBottom(x).tickFormat(d => isSingleView ? d : `'${String(d).slice(2)}`).ticks(isSingleView ? 10 : 6))
                    .selectAll('text').attr('font-size', isSingleView ? '11px' : '9px');
                
                chartG.append('g')
                    .attr('class', 'axis')
                    .call(d3.axisLeft(y).ticks(isSingleView ? 8 : 5).tickFormat(d => d > 0 ? d.toFixed(0) : ''))
                    .selectAll('text').attr('font-size', isSingleView ? '11px' : '9px');
                
                // Y-axis label
                chartG.append('text')
                    .attr('transform', 'rotate(-90)')
                    .attr('x', -innerHeight / 2)
                    .attr('y', isSingleView ? -50 : -38)
                    .attr('text-anchor', 'middle')
                    .attr('fill', '#666')
                    .attr('font-size', isSingleView ? '12px' : '9px')
                    .text('Thousand Metric Tonnes');
                
                // Company title header
                g.append('rect')
                    .attr('x', 12)
                    .attr('y', 10)
                    .attr('width', isSingleView ? 6 : 5)
                    .attr('height', isSingleView ? 24 : 20)
                    .attr('fill', companyColors[company])
                    .attr('rx', 2);
                
                g.append('text')
                    .attr('x', isSingleView ? 24 : 22)
                    .attr('y', isSingleView ? 28 : 25)
                    .attr('fill', '#f5f0e8')
                    .attr('font-size', isSingleView ? '18px' : '13px')
                    .attr('font-weight', '600')
                    .text(company.replace('-McMoRan', ''));
                
                // Hover interaction
                const verticalLine = chartG.append('line')
                    .attr('y1', 0)
                    .attr('y2', innerHeight)
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 1)
                    .attr('stroke-dasharray', '4,4')
                    .attr('opacity', 0);
                
                const hoverDots = chartG.append('g').attr('class', 'hover-dots');
                mines.forEach(mine => {
                    hoverDots.append('circle')
                        .attr('class', `dot-${mine.name.replace(/[^a-zA-Z0-9]/g, '')}`)
                        .attr('r', isSingleView ? 7 : 5)
                        .attr('fill', mine.color)
                        .attr('stroke', '#fff')
                        .attr('stroke-width', 2)
                        .attr('opacity', 0);
                });
                
                // Tooltip
                const tooltipG = chartG.append('g').attr('class', 'mini-tooltip').attr('opacity', 0);
                const tooltipHeight = (isSingleView ? 28 : 22) + mines.length * (isSingleView ? 20 : 16);
                const tooltipWidth = isSingleView ? 160 : 120;
                tooltipG.append('rect')
                    .attr('fill', 'rgba(10,10,18,0.95)')
                    .attr('stroke', 'rgba(255,255,255,0.2)')
                    .attr('rx', 6)
                    .attr('width', tooltipWidth)
                    .attr('height', tooltipHeight);
                
                const tooltipContent = tooltipG.append('g').attr('transform', `translate(10, ${isSingleView ? 20 : 16})`);
                tooltipContent.append('text')
                    .attr('class', 'tt-year')
                    .attr('fill', '#f5f0e8')
                    .attr('font-size', isSingleView ? '13px' : '11px')
                    .attr('font-weight', '600');
                
                mines.forEach((mine, i) => {
                    const row = tooltipContent.append('g').attr('transform', `translate(0, ${(isSingleView ? 18 : 14) + i * (isSingleView ? 18 : 14)})`);
                    row.append('circle').attr('r', isSingleView ? 4 : 3).attr('fill', mine.color).attr('cx', 4).attr('cy', -3);
                    row.append('text')
                        .attr('class', `tt-${mine.name.replace(/[^a-zA-Z0-9]/g, '')}`)
                        .attr('x', 12)
                        .attr('fill', '#a09890')
                        .attr('font-size', isSingleView ? '12px' : '10px');
                });
                
                // Overlay for mouse events
                chartG.append('rect')
                    .attr('width', innerWidth)
                    .attr('height', innerHeight)
                    .attr('fill', 'none')
                    .attr('pointer-events', 'all')
                    .on('mousemove', function(event) {
                        const [mx] = d3.pointer(event);
                        const year = Math.round(x.invert(mx));
                        const clampedYear = Math.max(2003, Math.min(2024, year));
                        const xPos = x(clampedYear);
                        
                        verticalLine.attr('x1', xPos).attr('x2', xPos).attr('opacity', 0.7);
                        
                        mines.forEach(mine => {
                            const yearData = mine.data.find(d => d.year === clampedYear);
                            const value = yearData ? yearData.value : 0;
                            
                            hoverDots.select(`.dot-${mine.name.replace(/[^a-zA-Z0-9]/g, '')}`)
                                .attr('cx', xPos)
                                .attr('cy', y(value))
                                .attr('opacity', value > 0 ? 1 : 0);
                            
                            tooltipContent.select(`.tt-${mine.name.replace(/[^a-zA-Z0-9]/g, '')}`)
                                .text(`${mine.name}: ${value.toFixed(0)}`);
                        });
                        
                        tooltipContent.select('.tt-year').text(clampedYear);
                        
                        let ttX = xPos + 12;
                        if (ttX + tooltipWidth > innerWidth) ttX = xPos - tooltipWidth - 12;
                        tooltipG.attr('transform', `translate(${ttX}, 15)`).attr('opacity', 1);
                    })
                    .on('mouseleave', function() {
                        verticalLine.attr('opacity', 0);
                        hoverDots.selectAll('circle').attr('opacity', 0);
                        tooltipG.attr('opacity', 0);
                    });
            }
            
            // Draw charts
            companies.forEach((rowCompanies, rowIndex) => {
                rowCompanies.forEach((company, colIndex) => {
                    drawMiniChart(company, colIndex, rowIndex);
                });
            });
        }
    </script>
</body>
</html>
